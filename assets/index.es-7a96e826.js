import{k as os,m as $o,o as te,r as Zm,w as wf,s as _f,t as Vc,v as No,x as Xm,y as qr,z as Ii,V as e1,M as t1,N as G,A as r1,B as Ac,D as i1,K as n1,E as s1,G as nl,H as o1,I as a1,J as c1,L as sl,$ as u1,O as h1,Q as l1,R as ts,S as ol,X as f1,T as p1,_ as bf,U as jr,Y as d1,Z as al,a0 as mn,a1 as Ct,a2 as Vt,a3 as Ei,a4 as cr,a5 as g1,a6 as wn,a7 as Ef,a8 as y1,a9 as v1,aa as m1,ab as If,ac as w1,ad as xf,ae as Pf,af as bn,ag as Cc,ah as xo,ai as In,aj as _1,ak as Po,al as b1,am as E1,an as I1,ao as x1,ap as vo,aq as P1,ar as S1,as as pc,at as cl,au as O1,av as R1,aw as A1,ax as ul,ay as C1,az as T1,aA as $1,aB as N1,aC as D1,aD as F1,aE as L1,aF as Yn,aG as Sf,aH as dc,aI as j1,aJ as q1,aK as M1}from"./index-06cb32fd.js";var Gc={exports:{}},En=typeof Reflect=="object"?Reflect:null,hl=En&&typeof En.apply=="function"?En.apply:function(t,r,n){return Function.prototype.apply.call(t,r,n)},So;En&&typeof En.ownKeys=="function"?So=En.ownKeys:Object.getOwnPropertySymbols?So=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:So=function(t){return Object.getOwnPropertyNames(t)};function z1(s){console&&console.warn&&console.warn(s)}var Of=Number.isNaN||function(t){return t!==t};function je(){je.init.call(this)}Gc.exports=je;Gc.exports.once=k1;je.EventEmitter=je;je.prototype._events=void 0;je.prototype._eventsCount=0;je.prototype._maxListeners=void 0;var ll=10;function Do(s){if(typeof s!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof s)}Object.defineProperty(je,"defaultMaxListeners",{enumerable:!0,get:function(){return ll},set:function(s){if(typeof s!="number"||s<0||Of(s))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+s+".");ll=s}});je.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};je.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||Of(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function Rf(s){return s._maxListeners===void 0?je.defaultMaxListeners:s._maxListeners}je.prototype.getMaxListeners=function(){return Rf(this)};je.prototype.emit=function(t){for(var r=[],n=1;n<arguments.length;n++)r.push(arguments[n]);var o=t==="error",c=this._events;if(c!==void 0)o=o&&c.error===void 0;else if(!o)return!1;if(o){var l;if(r.length>0&&(l=r[0]),l instanceof Error)throw l;var g=new Error("Unhandled error."+(l?" ("+l.message+")":""));throw g.context=l,g}var v=c[t];if(v===void 0)return!1;if(typeof v=="function")hl(v,this,r);else for(var p=v.length,_=Nf(v,p),n=0;n<p;++n)hl(_[n],this,r);return!0};function Af(s,t,r,n){var o,c,l;if(Do(r),c=s._events,c===void 0?(c=s._events=Object.create(null),s._eventsCount=0):(c.newListener!==void 0&&(s.emit("newListener",t,r.listener?r.listener:r),c=s._events),l=c[t]),l===void 0)l=c[t]=r,++s._eventsCount;else if(typeof l=="function"?l=c[t]=n?[r,l]:[l,r]:n?l.unshift(r):l.push(r),o=Rf(s),o>0&&l.length>o&&!l.warned){l.warned=!0;var g=new Error("Possible EventEmitter memory leak detected. "+l.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");g.name="MaxListenersExceededWarning",g.emitter=s,g.type=t,g.count=l.length,z1(g)}return s}je.prototype.addListener=function(t,r){return Af(this,t,r,!1)};je.prototype.on=je.prototype.addListener;je.prototype.prependListener=function(t,r){return Af(this,t,r,!0)};function U1(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Cf(s,t,r){var n={fired:!1,wrapFn:void 0,target:s,type:t,listener:r},o=U1.bind(n);return o.listener=r,n.wrapFn=o,o}je.prototype.once=function(t,r){return Do(r),this.on(t,Cf(this,t,r)),this};je.prototype.prependOnceListener=function(t,r){return Do(r),this.prependListener(t,Cf(this,t,r)),this};je.prototype.removeListener=function(t,r){var n,o,c,l,g;if(Do(r),o=this._events,o===void 0)return this;if(n=o[t],n===void 0)return this;if(n===r||n.listener===r)--this._eventsCount===0?this._events=Object.create(null):(delete o[t],o.removeListener&&this.emit("removeListener",t,n.listener||r));else if(typeof n!="function"){for(c=-1,l=n.length-1;l>=0;l--)if(n[l]===r||n[l].listener===r){g=n[l].listener,c=l;break}if(c<0)return this;c===0?n.shift():H1(n,c),n.length===1&&(o[t]=n[0]),o.removeListener!==void 0&&this.emit("removeListener",t,g||r)}return this};je.prototype.off=je.prototype.removeListener;je.prototype.removeAllListeners=function(t){var r,n,o;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[t]),this;if(arguments.length===0){var c=Object.keys(n),l;for(o=0;o<c.length;++o)l=c[o],l!=="removeListener"&&this.removeAllListeners(l);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(r=n[t],typeof r=="function")this.removeListener(t,r);else if(r!==void 0)for(o=r.length-1;o>=0;o--)this.removeListener(t,r[o]);return this};function Tf(s,t,r){var n=s._events;if(n===void 0)return[];var o=n[t];return o===void 0?[]:typeof o=="function"?r?[o.listener||o]:[o]:r?B1(o):Nf(o,o.length)}je.prototype.listeners=function(t){return Tf(this,t,!0)};je.prototype.rawListeners=function(t){return Tf(this,t,!1)};je.listenerCount=function(s,t){return typeof s.listenerCount=="function"?s.listenerCount(t):$f.call(s,t)};je.prototype.listenerCount=$f;function $f(s){var t=this._events;if(t!==void 0){var r=t[s];if(typeof r=="function")return 1;if(r!==void 0)return r.length}return 0}je.prototype.eventNames=function(){return this._eventsCount>0?So(this._events):[]};function Nf(s,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=s[n];return r}function H1(s,t){for(;t+1<s.length;t++)s[t]=s[t+1];s.pop()}function B1(s){for(var t=new Array(s.length),r=0;r<t.length;++r)t[r]=s[r].listener||s[r];return t}function k1(s,t){return new Promise(function(r,n){function o(l){s.removeListener(t,c),n(l)}function c(){typeof s.removeListener=="function"&&s.removeListener("error",o),r([].slice.call(arguments))}Df(s,t,c,{once:!0}),t!=="error"&&K1(s,o,{once:!0})})}function K1(s,t,r){typeof s.on=="function"&&Df(s,"error",t,r)}function Df(s,t,r,n){if(typeof s.on=="function")n.once?s.once(t,r):s.on(t,r);else if(typeof s.addEventListener=="function")s.addEventListener(t,function o(c){n.once&&s.removeEventListener(t,o),r(c)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof s)}var ur=Gc.exports;const Wc=os(ur),V1=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,G1=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,W1=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function J1(s,t){if(s==="__proto__"||s==="constructor"&&t&&typeof t=="object"&&"prototype"in t){Q1(s);return}return t}function Q1(s){console.warn(`[destr] Dropping "${s}" key to prevent prototype pollution.`)}function mo(s,t={}){if(typeof s!="string")return s;const r=s.trim();if(s[0]==='"'&&s.endsWith('"')&&!s.includes("\\"))return r.slice(1,-1);if(r.length<=9){const n=r.toLowerCase();if(n==="true")return!0;if(n==="false")return!1;if(n==="undefined")return;if(n==="null")return null;if(n==="nan")return Number.NaN;if(n==="infinity")return Number.POSITIVE_INFINITY;if(n==="-infinity")return Number.NEGATIVE_INFINITY}if(!W1.test(s)){if(t.strict)throw new SyntaxError("[destr] Invalid JSON");return s}try{if(V1.test(s)||G1.test(s)){if(t.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(s,J1)}return JSON.parse(s)}catch(n){if(t.strict)throw n;return s}}function Y1(s){return!s||typeof s.then!="function"?Promise.resolve(s):s}function jt(s,...t){try{return Y1(s(...t))}catch(r){return Promise.reject(r)}}function Z1(s){const t=typeof s;return s===null||t!=="object"&&t!=="function"}function X1(s){const t=Object.getPrototypeOf(s);return!t||t.isPrototypeOf(Object)}function Oo(s){if(Z1(s))return String(s);if(X1(s)||Array.isArray(s))return JSON.stringify(s);if(typeof s.toJSON=="function")return Oo(s.toJSON());throw new Error("[unstorage] Cannot stringify value!")}function Ff(){if(typeof Buffer===void 0)throw new TypeError("[unstorage] Buffer is not supported!")}const Tc="base64:";function ew(s){if(typeof s=="string")return s;Ff();const t=Buffer.from(s).toString("base64");return Tc+t}function tw(s){return typeof s!="string"||!s.startsWith(Tc)?s:(Ff(),Buffer.from(s.slice(Tc.length),"base64"))}function ar(s){return s?s.split("?")[0].replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,""):""}function rw(...s){return ar(s.join(":"))}function wo(s){return s=ar(s),s?s+":":""}const iw="memory",nw=()=>{const s=new Map;return{name:iw,options:{},hasItem(t){return s.has(t)},getItem(t){return s.get(t)??null},getItemRaw(t){return s.get(t)??null},setItem(t,r){s.set(t,r)},setItemRaw(t,r){s.set(t,r)},removeItem(t){s.delete(t)},getKeys(){return Array.from(s.keys())},clear(){s.clear()},dispose(){s.clear()}}};function sw(s={}){const t={mounts:{"":s.driver||nw()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},r=p=>{for(const _ of t.mountpoints)if(p.startsWith(_))return{base:_,relativeKey:p.slice(_.length),driver:t.mounts[_]};return{base:"",relativeKey:p,driver:t.mounts[""]}},n=(p,_)=>t.mountpoints.filter(x=>x.startsWith(p)||_&&p.startsWith(x)).map(x=>({relativeBase:p.length>x.length?p.slice(x.length):void 0,mountpoint:x,driver:t.mounts[x]})),o=(p,_)=>{if(t.watching){_=ar(_);for(const x of t.watchListeners)x(p,_)}},c=async()=>{if(!t.watching){t.watching=!0;for(const p in t.mounts)t.unwatch[p]=await fl(t.mounts[p],o,p)}},l=async()=>{if(t.watching){for(const p in t.unwatch)await t.unwatch[p]();t.unwatch={},t.watching=!1}},g=(p,_,x)=>{const A=new Map,D=C=>{let J=A.get(C.base);return J||(J={driver:C.driver,base:C.base,items:[]},A.set(C.base,J)),J};for(const C of p){const J=typeof C=="string",re=ar(J?C:C.key),oe=J?void 0:C.value,ce=J||!C.options?_:{..._,...C.options},ae=r(re);D(ae).items.push({key:re,value:oe,relativeKey:ae.relativeKey,options:ce})}return Promise.all([...A.values()].map(C=>x(C))).then(C=>C.flat())},v={hasItem(p,_={}){p=ar(p);const{relativeKey:x,driver:A}=r(p);return jt(A.hasItem,x,_)},getItem(p,_={}){p=ar(p);const{relativeKey:x,driver:A}=r(p);return jt(A.getItem,x,_).then(D=>mo(D))},getItems(p,_){return g(p,_,x=>x.driver.getItems?jt(x.driver.getItems,x.items.map(A=>({key:A.relativeKey,options:A.options})),_).then(A=>A.map(D=>({key:rw(x.base,D.key),value:mo(D.value)}))):Promise.all(x.items.map(A=>jt(x.driver.getItem,A.relativeKey,A.options).then(D=>({key:A.key,value:mo(D)})))))},getItemRaw(p,_={}){p=ar(p);const{relativeKey:x,driver:A}=r(p);return A.getItemRaw?jt(A.getItemRaw,x,_):jt(A.getItem,x,_).then(D=>tw(D))},async setItem(p,_,x={}){if(_===void 0)return v.removeItem(p);p=ar(p);const{relativeKey:A,driver:D}=r(p);D.setItem&&(await jt(D.setItem,A,Oo(_),x),D.watch||o("update",p))},async setItems(p,_){await g(p,_,async x=>{if(x.driver.setItems)return jt(x.driver.setItems,x.items.map(A=>({key:A.relativeKey,value:Oo(A.value),options:A.options})),_);x.driver.setItem&&await Promise.all(x.items.map(A=>jt(x.driver.setItem,A.relativeKey,Oo(A.value),A.options)))})},async setItemRaw(p,_,x={}){if(_===void 0)return v.removeItem(p,x);p=ar(p);const{relativeKey:A,driver:D}=r(p);if(D.setItemRaw)await jt(D.setItemRaw,A,_,x);else if(D.setItem)await jt(D.setItem,A,ew(_),x);else return;D.watch||o("update",p)},async removeItem(p,_={}){typeof _=="boolean"&&(_={removeMeta:_}),p=ar(p);const{relativeKey:x,driver:A}=r(p);A.removeItem&&(await jt(A.removeItem,x,_),(_.removeMeta||_.removeMata)&&await jt(A.removeItem,x+"$",_),A.watch||o("remove",p))},async getMeta(p,_={}){typeof _=="boolean"&&(_={nativeOnly:_}),p=ar(p);const{relativeKey:x,driver:A}=r(p),D=Object.create(null);if(A.getMeta&&Object.assign(D,await jt(A.getMeta,x,_)),!_.nativeOnly){const C=await jt(A.getItem,x+"$",_).then(J=>mo(J));C&&typeof C=="object"&&(typeof C.atime=="string"&&(C.atime=new Date(C.atime)),typeof C.mtime=="string"&&(C.mtime=new Date(C.mtime)),Object.assign(D,C))}return D},setMeta(p,_,x={}){return this.setItem(p+"$",_,x)},removeMeta(p,_={}){return this.removeItem(p+"$",_)},async getKeys(p,_={}){p=wo(p);const x=n(p,!0);let A=[];const D=[];for(const C of x){const re=(await jt(C.driver.getKeys,C.relativeBase,_)).map(oe=>C.mountpoint+ar(oe)).filter(oe=>!A.some(ce=>oe.startsWith(ce)));D.push(...re),A=[C.mountpoint,...A.filter(oe=>!oe.startsWith(C.mountpoint))]}return p?D.filter(C=>C.startsWith(p)&&!C.endsWith("$")):D.filter(C=>!C.endsWith("$"))},async clear(p,_={}){p=wo(p),await Promise.all(n(p,!1).map(async x=>{if(x.driver.clear)return jt(x.driver.clear,x.relativeBase,_);if(x.driver.removeItem){const A=await x.driver.getKeys(x.relativeBase||"",_);return Promise.all(A.map(D=>x.driver.removeItem(D,_)))}}))},async dispose(){await Promise.all(Object.values(t.mounts).map(p=>pl(p)))},async watch(p){return await c(),t.watchListeners.push(p),async()=>{t.watchListeners=t.watchListeners.filter(_=>_!==p),t.watchListeners.length===0&&await l()}},async unwatch(){t.watchListeners=[],await l()},mount(p,_){if(p=wo(p),p&&t.mounts[p])throw new Error(`already mounted at ${p}`);return p&&(t.mountpoints.push(p),t.mountpoints.sort((x,A)=>A.length-x.length)),t.mounts[p]=_,t.watching&&Promise.resolve(fl(_,o,p)).then(x=>{t.unwatch[p]=x}).catch(console.error),v},async unmount(p,_=!0){p=wo(p),!(!p||!t.mounts[p])&&(t.watching&&p in t.unwatch&&(t.unwatch[p](),delete t.unwatch[p]),_&&await pl(t.mounts[p]),t.mountpoints=t.mountpoints.filter(x=>x!==p),delete t.mounts[p])},getMount(p=""){p=ar(p)+":";const _=r(p);return{driver:_.driver,base:_.base}},getMounts(p="",_={}){return p=ar(p),n(p,_.parents).map(A=>({driver:A.driver,base:A.mountpoint}))}};return v}function fl(s,t,r){return s.watch?s.watch((n,o)=>t(n,r+o)):()=>{}}async function pl(s){typeof s.dispose=="function"&&await jt(s.dispose)}function Vi(s){return new Promise((t,r)=>{s.oncomplete=s.onsuccess=()=>t(s.result),s.onabort=s.onerror=()=>r(s.error)})}function Lf(s,t){const r=indexedDB.open(s);r.onupgradeneeded=()=>r.result.createObjectStore(t);const n=Vi(r);return(o,c)=>n.then(l=>c(l.transaction(t,o).objectStore(t)))}let gc;function as(){return gc||(gc=Lf("keyval-store","keyval")),gc}function dl(s,t=as()){return t("readonly",r=>Vi(r.get(s)))}function ow(s,t,r=as()){return r("readwrite",n=>(n.put(t,s),Vi(n.transaction)))}function aw(s,t=as()){return t("readwrite",r=>(r.delete(s),Vi(r.transaction)))}function cw(s=as()){return s("readwrite",t=>(t.clear(),Vi(t.transaction)))}function uw(s,t){return s.openCursor().onsuccess=function(){this.result&&(t(this.result),this.result.continue())},Vi(s.transaction)}function hw(s=as()){return s("readonly",t=>{if(t.getAllKeys)return Vi(t.getAllKeys());const r=[];return uw(t,n=>r.push(n.key)).then(()=>r)})}const lw=s=>JSON.stringify(s,(t,r)=>typeof r=="bigint"?r.toString()+"n":r),fw=s=>{const t=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,r=s.replace(t,'$1"$2n"$3');return JSON.parse(r,(n,o)=>typeof o=="string"&&o.match(/^\d+n$/)?BigInt(o.substring(0,o.length-1)):o)};function cs(s){if(typeof s!="string")throw new Error(`Cannot safe json parse value of type ${typeof s}`);try{return fw(s)}catch{return s}}function Ki(s){return typeof s=="string"?s:lw(s)||""}const pw="idb-keyval";var dw=(s={})=>{const t=s.base&&s.base.length>0?`${s.base}:`:"",r=o=>t+o;let n;return s.dbName&&s.storeName&&(n=Lf(s.dbName,s.storeName)),{name:pw,options:s,async hasItem(o){return!(typeof await dl(r(o),n)>"u")},async getItem(o){return await dl(r(o),n)??null},setItem(o,c){return ow(r(o),c,n)},removeItem(o){return aw(r(o),n)},getKeys(){return hw(n)},clear(){return cw(n)}}};const gw="WALLET_CONNECT_V2_INDEXED_DB",yw="keyvaluestorage";let vw=class{constructor(){this.indexedDb=sw({driver:dw({dbName:gw,storeName:yw})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(t=>[t.key,t.value])}async getItem(t){const r=await this.indexedDb.getItem(t);if(r!==null)return r}async setItem(t,r){await this.indexedDb.setItem(t,Ki(r))}async removeItem(t){await this.indexedDb.removeItem(t)}};var yc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Ro={exports:{}};(function(){let s;function t(){}s=t,s.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},s.prototype.setItem=function(r,n){this[r]=String(n)},s.prototype.removeItem=function(r){delete this[r]},s.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(n){r[n]=void 0,delete r[n]})},s.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},s.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof yc<"u"&&yc.localStorage?Ro.exports=yc.localStorage:typeof window<"u"&&window.localStorage?Ro.exports=window.localStorage:Ro.exports=new t})();function mw(s){var t;return[s[0],cs((t=s[1])!=null?t:"")]}class ww{constructor(){this.localStorage=Ro.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(mw)}async getItem(t){const r=this.localStorage.getItem(t);if(r!==null)return cs(r)}async setItem(t,r){this.localStorage.setItem(t,Ki(r))}async removeItem(t){this.localStorage.removeItem(t)}}const _w="wc_storage_version",gl=1,bw=async(s,t,r)=>{const n=_w,o=await t.getItem(n);if(o&&o>=gl){r(t);return}const c=await s.getKeys();if(!c.length){r(t);return}const l=[];for(;c.length;){const g=c.shift();if(!g)continue;const v=g.toLowerCase();if(v.includes("wc@")||v.includes("walletconnect")||v.includes("wc_")||v.includes("wallet_connect")){const p=await s.getItem(g);await t.setItem(g,p),l.push(g)}}await t.setItem(n,gl),r(t),Ew(s,l)},Ew=async(s,t)=>{t.length&&t.forEach(async r=>{await s.removeItem(r)})};let Iw=class{constructor(){this.initialized=!1,this.setInitialized=r=>{this.storage=r,this.initialized=!0};const t=new ww;this.storage=t;try{const r=new vw;bw(t,r,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(t){return await this.initialize(),this.storage.getItem(t)}async setItem(t,r){return await this.initialize(),this.storage.setItem(t,r)}async removeItem(t){return await this.initialize(),this.storage.removeItem(t)}async initialize(){this.initialized||await new Promise(t=>{const r=setInterval(()=>{this.initialized&&(clearInterval(r),t())},20)})}};var xn={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var $c=function(s,t){return $c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var o in n)n.hasOwnProperty(o)&&(r[o]=n[o])},$c(s,t)};function xw(s,t){$c(s,t);function r(){this.constructor=s}s.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}var Nc=function(){return Nc=Object.assign||function(t){for(var r,n=1,o=arguments.length;n<o;n++){r=arguments[n];for(var c in r)Object.prototype.hasOwnProperty.call(r,c)&&(t[c]=r[c])}return t},Nc.apply(this,arguments)};function Pw(s,t){var r={};for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&t.indexOf(n)<0&&(r[n]=s[n]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(s);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(s,n[o])&&(r[n[o]]=s[n[o]]);return r}function Sw(s,t,r,n){var o=arguments.length,c=o<3?t:n===null?n=Object.getOwnPropertyDescriptor(t,r):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(s,t,r,n);else for(var g=s.length-1;g>=0;g--)(l=s[g])&&(c=(o<3?l(c):o>3?l(t,r,c):l(t,r))||c);return o>3&&c&&Object.defineProperty(t,r,c),c}function Ow(s,t){return function(r,n){t(r,n,s)}}function Rw(s,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,t)}function Aw(s,t,r,n){function o(c){return c instanceof r?c:new r(function(l){l(c)})}return new(r||(r=Promise))(function(c,l){function g(_){try{p(n.next(_))}catch(x){l(x)}}function v(_){try{p(n.throw(_))}catch(x){l(x)}}function p(_){_.done?c(_.value):o(_.value).then(g,v)}p((n=n.apply(s,t||[])).next())})}function Cw(s,t){var r={label:0,sent:function(){if(c[0]&1)throw c[1];return c[1]},trys:[],ops:[]},n,o,c,l;return l={next:g(0),throw:g(1),return:g(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function g(p){return function(_){return v([p,_])}}function v(p){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(c=p[0]&2?o.return:p[0]?o.throw||((c=o.return)&&c.call(o),0):o.next)&&!(c=c.call(o,p[1])).done)return c;switch(o=0,c&&(p=[p[0]&2,c.value]),p[0]){case 0:case 1:c=p;break;case 4:return r.label++,{value:p[1],done:!1};case 5:r.label++,o=p[1],p=[0];continue;case 7:p=r.ops.pop(),r.trys.pop();continue;default:if(c=r.trys,!(c=c.length>0&&c[c.length-1])&&(p[0]===6||p[0]===2)){r=0;continue}if(p[0]===3&&(!c||p[1]>c[0]&&p[1]<c[3])){r.label=p[1];break}if(p[0]===6&&r.label<c[1]){r.label=c[1],c=p;break}if(c&&r.label<c[2]){r.label=c[2],r.ops.push(p);break}c[2]&&r.ops.pop(),r.trys.pop();continue}p=t.call(s,r)}catch(_){p=[6,_],o=0}finally{n=c=0}if(p[0]&5)throw p[1];return{value:p[0]?p[1]:void 0,done:!0}}}function Tw(s,t,r,n){n===void 0&&(n=r),s[n]=t[r]}function $w(s,t){for(var r in s)r!=="default"&&!t.hasOwnProperty(r)&&(t[r]=s[r])}function Dc(s){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&s[t],n=0;if(r)return r.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&n>=s.length&&(s=void 0),{value:s&&s[n++],done:!s}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function jf(s,t){var r=typeof Symbol=="function"&&s[Symbol.iterator];if(!r)return s;var n=r.call(s),o,c=[],l;try{for(;(t===void 0||t-- >0)&&!(o=n.next()).done;)c.push(o.value)}catch(g){l={error:g}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(l)throw l.error}}return c}function Nw(){for(var s=[],t=0;t<arguments.length;t++)s=s.concat(jf(arguments[t]));return s}function Dw(){for(var s=0,t=0,r=arguments.length;t<r;t++)s+=arguments[t].length;for(var n=Array(s),o=0,t=0;t<r;t++)for(var c=arguments[t],l=0,g=c.length;l<g;l++,o++)n[o]=c[l];return n}function rs(s){return this instanceof rs?(this.v=s,this):new rs(s)}function Fw(s,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(s,t||[]),o,c=[];return o={},l("next"),l("throw"),l("return"),o[Symbol.asyncIterator]=function(){return this},o;function l(A){n[A]&&(o[A]=function(D){return new Promise(function(C,J){c.push([A,D,C,J])>1||g(A,D)})})}function g(A,D){try{v(n[A](D))}catch(C){x(c[0][3],C)}}function v(A){A.value instanceof rs?Promise.resolve(A.value.v).then(p,_):x(c[0][2],A)}function p(A){g("next",A)}function _(A){g("throw",A)}function x(A,D){A(D),c.shift(),c.length&&g(c[0][0],c[0][1])}}function Lw(s){var t,r;return t={},n("next"),n("throw",function(o){throw o}),n("return"),t[Symbol.iterator]=function(){return this},t;function n(o,c){t[o]=s[o]?function(l){return(r=!r)?{value:rs(s[o](l)),done:o==="return"}:c?c(l):l}:c}}function jw(s){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=s[Symbol.asyncIterator],r;return t?t.call(s):(s=typeof Dc=="function"?Dc(s):s[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(c){r[c]=s[c]&&function(l){return new Promise(function(g,v){l=s[c](l),o(g,v,l.done,l.value)})}}function o(c,l,g,v){Promise.resolve(v).then(function(p){c({value:p,done:g})},l)}}function qw(s,t){return Object.defineProperty?Object.defineProperty(s,"raw",{value:t}):s.raw=t,s}function Mw(s){if(s&&s.__esModule)return s;var t={};if(s!=null)for(var r in s)Object.hasOwnProperty.call(s,r)&&(t[r]=s[r]);return t.default=s,t}function zw(s){return s&&s.__esModule?s:{default:s}}function Uw(s,t){if(!t.has(s))throw new TypeError("attempted to get private field on non-instance");return t.get(s)}function Hw(s,t,r){if(!t.has(s))throw new TypeError("attempted to set private field on non-instance");return t.set(s,r),r}const Bw=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return Nc},__asyncDelegator:Lw,__asyncGenerator:Fw,__asyncValues:jw,__await:rs,__awaiter:Aw,__classPrivateFieldGet:Uw,__classPrivateFieldSet:Hw,__createBinding:Tw,__decorate:Sw,__exportStar:$w,__extends:xw,__generator:Cw,__importDefault:zw,__importStar:Mw,__makeTemplateObject:qw,__metadata:Rw,__param:Ow,__read:jf,__rest:Pw,__spread:Nw,__spreadArrays:Dw,__values:Dc},Symbol.toStringTag,{value:"Module"})),Fo=$o(Bw);var kn={},vc={},Kn={};class Gi{}const kw=Object.freeze(Object.defineProperty({__proto__:null,IEvents:Gi},Symbol.toStringTag,{value:"Module"})),Kw=$o(kw);var yl;function Vw(){if(yl)return Kn;yl=1,Object.defineProperty(Kn,"__esModule",{value:!0}),Kn.IHeartBeat=void 0;const s=Kw;class t extends s.IEvents{constructor(n){super()}}return Kn.IHeartBeat=t,Kn}var vl;function qf(){return vl||(vl=1,function(s){Object.defineProperty(s,"__esModule",{value:!0}),Fo.__exportStar(Vw(),s)}(vc)),vc}var mc={},Bi={},ml;function Gw(){if(ml)return Bi;ml=1,Object.defineProperty(Bi,"__esModule",{value:!0}),Bi.HEARTBEAT_EVENTS=Bi.HEARTBEAT_INTERVAL=void 0;const s=te;return Bi.HEARTBEAT_INTERVAL=s.FIVE_SECONDS,Bi.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},Bi}var wl;function Mf(){return wl||(wl=1,function(s){Object.defineProperty(s,"__esModule",{value:!0}),Fo.__exportStar(Gw(),s)}(mc)),mc}var _l;function Ww(){if(_l)return kn;_l=1,Object.defineProperty(kn,"__esModule",{value:!0}),kn.HeartBeat=void 0;const s=Fo,t=ur,r=te,n=qf(),o=Mf();class c extends n.IHeartBeat{constructor(g){super(g),this.events=new t.EventEmitter,this.interval=o.HEARTBEAT_INTERVAL,this.interval=(g==null?void 0:g.interval)||o.HEARTBEAT_INTERVAL}static init(g){return s.__awaiter(this,void 0,void 0,function*(){const v=new c(g);return yield v.init(),v})}init(){return s.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(g,v){this.events.on(g,v)}once(g,v){this.events.once(g,v)}off(g,v){this.events.off(g,v)}removeListener(g,v){this.events.removeListener(g,v)}initialize(){return s.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),r.toMiliseconds(this.interval))})}pulse(){this.events.emit(o.HEARTBEAT_EVENTS.pulse)}}return kn.HeartBeat=c,kn}(function(s){Object.defineProperty(s,"__esModule",{value:!0});const t=Fo;t.__exportStar(Ww(),s),t.__exportStar(qf(),s),t.__exportStar(Mf(),s)})(xn);function Jw(s){try{return JSON.stringify(s)}catch{return'"[Circular]"'}}var Qw=Yw;function Yw(s,t,r){var n=r&&r.stringify||Jw,o=1;if(typeof s=="object"&&s!==null){var c=t.length+o;if(c===1)return s;var l=new Array(c);l[0]=n(s);for(var g=1;g<c;g++)l[g]=n(t[g]);return l.join(" ")}if(typeof s!="string")return s;var v=t.length;if(v===0)return s;for(var p="",_=1-o,x=-1,A=s&&s.length||0,D=0;D<A;){if(s.charCodeAt(D)===37&&D+1<A){switch(x=x>-1?x:0,s.charCodeAt(D+1)){case 100:case 102:if(_>=v||t[_]==null)break;x<D&&(p+=s.slice(x,D)),p+=Number(t[_]),x=D+2,D++;break;case 105:if(_>=v||t[_]==null)break;x<D&&(p+=s.slice(x,D)),p+=Math.floor(Number(t[_])),x=D+2,D++;break;case 79:case 111:case 106:if(_>=v||t[_]===void 0)break;x<D&&(p+=s.slice(x,D));var C=typeof t[_];if(C==="string"){p+="'"+t[_]+"'",x=D+2,D++;break}if(C==="function"){p+=t[_].name||"<anonymous>",x=D+2,D++;break}p+=n(t[_]),x=D+2,D++;break;case 115:if(_>=v)break;x<D&&(p+=s.slice(x,D)),p+=String(t[_]),x=D+2,D++;break;case 37:x<D&&(p+=s.slice(x,D)),p+="%",x=D+2,D++,_--;break}++_}++D}return x===-1?s:(x<A&&(p+=s.slice(x)),p)}const bl=Qw;var Zw=Vr;const is=c_().console||{},Xw={mapHttpRequest:_o,mapHttpResponse:_o,wrapRequestSerializer:wc,wrapResponseSerializer:wc,wrapErrorSerializer:wc,req:_o,res:_o,err:n_};function e_(s,t){return Array.isArray(s)?s.filter(function(n){return n!=="!stdSerializers.err"}):s===!0?Object.keys(t):!1}function Vr(s){s=s||{},s.browser=s.browser||{};const t=s.browser.transmit;if(t&&typeof t.send!="function")throw Error("pino: transmit option must have a send function");const r=s.browser.write||is;s.browser.write&&(s.browser.asObject=!0);const n=s.serializers||{},o=e_(s.browser.serialize,n);let c=s.browser.serialize;Array.isArray(s.browser.serialize)&&s.browser.serialize.indexOf("!stdSerializers.err")>-1&&(c=!1);const l=["error","fatal","warn","info","debug","trace"];typeof r=="function"&&(r.error=r.fatal=r.warn=r.info=r.debug=r.trace=r),s.enabled===!1&&(s.level="silent");const g=s.level||"info",v=Object.create(r);v.log||(v.log=ns),Object.defineProperty(v,"levelVal",{get:_}),Object.defineProperty(v,"level",{get:x,set:A});const p={transmit:t,serialize:o,asObject:s.browser.asObject,levels:l,timestamp:s_(s)};v.levels=Vr.levels,v.level=g,v.setMaxListeners=v.getMaxListeners=v.emit=v.addListener=v.on=v.prependListener=v.once=v.prependOnceListener=v.removeListener=v.removeAllListeners=v.listeners=v.listenerCount=v.eventNames=v.write=v.flush=ns,v.serializers=n,v._serialize=o,v._stdErrSerialize=c,v.child=D,t&&(v._logEvent=Fc());function _(){return this.level==="silent"?1/0:this.levels.values[this.level]}function x(){return this._level}function A(C){if(C!=="silent"&&!this.levels.values[C])throw Error("unknown level "+C);this._level=C,yn(p,v,"error","log"),yn(p,v,"fatal","error"),yn(p,v,"warn","error"),yn(p,v,"info","log"),yn(p,v,"debug","log"),yn(p,v,"trace","log")}function D(C,J){if(!C)throw new Error("missing bindings for child Pino");J=J||{},o&&C.serializers&&(J.serializers=C.serializers);const re=J.serializers;if(o&&re){var oe=Object.assign({},n,re),ce=s.browser.serialize===!0?Object.keys(oe):o;delete C.serializers,Lo([C],ce,oe,this._stdErrSerialize)}function ae(ee){this._childLevel=(ee._childLevel|0)+1,this.error=vn(ee,C,"error"),this.fatal=vn(ee,C,"fatal"),this.warn=vn(ee,C,"warn"),this.info=vn(ee,C,"info"),this.debug=vn(ee,C,"debug"),this.trace=vn(ee,C,"trace"),oe&&(this.serializers=oe,this._serialize=ce),t&&(this._logEvent=Fc([].concat(ee._logEvent.bindings,C)))}return ae.prototype=this,new ae(this)}return v}Vr.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}};Vr.stdSerializers=Xw;Vr.stdTimeFunctions=Object.assign({},{nullTime:zf,epochTime:Uf,unixTime:o_,isoTime:a_});function yn(s,t,r,n){const o=Object.getPrototypeOf(t);t[r]=t.levelVal>t.levels.values[r]?ns:o[r]?o[r]:is[r]||is[n]||ns,t_(s,t,r)}function t_(s,t,r){!s.transmit&&t[r]===ns||(t[r]=function(n){return function(){const c=s.timestamp(),l=new Array(arguments.length),g=Object.getPrototypeOf&&Object.getPrototypeOf(this)===is?is:this;for(var v=0;v<l.length;v++)l[v]=arguments[v];if(s.serialize&&!s.asObject&&Lo(l,this._serialize,this.serializers,this._stdErrSerialize),s.asObject?n.call(g,r_(this,r,l,c)):n.apply(g,l),s.transmit){const p=s.transmit.level||t.level,_=Vr.levels.values[p],x=Vr.levels.values[r];if(x<_)return;i_(this,{ts:c,methodLevel:r,methodValue:x,transmitLevel:p,transmitValue:Vr.levels.values[s.transmit.level||t.level],send:s.transmit.send,val:t.levelVal},l)}}}(t[r]))}function r_(s,t,r,n){s._serialize&&Lo(r,s._serialize,s.serializers,s._stdErrSerialize);const o=r.slice();let c=o[0];const l={};n&&(l.time=n),l.level=Vr.levels.values[t];let g=(s._childLevel|0)+1;if(g<1&&(g=1),c!==null&&typeof c=="object"){for(;g--&&typeof o[0]=="object";)Object.assign(l,o.shift());c=o.length?bl(o.shift(),o):void 0}else typeof c=="string"&&(c=bl(o.shift(),o));return c!==void 0&&(l.msg=c),l}function Lo(s,t,r,n){for(const o in s)if(n&&s[o]instanceof Error)s[o]=Vr.stdSerializers.err(s[o]);else if(typeof s[o]=="object"&&!Array.isArray(s[o]))for(const c in s[o])t&&t.indexOf(c)>-1&&c in r&&(s[o][c]=r[c](s[o][c]))}function vn(s,t,r){return function(){const n=new Array(1+arguments.length);n[0]=t;for(var o=1;o<n.length;o++)n[o]=arguments[o-1];return s[r].apply(this,n)}}function i_(s,t,r){const n=t.send,o=t.ts,c=t.methodLevel,l=t.methodValue,g=t.val,v=s._logEvent.bindings;Lo(r,s._serialize||Object.keys(s.serializers),s.serializers,s._stdErrSerialize===void 0?!0:s._stdErrSerialize),s._logEvent.ts=o,s._logEvent.messages=r.filter(function(p){return v.indexOf(p)===-1}),s._logEvent.level.label=c,s._logEvent.level.value=l,n(c,s._logEvent,g),s._logEvent=Fc(v)}function Fc(s){return{ts:0,messages:[],bindings:s||[],level:{label:"",value:0}}}function n_(s){const t={type:s.constructor.name,msg:s.message,stack:s.stack};for(const r in s)t[r]===void 0&&(t[r]=s[r]);return t}function s_(s){return typeof s.timestamp=="function"?s.timestamp:s.timestamp===!1?zf:Uf}function _o(){return{}}function wc(s){return s}function ns(){}function zf(){return!1}function Uf(){return Date.now()}function o_(){return Math.round(Date.now()/1e3)}function a_(){return new Date(Date.now()).toISOString()}function c_(){function s(t){return typeof t<"u"&&t}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return s(self)||s(window)||s(this)||{}}}const jo=os(Zw),u_={level:"info"},us="custom_context";var h_=Object.defineProperty,l_=Object.defineProperties,f_=Object.getOwnPropertyDescriptors,El=Object.getOwnPropertySymbols,p_=Object.prototype.hasOwnProperty,d_=Object.prototype.propertyIsEnumerable,Il=(s,t,r)=>t in s?h_(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,g_=(s,t)=>{for(var r in t||(t={}))p_.call(t,r)&&Il(s,r,t[r]);if(El)for(var r of El(t))d_.call(t,r)&&Il(s,r,t[r]);return s},y_=(s,t)=>l_(s,f_(t));function qo(s){return y_(g_({},s),{level:(s==null?void 0:s.level)||u_.level})}function v_(s,t=us){return s[t]||""}function m_(s,t,r=us){return s[r]=t,s}function hr(s,t=us){let r="";return typeof s.bindings>"u"?r=v_(s,t):r=s.bindings().context||"",r}function w_(s,t,r=us){const n=hr(s,r);return n.trim()?`${n}/${t}`:t}function lr(s,t,r=us){const n=w_(s,t,r),o=s.child({context:n});return m_(o,n,r)}let __=class extends Gi{constructor(t){super(),this.opts=t,this.protocol="wc",this.version=2}},b_=class extends Gi{constructor(t,r){super(),this.core=t,this.logger=r,this.records=new Map}},E_=class{constructor(t,r){this.logger=t,this.core=r}},I_=class extends Gi{constructor(t,r){super(),this.relayer=t,this.logger=r}},x_=class extends Gi{constructor(t){super()}},P_=class{constructor(t,r,n,o){this.core=t,this.logger=r,this.name=n}},S_=class extends Gi{constructor(t,r){super(),this.relayer=t,this.logger=r}},O_=class extends Gi{constructor(t,r){super(),this.core=t,this.logger=r}},R_=class{constructor(t,r){this.projectId=t,this.logger=r}},A_=class{constructor(t,r){this.projectId=t,this.logger=r}},C_=class{constructor(t){this.opts=t,this.protocol="wc",this.version=2}},T_=class{constructor(t){this.client=t}};var Jc={},Hf={};(function(s){Object.defineProperty(s,"__esModule",{value:!0});var t=Zm,r=wf;s.DIGEST_LENGTH=64,s.BLOCK_SIZE=128;var n=function(){function g(){this.digestLength=s.DIGEST_LENGTH,this.blockSize=s.BLOCK_SIZE,this._stateHi=new Int32Array(8),this._stateLo=new Int32Array(8),this._tempHi=new Int32Array(16),this._tempLo=new Int32Array(16),this._buffer=new Uint8Array(256),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return g.prototype._initState=function(){this._stateHi[0]=1779033703,this._stateHi[1]=3144134277,this._stateHi[2]=1013904242,this._stateHi[3]=2773480762,this._stateHi[4]=1359893119,this._stateHi[5]=2600822924,this._stateHi[6]=528734635,this._stateHi[7]=1541459225,this._stateLo[0]=4089235720,this._stateLo[1]=2227873595,this._stateLo[2]=4271175723,this._stateLo[3]=1595750129,this._stateLo[4]=2917565137,this._stateLo[5]=725511199,this._stateLo[6]=4215389547,this._stateLo[7]=327033209},g.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},g.prototype.clean=function(){r.wipe(this._buffer),r.wipe(this._tempHi),r.wipe(this._tempLo),this.reset()},g.prototype.update=function(v,p){if(p===void 0&&(p=v.length),this._finished)throw new Error("SHA512: can't update because hash was finished.");var _=0;if(this._bytesHashed+=p,this._bufferLength>0){for(;this._bufferLength<s.BLOCK_SIZE&&p>0;)this._buffer[this._bufferLength++]=v[_++],p--;this._bufferLength===this.blockSize&&(c(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize),this._bufferLength=0)}for(p>=this.blockSize&&(_=c(this._tempHi,this._tempLo,this._stateHi,this._stateLo,v,_,p),p%=this.blockSize);p>0;)this._buffer[this._bufferLength++]=v[_++],p--;return this},g.prototype.finish=function(v){if(!this._finished){var p=this._bytesHashed,_=this._bufferLength,x=p/536870912|0,A=p<<3,D=p%128<112?128:256;this._buffer[_]=128;for(var C=_+1;C<D-8;C++)this._buffer[C]=0;t.writeUint32BE(x,this._buffer,D-8),t.writeUint32BE(A,this._buffer,D-4),c(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,D),this._finished=!0}for(var C=0;C<this.digestLength/8;C++)t.writeUint32BE(this._stateHi[C],v,C*8),t.writeUint32BE(this._stateLo[C],v,C*8+4);return this},g.prototype.digest=function(){var v=new Uint8Array(this.digestLength);return this.finish(v),v},g.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},g.prototype.restoreState=function(v){return this._stateHi.set(v.stateHi),this._stateLo.set(v.stateLo),this._bufferLength=v.bufferLength,v.buffer&&this._buffer.set(v.buffer),this._bytesHashed=v.bytesHashed,this._finished=!1,this},g.prototype.cleanSavedState=function(v){r.wipe(v.stateHi),r.wipe(v.stateLo),v.buffer&&r.wipe(v.buffer),v.bufferLength=0,v.bytesHashed=0},g}();s.SHA512=n;var o=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function c(g,v,p,_,x,A,D){for(var C=p[0],J=p[1],re=p[2],oe=p[3],ce=p[4],ae=p[5],ee=p[6],he=p[7],pe=_[0],Y=_[1],ve=_[2],_t=_[3],st=_[4],ke=_[5],qt=_[6],Mt=_[7],b,O,Q,le,H,U,B,k;D>=128;){for(var et=0;et<16;et++){var ot=8*et+A;g[et]=t.readUint32BE(x,ot),v[et]=t.readUint32BE(x,ot+4)}for(var et=0;et<80;et++){var Ri=C,Ee=J,Ar=re,F=oe,N=ce,T=ae,h=ee,I=he,Z=pe,ue=Y,me=ve,Oe=_t,Ae=st,Ie=ke,bt=qt,gt=Mt;if(b=he,O=Mt,H=O&65535,U=O>>>16,B=b&65535,k=b>>>16,b=(ce>>>14|st<<32-14)^(ce>>>18|st<<32-18)^(st>>>41-32|ce<<32-(41-32)),O=(st>>>14|ce<<32-14)^(st>>>18|ce<<32-18)^(ce>>>41-32|st<<32-(41-32)),H+=O&65535,U+=O>>>16,B+=b&65535,k+=b>>>16,b=ce&ae^~ce&ee,O=st&ke^~st&qt,H+=O&65535,U+=O>>>16,B+=b&65535,k+=b>>>16,b=o[et*2],O=o[et*2+1],H+=O&65535,U+=O>>>16,B+=b&65535,k+=b>>>16,b=g[et%16],O=v[et%16],H+=O&65535,U+=O>>>16,B+=b&65535,k+=b>>>16,U+=H>>>16,B+=U>>>16,k+=B>>>16,Q=B&65535|k<<16,le=H&65535|U<<16,b=Q,O=le,H=O&65535,U=O>>>16,B=b&65535,k=b>>>16,b=(C>>>28|pe<<32-28)^(pe>>>34-32|C<<32-(34-32))^(pe>>>39-32|C<<32-(39-32)),O=(pe>>>28|C<<32-28)^(C>>>34-32|pe<<32-(34-32))^(C>>>39-32|pe<<32-(39-32)),H+=O&65535,U+=O>>>16,B+=b&65535,k+=b>>>16,b=C&J^C&re^J&re,O=pe&Y^pe&ve^Y&ve,H+=O&65535,U+=O>>>16,B+=b&65535,k+=b>>>16,U+=H>>>16,B+=U>>>16,k+=B>>>16,I=B&65535|k<<16,gt=H&65535|U<<16,b=F,O=Oe,H=O&65535,U=O>>>16,B=b&65535,k=b>>>16,b=Q,O=le,H+=O&65535,U+=O>>>16,B+=b&65535,k+=b>>>16,U+=H>>>16,B+=U>>>16,k+=B>>>16,F=B&65535|k<<16,Oe=H&65535|U<<16,J=Ri,re=Ee,oe=Ar,ce=F,ae=N,ee=T,he=h,C=I,Y=Z,ve=ue,_t=me,st=Oe,ke=Ae,qt=Ie,Mt=bt,pe=gt,et%16===15)for(var ot=0;ot<16;ot++)b=g[ot],O=v[ot],H=O&65535,U=O>>>16,B=b&65535,k=b>>>16,b=g[(ot+9)%16],O=v[(ot+9)%16],H+=O&65535,U+=O>>>16,B+=b&65535,k+=b>>>16,Q=g[(ot+1)%16],le=v[(ot+1)%16],b=(Q>>>1|le<<32-1)^(Q>>>8|le<<32-8)^Q>>>7,O=(le>>>1|Q<<32-1)^(le>>>8|Q<<32-8)^(le>>>7|Q<<32-7),H+=O&65535,U+=O>>>16,B+=b&65535,k+=b>>>16,Q=g[(ot+14)%16],le=v[(ot+14)%16],b=(Q>>>19|le<<32-19)^(le>>>61-32|Q<<32-(61-32))^Q>>>6,O=(le>>>19|Q<<32-19)^(Q>>>61-32|le<<32-(61-32))^(le>>>6|Q<<32-6),H+=O&65535,U+=O>>>16,B+=b&65535,k+=b>>>16,U+=H>>>16,B+=U>>>16,k+=B>>>16,g[ot]=B&65535|k<<16,v[ot]=H&65535|U<<16}b=C,O=pe,H=O&65535,U=O>>>16,B=b&65535,k=b>>>16,b=p[0],O=_[0],H+=O&65535,U+=O>>>16,B+=b&65535,k+=b>>>16,U+=H>>>16,B+=U>>>16,k+=B>>>16,p[0]=C=B&65535|k<<16,_[0]=pe=H&65535|U<<16,b=J,O=Y,H=O&65535,U=O>>>16,B=b&65535,k=b>>>16,b=p[1],O=_[1],H+=O&65535,U+=O>>>16,B+=b&65535,k+=b>>>16,U+=H>>>16,B+=U>>>16,k+=B>>>16,p[1]=J=B&65535|k<<16,_[1]=Y=H&65535|U<<16,b=re,O=ve,H=O&65535,U=O>>>16,B=b&65535,k=b>>>16,b=p[2],O=_[2],H+=O&65535,U+=O>>>16,B+=b&65535,k+=b>>>16,U+=H>>>16,B+=U>>>16,k+=B>>>16,p[2]=re=B&65535|k<<16,_[2]=ve=H&65535|U<<16,b=oe,O=_t,H=O&65535,U=O>>>16,B=b&65535,k=b>>>16,b=p[3],O=_[3],H+=O&65535,U+=O>>>16,B+=b&65535,k+=b>>>16,U+=H>>>16,B+=U>>>16,k+=B>>>16,p[3]=oe=B&65535|k<<16,_[3]=_t=H&65535|U<<16,b=ce,O=st,H=O&65535,U=O>>>16,B=b&65535,k=b>>>16,b=p[4],O=_[4],H+=O&65535,U+=O>>>16,B+=b&65535,k+=b>>>16,U+=H>>>16,B+=U>>>16,k+=B>>>16,p[4]=ce=B&65535|k<<16,_[4]=st=H&65535|U<<16,b=ae,O=ke,H=O&65535,U=O>>>16,B=b&65535,k=b>>>16,b=p[5],O=_[5],H+=O&65535,U+=O>>>16,B+=b&65535,k+=b>>>16,U+=H>>>16,B+=U>>>16,k+=B>>>16,p[5]=ae=B&65535|k<<16,_[5]=ke=H&65535|U<<16,b=ee,O=qt,H=O&65535,U=O>>>16,B=b&65535,k=b>>>16,b=p[6],O=_[6],H+=O&65535,U+=O>>>16,B+=b&65535,k+=b>>>16,U+=H>>>16,B+=U>>>16,k+=B>>>16,p[6]=ee=B&65535|k<<16,_[6]=qt=H&65535|U<<16,b=he,O=Mt,H=O&65535,U=O>>>16,B=b&65535,k=b>>>16,b=p[7],O=_[7],H+=O&65535,U+=O>>>16,B+=b&65535,k+=b>>>16,U+=H>>>16,B+=U>>>16,k+=B>>>16,p[7]=he=B&65535|k<<16,_[7]=Mt=H&65535|U<<16,A+=128,D-=128}return A}function l(g){var v=new n;v.update(g);var p=v.digest();return v.clean(),p}s.hash=l})(Hf);(function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.convertSecretKeyToX25519=s.convertPublicKeyToX25519=s.verify=s.sign=s.extractPublicKeyFromSecretKey=s.generateKeyPair=s.generateKeyPairFromSeed=s.SEED_LENGTH=s.SECRET_KEY_LENGTH=s.PUBLIC_KEY_LENGTH=s.SIGNATURE_LENGTH=void 0;const t=_f,r=Hf,n=wf;s.SIGNATURE_LENGTH=64,s.PUBLIC_KEY_LENGTH=32,s.SECRET_KEY_LENGTH=64,s.SEED_LENGTH=32;function o(F){const N=new Float64Array(16);if(F)for(let T=0;T<F.length;T++)N[T]=F[T];return N}const c=new Uint8Array(32);c[0]=9;const l=o(),g=o([1]),v=o([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),p=o([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),_=o([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),x=o([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),A=o([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function D(F,N){for(let T=0;T<16;T++)F[T]=N[T]|0}function C(F){let N=1;for(let T=0;T<16;T++){let h=F[T]+N+65535;N=Math.floor(h/65536),F[T]=h-N*65536}F[0]+=N-1+37*(N-1)}function J(F,N,T){const h=~(T-1);for(let I=0;I<16;I++){const Z=h&(F[I]^N[I]);F[I]^=Z,N[I]^=Z}}function re(F,N){const T=o(),h=o();for(let I=0;I<16;I++)h[I]=N[I];C(h),C(h),C(h);for(let I=0;I<2;I++){T[0]=h[0]-65517;for(let ue=1;ue<15;ue++)T[ue]=h[ue]-65535-(T[ue-1]>>16&1),T[ue-1]&=65535;T[15]=h[15]-32767-(T[14]>>16&1);const Z=T[15]>>16&1;T[14]&=65535,J(h,T,1-Z)}for(let I=0;I<16;I++)F[2*I]=h[I]&255,F[2*I+1]=h[I]>>8}function oe(F,N){let T=0;for(let h=0;h<32;h++)T|=F[h]^N[h];return(1&T-1>>>8)-1}function ce(F,N){const T=new Uint8Array(32),h=new Uint8Array(32);return re(T,F),re(h,N),oe(T,h)}function ae(F){const N=new Uint8Array(32);return re(N,F),N[0]&1}function ee(F,N){for(let T=0;T<16;T++)F[T]=N[2*T]+(N[2*T+1]<<8);F[15]&=32767}function he(F,N,T){for(let h=0;h<16;h++)F[h]=N[h]+T[h]}function pe(F,N,T){for(let h=0;h<16;h++)F[h]=N[h]-T[h]}function Y(F,N,T){let h,I,Z=0,ue=0,me=0,Oe=0,Ae=0,Ie=0,bt=0,gt=0,tt=0,Te=0,Ke=0,Ve=0,rt=0,Fe=0,Ge=0,Re=0,qe=0,at=0,Ne=0,Et=0,Tt=0,zt=0,Ut=0,Dt=0,Wt=0,er=0,Mr=0,Jt=0,Gr=0,li=0,Ai=0,ct=T[0],Qe=T[1],ut=T[2],ht=T[3],it=T[4],Ye=T[5],It=T[6],xt=T[7],lt=T[8],Pt=T[9],ft=T[10],yt=T[11],pt=T[12],Be=T[13],St=T[14],Ot=T[15];h=N[0],Z+=h*ct,ue+=h*Qe,me+=h*ut,Oe+=h*ht,Ae+=h*it,Ie+=h*Ye,bt+=h*It,gt+=h*xt,tt+=h*lt,Te+=h*Pt,Ke+=h*ft,Ve+=h*yt,rt+=h*pt,Fe+=h*Be,Ge+=h*St,Re+=h*Ot,h=N[1],ue+=h*ct,me+=h*Qe,Oe+=h*ut,Ae+=h*ht,Ie+=h*it,bt+=h*Ye,gt+=h*It,tt+=h*xt,Te+=h*lt,Ke+=h*Pt,Ve+=h*ft,rt+=h*yt,Fe+=h*pt,Ge+=h*Be,Re+=h*St,qe+=h*Ot,h=N[2],me+=h*ct,Oe+=h*Qe,Ae+=h*ut,Ie+=h*ht,bt+=h*it,gt+=h*Ye,tt+=h*It,Te+=h*xt,Ke+=h*lt,Ve+=h*Pt,rt+=h*ft,Fe+=h*yt,Ge+=h*pt,Re+=h*Be,qe+=h*St,at+=h*Ot,h=N[3],Oe+=h*ct,Ae+=h*Qe,Ie+=h*ut,bt+=h*ht,gt+=h*it,tt+=h*Ye,Te+=h*It,Ke+=h*xt,Ve+=h*lt,rt+=h*Pt,Fe+=h*ft,Ge+=h*yt,Re+=h*pt,qe+=h*Be,at+=h*St,Ne+=h*Ot,h=N[4],Ae+=h*ct,Ie+=h*Qe,bt+=h*ut,gt+=h*ht,tt+=h*it,Te+=h*Ye,Ke+=h*It,Ve+=h*xt,rt+=h*lt,Fe+=h*Pt,Ge+=h*ft,Re+=h*yt,qe+=h*pt,at+=h*Be,Ne+=h*St,Et+=h*Ot,h=N[5],Ie+=h*ct,bt+=h*Qe,gt+=h*ut,tt+=h*ht,Te+=h*it,Ke+=h*Ye,Ve+=h*It,rt+=h*xt,Fe+=h*lt,Ge+=h*Pt,Re+=h*ft,qe+=h*yt,at+=h*pt,Ne+=h*Be,Et+=h*St,Tt+=h*Ot,h=N[6],bt+=h*ct,gt+=h*Qe,tt+=h*ut,Te+=h*ht,Ke+=h*it,Ve+=h*Ye,rt+=h*It,Fe+=h*xt,Ge+=h*lt,Re+=h*Pt,qe+=h*ft,at+=h*yt,Ne+=h*pt,Et+=h*Be,Tt+=h*St,zt+=h*Ot,h=N[7],gt+=h*ct,tt+=h*Qe,Te+=h*ut,Ke+=h*ht,Ve+=h*it,rt+=h*Ye,Fe+=h*It,Ge+=h*xt,Re+=h*lt,qe+=h*Pt,at+=h*ft,Ne+=h*yt,Et+=h*pt,Tt+=h*Be,zt+=h*St,Ut+=h*Ot,h=N[8],tt+=h*ct,Te+=h*Qe,Ke+=h*ut,Ve+=h*ht,rt+=h*it,Fe+=h*Ye,Ge+=h*It,Re+=h*xt,qe+=h*lt,at+=h*Pt,Ne+=h*ft,Et+=h*yt,Tt+=h*pt,zt+=h*Be,Ut+=h*St,Dt+=h*Ot,h=N[9],Te+=h*ct,Ke+=h*Qe,Ve+=h*ut,rt+=h*ht,Fe+=h*it,Ge+=h*Ye,Re+=h*It,qe+=h*xt,at+=h*lt,Ne+=h*Pt,Et+=h*ft,Tt+=h*yt,zt+=h*pt,Ut+=h*Be,Dt+=h*St,Wt+=h*Ot,h=N[10],Ke+=h*ct,Ve+=h*Qe,rt+=h*ut,Fe+=h*ht,Ge+=h*it,Re+=h*Ye,qe+=h*It,at+=h*xt,Ne+=h*lt,Et+=h*Pt,Tt+=h*ft,zt+=h*yt,Ut+=h*pt,Dt+=h*Be,Wt+=h*St,er+=h*Ot,h=N[11],Ve+=h*ct,rt+=h*Qe,Fe+=h*ut,Ge+=h*ht,Re+=h*it,qe+=h*Ye,at+=h*It,Ne+=h*xt,Et+=h*lt,Tt+=h*Pt,zt+=h*ft,Ut+=h*yt,Dt+=h*pt,Wt+=h*Be,er+=h*St,Mr+=h*Ot,h=N[12],rt+=h*ct,Fe+=h*Qe,Ge+=h*ut,Re+=h*ht,qe+=h*it,at+=h*Ye,Ne+=h*It,Et+=h*xt,Tt+=h*lt,zt+=h*Pt,Ut+=h*ft,Dt+=h*yt,Wt+=h*pt,er+=h*Be,Mr+=h*St,Jt+=h*Ot,h=N[13],Fe+=h*ct,Ge+=h*Qe,Re+=h*ut,qe+=h*ht,at+=h*it,Ne+=h*Ye,Et+=h*It,Tt+=h*xt,zt+=h*lt,Ut+=h*Pt,Dt+=h*ft,Wt+=h*yt,er+=h*pt,Mr+=h*Be,Jt+=h*St,Gr+=h*Ot,h=N[14],Ge+=h*ct,Re+=h*Qe,qe+=h*ut,at+=h*ht,Ne+=h*it,Et+=h*Ye,Tt+=h*It,zt+=h*xt,Ut+=h*lt,Dt+=h*Pt,Wt+=h*ft,er+=h*yt,Mr+=h*pt,Jt+=h*Be,Gr+=h*St,li+=h*Ot,h=N[15],Re+=h*ct,qe+=h*Qe,at+=h*ut,Ne+=h*ht,Et+=h*it,Tt+=h*Ye,zt+=h*It,Ut+=h*xt,Dt+=h*lt,Wt+=h*Pt,er+=h*ft,Mr+=h*yt,Jt+=h*pt,Gr+=h*Be,li+=h*St,Ai+=h*Ot,Z+=38*qe,ue+=38*at,me+=38*Ne,Oe+=38*Et,Ae+=38*Tt,Ie+=38*zt,bt+=38*Ut,gt+=38*Dt,tt+=38*Wt,Te+=38*er,Ke+=38*Mr,Ve+=38*Jt,rt+=38*Gr,Fe+=38*li,Ge+=38*Ai,I=1,h=Z+I+65535,I=Math.floor(h/65536),Z=h-I*65536,h=ue+I+65535,I=Math.floor(h/65536),ue=h-I*65536,h=me+I+65535,I=Math.floor(h/65536),me=h-I*65536,h=Oe+I+65535,I=Math.floor(h/65536),Oe=h-I*65536,h=Ae+I+65535,I=Math.floor(h/65536),Ae=h-I*65536,h=Ie+I+65535,I=Math.floor(h/65536),Ie=h-I*65536,h=bt+I+65535,I=Math.floor(h/65536),bt=h-I*65536,h=gt+I+65535,I=Math.floor(h/65536),gt=h-I*65536,h=tt+I+65535,I=Math.floor(h/65536),tt=h-I*65536,h=Te+I+65535,I=Math.floor(h/65536),Te=h-I*65536,h=Ke+I+65535,I=Math.floor(h/65536),Ke=h-I*65536,h=Ve+I+65535,I=Math.floor(h/65536),Ve=h-I*65536,h=rt+I+65535,I=Math.floor(h/65536),rt=h-I*65536,h=Fe+I+65535,I=Math.floor(h/65536),Fe=h-I*65536,h=Ge+I+65535,I=Math.floor(h/65536),Ge=h-I*65536,h=Re+I+65535,I=Math.floor(h/65536),Re=h-I*65536,Z+=I-1+37*(I-1),I=1,h=Z+I+65535,I=Math.floor(h/65536),Z=h-I*65536,h=ue+I+65535,I=Math.floor(h/65536),ue=h-I*65536,h=me+I+65535,I=Math.floor(h/65536),me=h-I*65536,h=Oe+I+65535,I=Math.floor(h/65536),Oe=h-I*65536,h=Ae+I+65535,I=Math.floor(h/65536),Ae=h-I*65536,h=Ie+I+65535,I=Math.floor(h/65536),Ie=h-I*65536,h=bt+I+65535,I=Math.floor(h/65536),bt=h-I*65536,h=gt+I+65535,I=Math.floor(h/65536),gt=h-I*65536,h=tt+I+65535,I=Math.floor(h/65536),tt=h-I*65536,h=Te+I+65535,I=Math.floor(h/65536),Te=h-I*65536,h=Ke+I+65535,I=Math.floor(h/65536),Ke=h-I*65536,h=Ve+I+65535,I=Math.floor(h/65536),Ve=h-I*65536,h=rt+I+65535,I=Math.floor(h/65536),rt=h-I*65536,h=Fe+I+65535,I=Math.floor(h/65536),Fe=h-I*65536,h=Ge+I+65535,I=Math.floor(h/65536),Ge=h-I*65536,h=Re+I+65535,I=Math.floor(h/65536),Re=h-I*65536,Z+=I-1+37*(I-1),F[0]=Z,F[1]=ue,F[2]=me,F[3]=Oe,F[4]=Ae,F[5]=Ie,F[6]=bt,F[7]=gt,F[8]=tt,F[9]=Te,F[10]=Ke,F[11]=Ve,F[12]=rt,F[13]=Fe,F[14]=Ge,F[15]=Re}function ve(F,N){Y(F,N,N)}function _t(F,N){const T=o();let h;for(h=0;h<16;h++)T[h]=N[h];for(h=253;h>=0;h--)ve(T,T),h!==2&&h!==4&&Y(T,T,N);for(h=0;h<16;h++)F[h]=T[h]}function st(F,N){const T=o();let h;for(h=0;h<16;h++)T[h]=N[h];for(h=250;h>=0;h--)ve(T,T),h!==1&&Y(T,T,N);for(h=0;h<16;h++)F[h]=T[h]}function ke(F,N){const T=o(),h=o(),I=o(),Z=o(),ue=o(),me=o(),Oe=o(),Ae=o(),Ie=o();pe(T,F[1],F[0]),pe(Ie,N[1],N[0]),Y(T,T,Ie),he(h,F[0],F[1]),he(Ie,N[0],N[1]),Y(h,h,Ie),Y(I,F[3],N[3]),Y(I,I,p),Y(Z,F[2],N[2]),he(Z,Z,Z),pe(ue,h,T),pe(me,Z,I),he(Oe,Z,I),he(Ae,h,T),Y(F[0],ue,me),Y(F[1],Ae,Oe),Y(F[2],Oe,me),Y(F[3],ue,Ae)}function qt(F,N,T){for(let h=0;h<4;h++)J(F[h],N[h],T)}function Mt(F,N){const T=o(),h=o(),I=o();_t(I,N[2]),Y(T,N[0],I),Y(h,N[1],I),re(F,h),F[31]^=ae(T)<<7}function b(F,N,T){D(F[0],l),D(F[1],g),D(F[2],g),D(F[3],l);for(let h=255;h>=0;--h){const I=T[h/8|0]>>(h&7)&1;qt(F,N,I),ke(N,F),ke(F,F),qt(F,N,I)}}function O(F,N){const T=[o(),o(),o(),o()];D(T[0],_),D(T[1],x),D(T[2],g),Y(T[3],_,x),b(F,T,N)}function Q(F){if(F.length!==s.SEED_LENGTH)throw new Error(`ed25519: seed must be ${s.SEED_LENGTH} bytes`);const N=(0,r.hash)(F);N[0]&=248,N[31]&=127,N[31]|=64;const T=new Uint8Array(32),h=[o(),o(),o(),o()];O(h,N),Mt(T,h);const I=new Uint8Array(64);return I.set(F),I.set(T,32),{publicKey:T,secretKey:I}}s.generateKeyPairFromSeed=Q;function le(F){const N=(0,t.randomBytes)(32,F),T=Q(N);return(0,n.wipe)(N),T}s.generateKeyPair=le;function H(F){if(F.length!==s.SECRET_KEY_LENGTH)throw new Error(`ed25519: secret key must be ${s.SECRET_KEY_LENGTH} bytes`);return new Uint8Array(F.subarray(32))}s.extractPublicKeyFromSecretKey=H;const U=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function B(F,N){let T,h,I,Z;for(h=63;h>=32;--h){for(T=0,I=h-32,Z=h-12;I<Z;++I)N[I]+=T-16*N[h]*U[I-(h-32)],T=Math.floor((N[I]+128)/256),N[I]-=T*256;N[I]+=T,N[h]=0}for(T=0,I=0;I<32;I++)N[I]+=T-(N[31]>>4)*U[I],T=N[I]>>8,N[I]&=255;for(I=0;I<32;I++)N[I]-=T*U[I];for(h=0;h<32;h++)N[h+1]+=N[h]>>8,F[h]=N[h]&255}function k(F){const N=new Float64Array(64);for(let T=0;T<64;T++)N[T]=F[T];for(let T=0;T<64;T++)F[T]=0;B(F,N)}function et(F,N){const T=new Float64Array(64),h=[o(),o(),o(),o()],I=(0,r.hash)(F.subarray(0,32));I[0]&=248,I[31]&=127,I[31]|=64;const Z=new Uint8Array(64);Z.set(I.subarray(32),32);const ue=new r.SHA512;ue.update(Z.subarray(32)),ue.update(N);const me=ue.digest();ue.clean(),k(me),O(h,me),Mt(Z,h),ue.reset(),ue.update(Z.subarray(0,32)),ue.update(F.subarray(32)),ue.update(N);const Oe=ue.digest();k(Oe);for(let Ae=0;Ae<32;Ae++)T[Ae]=me[Ae];for(let Ae=0;Ae<32;Ae++)for(let Ie=0;Ie<32;Ie++)T[Ae+Ie]+=Oe[Ae]*I[Ie];return B(Z.subarray(32),T),Z}s.sign=et;function ot(F,N){const T=o(),h=o(),I=o(),Z=o(),ue=o(),me=o(),Oe=o();return D(F[2],g),ee(F[1],N),ve(I,F[1]),Y(Z,I,v),pe(I,I,F[2]),he(Z,F[2],Z),ve(ue,Z),ve(me,ue),Y(Oe,me,ue),Y(T,Oe,I),Y(T,T,Z),st(T,T),Y(T,T,I),Y(T,T,Z),Y(T,T,Z),Y(F[0],T,Z),ve(h,F[0]),Y(h,h,Z),ce(h,I)&&Y(F[0],F[0],A),ve(h,F[0]),Y(h,h,Z),ce(h,I)?-1:(ae(F[0])===N[31]>>7&&pe(F[0],l,F[0]),Y(F[3],F[0],F[1]),0)}function Ri(F,N,T){const h=new Uint8Array(32),I=[o(),o(),o(),o()],Z=[o(),o(),o(),o()];if(T.length!==s.SIGNATURE_LENGTH)throw new Error(`ed25519: signature must be ${s.SIGNATURE_LENGTH} bytes`);if(ot(Z,F))return!1;const ue=new r.SHA512;ue.update(T.subarray(0,32)),ue.update(F),ue.update(N);const me=ue.digest();return k(me),b(I,Z,me),O(Z,T.subarray(32)),ke(I,Z),Mt(h,I),!oe(T,h)}s.verify=Ri;function Ee(F){let N=[o(),o(),o(),o()];if(ot(N,F))throw new Error("Ed25519: invalid public key");let T=o(),h=o(),I=N[1];he(T,g,I),pe(h,g,I),_t(h,h),Y(T,T,h);let Z=new Uint8Array(32);return re(Z,T),Z}s.convertPublicKeyToX25519=Ee;function Ar(F){const N=(0,r.hash)(F.subarray(0,32));N[0]&=248,N[31]&=127,N[31]|=64;const T=new Uint8Array(N.subarray(0,32));return(0,n.wipe)(N),T}s.convertSecretKeyToX25519=Ar})(Jc);const $_="EdDSA",N_="JWT",Bf=".",kf="base64url",D_="utf8",F_="utf8",L_=":",j_="did",q_="key",xl="base58btc",M_="z",z_="K36",U_=32;function Ao(s){return No(Vc(Ki(s),D_),kf)}function Kf(s){const t=Vc(z_,xl),r=M_+No(Xm([t,s]),xl);return[j_,q_,r].join(L_)}function H_(s){return No(s,kf)}function B_(s){return Vc([Ao(s.header),Ao(s.payload)].join(Bf),F_)}function k_(s){return[Ao(s.header),Ao(s.payload),H_(s.signature)].join(Bf)}function Pl(s=_f.randomBytes(U_)){return Jc.generateKeyPairFromSeed(s)}async function K_(s,t,r,n,o=te.fromMiliseconds(Date.now())){const c={alg:$_,typ:N_},l=Kf(n.publicKey),g=o+r,v={iss:l,sub:s,aud:t,iat:o,exp:g},p=B_({header:c,payload:v}),_=Jc.sign(n.secretKey,p);return k_({header:c,payload:v,signature:_})}const V_="PARSE_ERROR",G_="INVALID_REQUEST",W_="METHOD_NOT_FOUND",J_="INVALID_PARAMS",Vf="INTERNAL_ERROR",Qc="SERVER_ERROR",Q_=[-32700,-32600,-32601,-32602,-32603],es={[V_]:{code:-32700,message:"Parse error"},[G_]:{code:-32600,message:"Invalid Request"},[W_]:{code:-32601,message:"Method not found"},[J_]:{code:-32602,message:"Invalid params"},[Vf]:{code:-32603,message:"Internal error"},[Qc]:{code:-32e3,message:"Server error"}},Gf=Qc;function Y_(s){return Q_.includes(s)}function Sl(s){return Object.keys(es).includes(s)?es[s]:es[Gf]}function Z_(s){const t=Object.values(es).find(r=>r.code===s);return t||es[Gf]}function Wf(s,t,r){return s.message.includes("getaddrinfo ENOTFOUND")||s.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${r} RPC url at ${t}`):s}var Jf={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Lc=function(s,t){return Lc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var o in n)n.hasOwnProperty(o)&&(r[o]=n[o])},Lc(s,t)};function X_(s,t){Lc(s,t);function r(){this.constructor=s}s.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}var jc=function(){return jc=Object.assign||function(t){for(var r,n=1,o=arguments.length;n<o;n++){r=arguments[n];for(var c in r)Object.prototype.hasOwnProperty.call(r,c)&&(t[c]=r[c])}return t},jc.apply(this,arguments)};function eb(s,t){var r={};for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&t.indexOf(n)<0&&(r[n]=s[n]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(s);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(s,n[o])&&(r[n[o]]=s[n[o]]);return r}function tb(s,t,r,n){var o=arguments.length,c=o<3?t:n===null?n=Object.getOwnPropertyDescriptor(t,r):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(s,t,r,n);else for(var g=s.length-1;g>=0;g--)(l=s[g])&&(c=(o<3?l(c):o>3?l(t,r,c):l(t,r))||c);return o>3&&c&&Object.defineProperty(t,r,c),c}function rb(s,t){return function(r,n){t(r,n,s)}}function ib(s,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,t)}function nb(s,t,r,n){function o(c){return c instanceof r?c:new r(function(l){l(c)})}return new(r||(r=Promise))(function(c,l){function g(_){try{p(n.next(_))}catch(x){l(x)}}function v(_){try{p(n.throw(_))}catch(x){l(x)}}function p(_){_.done?c(_.value):o(_.value).then(g,v)}p((n=n.apply(s,t||[])).next())})}function sb(s,t){var r={label:0,sent:function(){if(c[0]&1)throw c[1];return c[1]},trys:[],ops:[]},n,o,c,l;return l={next:g(0),throw:g(1),return:g(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function g(p){return function(_){return v([p,_])}}function v(p){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(c=p[0]&2?o.return:p[0]?o.throw||((c=o.return)&&c.call(o),0):o.next)&&!(c=c.call(o,p[1])).done)return c;switch(o=0,c&&(p=[p[0]&2,c.value]),p[0]){case 0:case 1:c=p;break;case 4:return r.label++,{value:p[1],done:!1};case 5:r.label++,o=p[1],p=[0];continue;case 7:p=r.ops.pop(),r.trys.pop();continue;default:if(c=r.trys,!(c=c.length>0&&c[c.length-1])&&(p[0]===6||p[0]===2)){r=0;continue}if(p[0]===3&&(!c||p[1]>c[0]&&p[1]<c[3])){r.label=p[1];break}if(p[0]===6&&r.label<c[1]){r.label=c[1],c=p;break}if(c&&r.label<c[2]){r.label=c[2],r.ops.push(p);break}c[2]&&r.ops.pop(),r.trys.pop();continue}p=t.call(s,r)}catch(_){p=[6,_],o=0}finally{n=c=0}if(p[0]&5)throw p[1];return{value:p[0]?p[1]:void 0,done:!0}}}function ob(s,t,r,n){n===void 0&&(n=r),s[n]=t[r]}function ab(s,t){for(var r in s)r!=="default"&&!t.hasOwnProperty(r)&&(t[r]=s[r])}function qc(s){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&s[t],n=0;if(r)return r.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&n>=s.length&&(s=void 0),{value:s&&s[n++],done:!s}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Qf(s,t){var r=typeof Symbol=="function"&&s[Symbol.iterator];if(!r)return s;var n=r.call(s),o,c=[],l;try{for(;(t===void 0||t-- >0)&&!(o=n.next()).done;)c.push(o.value)}catch(g){l={error:g}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(l)throw l.error}}return c}function cb(){for(var s=[],t=0;t<arguments.length;t++)s=s.concat(Qf(arguments[t]));return s}function ub(){for(var s=0,t=0,r=arguments.length;t<r;t++)s+=arguments[t].length;for(var n=Array(s),o=0,t=0;t<r;t++)for(var c=arguments[t],l=0,g=c.length;l<g;l++,o++)n[o]=c[l];return n}function ss(s){return this instanceof ss?(this.v=s,this):new ss(s)}function hb(s,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(s,t||[]),o,c=[];return o={},l("next"),l("throw"),l("return"),o[Symbol.asyncIterator]=function(){return this},o;function l(A){n[A]&&(o[A]=function(D){return new Promise(function(C,J){c.push([A,D,C,J])>1||g(A,D)})})}function g(A,D){try{v(n[A](D))}catch(C){x(c[0][3],C)}}function v(A){A.value instanceof ss?Promise.resolve(A.value.v).then(p,_):x(c[0][2],A)}function p(A){g("next",A)}function _(A){g("throw",A)}function x(A,D){A(D),c.shift(),c.length&&g(c[0][0],c[0][1])}}function lb(s){var t,r;return t={},n("next"),n("throw",function(o){throw o}),n("return"),t[Symbol.iterator]=function(){return this},t;function n(o,c){t[o]=s[o]?function(l){return(r=!r)?{value:ss(s[o](l)),done:o==="return"}:c?c(l):l}:c}}function fb(s){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=s[Symbol.asyncIterator],r;return t?t.call(s):(s=typeof qc=="function"?qc(s):s[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(c){r[c]=s[c]&&function(l){return new Promise(function(g,v){l=s[c](l),o(g,v,l.done,l.value)})}}function o(c,l,g,v){Promise.resolve(v).then(function(p){c({value:p,done:g})},l)}}function pb(s,t){return Object.defineProperty?Object.defineProperty(s,"raw",{value:t}):s.raw=t,s}function db(s){if(s&&s.__esModule)return s;var t={};if(s!=null)for(var r in s)Object.hasOwnProperty.call(s,r)&&(t[r]=s[r]);return t.default=s,t}function gb(s){return s&&s.__esModule?s:{default:s}}function yb(s,t){if(!t.has(s))throw new TypeError("attempted to get private field on non-instance");return t.get(s)}function vb(s,t,r){if(!t.has(s))throw new TypeError("attempted to set private field on non-instance");return t.set(s,r),r}const mb=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return jc},__asyncDelegator:lb,__asyncGenerator:hb,__asyncValues:fb,__await:ss,__awaiter:nb,__classPrivateFieldGet:yb,__classPrivateFieldSet:vb,__createBinding:ob,__decorate:tb,__exportStar:ab,__extends:X_,__generator:sb,__importDefault:gb,__importStar:db,__makeTemplateObject:pb,__metadata:ib,__param:rb,__read:Qf,__rest:eb,__spread:cb,__spreadArrays:ub,__values:qc},Symbol.toStringTag,{value:"Module"})),wb=$o(mb);var si={},Ol;function _b(){if(Ol)return si;Ol=1,Object.defineProperty(si,"__esModule",{value:!0}),si.isBrowserCryptoAvailable=si.getSubtleCrypto=si.getBrowerCrypto=void 0;function s(){return(qr===null||qr===void 0?void 0:qr.crypto)||(qr===null||qr===void 0?void 0:qr.msCrypto)||{}}si.getBrowerCrypto=s;function t(){const n=s();return n.subtle||n.webkitSubtle}si.getSubtleCrypto=t;function r(){return!!s()&&!!t()}return si.isBrowserCryptoAvailable=r,si}var oi={},Rl;function bb(){if(Rl)return oi;Rl=1,Object.defineProperty(oi,"__esModule",{value:!0}),oi.isBrowser=oi.isNode=oi.isReactNative=void 0;function s(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}oi.isReactNative=s;function t(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}oi.isNode=t;function r(){return!s()&&!t()}return oi.isBrowser=r,oi}(function(s){Object.defineProperty(s,"__esModule",{value:!0});const t=wb;t.__exportStar(_b(),s),t.__exportStar(bb(),s)})(Jf);function Yc(s=3){const t=Date.now()*Math.pow(10,s),r=Math.floor(Math.random()*Math.pow(10,s));return t+r}function Zc(s=6){return BigInt(Yc(s))}function ki(s,t,r){return{id:r||Yc(),jsonrpc:"2.0",method:s,params:t}}function Mo(s,t){return{id:s,jsonrpc:"2.0",result:t}}function zo(s,t,r){return{id:s,jsonrpc:"2.0",error:Eb(t,r)}}function Eb(s,t){return typeof s>"u"?Sl(Vf):(typeof s=="string"&&(s=Object.assign(Object.assign({},Sl(Qc)),{message:s})),typeof t<"u"&&(s.data=t),Y_(s.code)&&(s=Z_(s.code)),s)}class Ib{}class xb extends Ib{constructor(){super()}}class Yf extends xb{constructor(t){super()}}const Pb="^https?:",Sb="^wss?:";function Ob(s){const t=s.match(new RegExp(/^\w+:/,"gi"));if(!(!t||!t.length))return t[0]}function Zf(s,t){const r=Ob(s);return typeof r>"u"?!1:new RegExp(t).test(r)}function Al(s){return Zf(s,Pb)}function Cl(s){return Zf(s,Sb)}function Rb(s){return new RegExp("wss?://localhost(:d{2,5})?").test(s)}function Xf(s){return typeof s=="object"&&"id"in s&&"jsonrpc"in s&&s.jsonrpc==="2.0"}function Xc(s){return Xf(s)&&"method"in s}function hs(s){return Xf(s)&&(ui(s)||Rr(s))}function ui(s){return"result"in s}function Rr(s){return"error"in s}let Ab=class extends Yf{constructor(t){super(t),this.events=new ur.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(t),this.connection.connected&&this.registerEventListeners()}async connect(t=this.connection){await this.open(t)}async disconnect(){await this.close()}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async request(t,r){return this.requestStrict(ki(t.method,t.params||[],t.id||Zc().toString()),r)}async requestStrict(t,r){return new Promise(async(n,o)=>{if(!this.connection.connected)try{await this.open()}catch(c){o(c)}this.events.on(`${t.id}`,c=>{Rr(c)?o(c.error):n(c.result)});try{await this.connection.send(t,r)}catch(c){o(c)}})}setConnection(t=this.connection){return t}onPayload(t){this.events.emit("payload",t),hs(t)?this.events.emit(`${t.id}`,t):this.events.emit("message",{type:t.method,data:t.params})}onClose(t){t&&t.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${t.code} ${t.reason?`(${t.reason})`:""}`)),this.events.emit("disconnect")}async open(t=this.connection){this.connection===t&&this.connection.connected||(this.connection.connected&&this.close(),typeof t=="string"&&(await this.connection.open(t),t=this.connection),this.connection=this.setConnection(t),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",t=>this.onPayload(t)),this.connection.on("close",t=>this.onClose(t)),this.connection.on("error",t=>this.events.emit("error",t)),this.connection.on("register_error",t=>this.onClose()),this.hasRegisteredEventListeners=!0)}};const Cb=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),Tb=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",Tl=s=>s.split("?")[0],$l=10,$b=Cb();let Nb=class{constructor(t){if(this.url=t,this.events=new ur.EventEmitter,this.registering=!1,!Cl(t))throw new Error(`Provided URL is not compatible with WebSocket connection: ${t}`);this.url=t}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async open(t=this.url){await this.register(t)}async close(){return new Promise((t,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=n=>{this.onClose(n),t()},this.socket.close()})}async send(t){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(Ki(t))}catch(r){this.onError(t.id,r)}}register(t=this.url){if(!Cl(t))throw new Error(`Provided URL is not compatible with WebSocket connection: ${t}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((n,o)=>{this.events.once("register_error",c=>{this.resetMaxListeners(),o(c)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return o(new Error("WebSocket connection is missing or invalid"));n(this.socket)})})}return this.url=t,this.registering=!0,new Promise((r,n)=>{const o=new URLSearchParams(t).get("origin"),c=Jf.isReactNative()?{headers:{origin:o}}:{rejectUnauthorized:!Rb(t)},l=new $b(t,[],c);Tb()?l.onerror=g=>{const v=g;n(this.emitError(v.error))}:l.on("error",g=>{n(this.emitError(g))}),l.onopen=()=>{this.onOpen(l),r(l)}})}onOpen(t){t.onmessage=r=>this.onPayload(r),t.onclose=r=>this.onClose(r),this.socket=t,this.registering=!1,this.events.emit("open")}onClose(t){this.socket=void 0,this.registering=!1,this.events.emit("close",t)}onPayload(t){if(typeof t.data>"u")return;const r=typeof t.data=="string"?cs(t.data):t.data;this.events.emit("payload",r)}onError(t,r){const n=this.parseError(r),o=n.message||n.toString(),c=zo(t,o);this.events.emit("payload",c)}parseError(t,r=this.url){return Wf(t,Tl(r),"WS")}resetMaxListeners(){this.events.getMaxListeners()>$l&&this.events.setMaxListeners($l)}emitError(t){const r=this.parseError(new Error((t==null?void 0:t.message)||`WebSocket connection failed for host: ${Tl(this.url)}`));return this.events.emit("register_error",r),r}};var Co={exports:{}};Co.exports;(function(s,t){var r=200,n="__lodash_hash_undefined__",o=1,c=2,l=9007199254740991,g="[object Arguments]",v="[object Array]",p="[object AsyncFunction]",_="[object Boolean]",x="[object Date]",A="[object Error]",D="[object Function]",C="[object GeneratorFunction]",J="[object Map]",re="[object Number]",oe="[object Null]",ce="[object Object]",ae="[object Promise]",ee="[object Proxy]",he="[object RegExp]",pe="[object Set]",Y="[object String]",ve="[object Symbol]",_t="[object Undefined]",st="[object WeakMap]",ke="[object ArrayBuffer]",qt="[object DataView]",Mt="[object Float32Array]",b="[object Float64Array]",O="[object Int8Array]",Q="[object Int16Array]",le="[object Int32Array]",H="[object Uint8Array]",U="[object Uint8ClampedArray]",B="[object Uint16Array]",k="[object Uint32Array]",et=/[\\^$.*+?()[\]{}|]/g,ot=/^\[object .+?Constructor\]$/,Ri=/^(?:0|[1-9]\d*)$/,Ee={};Ee[Mt]=Ee[b]=Ee[O]=Ee[Q]=Ee[le]=Ee[H]=Ee[U]=Ee[B]=Ee[k]=!0,Ee[g]=Ee[v]=Ee[ke]=Ee[_]=Ee[qt]=Ee[x]=Ee[A]=Ee[D]=Ee[J]=Ee[re]=Ee[ce]=Ee[he]=Ee[pe]=Ee[Y]=Ee[st]=!1;var Ar=typeof qr=="object"&&qr&&qr.Object===Object&&qr,F=typeof self=="object"&&self&&self.Object===Object&&self,N=Ar||F||Function("return this")(),T=t&&!t.nodeType&&t,h=T&&!0&&s&&!s.nodeType&&s,I=h&&h.exports===T,Z=I&&Ar.process,ue=function(){try{return Z&&Z.binding&&Z.binding("util")}catch{}}(),me=ue&&ue.isTypedArray;function Oe(m,P){for(var M=-1,V=m==null?0:m.length,ze=0,de=[];++M<V;){var We=m[M];P(We,M,m)&&(de[ze++]=We)}return de}function Ae(m,P){for(var M=-1,V=P.length,ze=m.length;++M<V;)m[ze+M]=P[M];return m}function Ie(m,P){for(var M=-1,V=m==null?0:m.length;++M<V;)if(P(m[M],M,m))return!0;return!1}function bt(m,P){for(var M=-1,V=Array(m);++M<m;)V[M]=P(M);return V}function gt(m){return function(P){return m(P)}}function tt(m,P){return m.has(P)}function Te(m,P){return m==null?void 0:m[P]}function Ke(m){var P=-1,M=Array(m.size);return m.forEach(function(V,ze){M[++P]=[ze,V]}),M}function Ve(m,P){return function(M){return m(P(M))}}function rt(m){var P=-1,M=Array(m.size);return m.forEach(function(V){M[++P]=V}),M}var Fe=Array.prototype,Ge=Function.prototype,Re=Object.prototype,qe=N["__core-js_shared__"],at=Ge.toString,Ne=Re.hasOwnProperty,Et=function(){var m=/[^.]+$/.exec(qe&&qe.keys&&qe.keys.IE_PROTO||"");return m?"Symbol(src)_1."+m:""}(),Tt=Re.toString,zt=RegExp("^"+at.call(Ne).replace(et,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ut=I?N.Buffer:void 0,Dt=N.Symbol,Wt=N.Uint8Array,er=Re.propertyIsEnumerable,Mr=Fe.splice,Jt=Dt?Dt.toStringTag:void 0,Gr=Object.getOwnPropertySymbols,li=Ut?Ut.isBuffer:void 0,Ai=Ve(Object.keys,Object),ct=fr(N,"DataView"),Qe=fr(N,"Map"),ut=fr(N,"Promise"),ht=fr(N,"Set"),it=fr(N,"WeakMap"),Ye=fr(Object,"create"),It=Jr(ct),xt=Jr(Qe),lt=Jr(ut),Pt=Jr(ht),ft=Jr(it),yt=Dt?Dt.prototype:void 0,pt=yt?yt.valueOf:void 0;function Be(m){var P=-1,M=m==null?0:m.length;for(this.clear();++P<M;){var V=m[P];this.set(V[0],V[1])}}function St(){this.__data__=Ye?Ye(null):{},this.size=0}function Ot(m){var P=this.has(m)&&delete this.__data__[m];return this.size-=P?1:0,P}function Bo(m){var P=this.__data__;if(Ye){var M=P[m];return M===n?void 0:M}return Ne.call(P,m)?P[m]:void 0}function ko(m){var P=this.__data__;return Ye?P[m]!==void 0:Ne.call(P,m)}function Ko(m,P){var M=this.__data__;return this.size+=this.has(m)?0:1,M[m]=Ye&&P===void 0?n:P,this}Be.prototype.clear=St,Be.prototype.delete=Ot,Be.prototype.get=Bo,Be.prototype.has=ko,Be.prototype.set=Ko;function mr(m){var P=-1,M=m==null?0:m.length;for(this.clear();++P<M;){var V=m[P];this.set(V[0],V[1])}}function Vo(){this.__data__=[],this.size=0}function Go(m){var P=this.__data__,M=Ci(P,m);if(M<0)return!1;var V=P.length-1;return M==V?P.pop():Mr.call(P,M,1),--this.size,!0}function Wo(m){var P=this.__data__,M=Ci(P,m);return M<0?void 0:P[M][1]}function Jo(m){return Ci(this.__data__,m)>-1}function Qo(m,P){var M=this.__data__,V=Ci(M,m);return V<0?(++this.size,M.push([m,P])):M[V][1]=P,this}mr.prototype.clear=Vo,mr.prototype.delete=Go,mr.prototype.get=Wo,mr.prototype.has=Jo,mr.prototype.set=Qo;function Wr(m){var P=-1,M=m==null?0:m.length;for(this.clear();++P<M;){var V=m[P];this.set(V[0],V[1])}}function Ji(){this.size=0,this.__data__={hash:new Be,map:new(Qe||mr),string:new Be}}function Yo(m){var P=fi(this,m).delete(m);return this.size-=P?1:0,P}function Qi(m){return fi(this,m).get(m)}function Zo(m){return fi(this,m).has(m)}function Xo(m,P){var M=fi(this,m),V=M.size;return M.set(m,P),this.size+=M.size==V?0:1,this}Wr.prototype.clear=Ji,Wr.prototype.delete=Yo,Wr.prototype.get=Qi,Wr.prototype.has=Zo,Wr.prototype.set=Xo;function Yi(m){var P=-1,M=m==null?0:m.length;for(this.__data__=new Wr;++P<M;)this.add(m[P])}function fs(m){return this.__data__.set(m,n),this}function ps(m){return this.__data__.has(m)}Yi.prototype.add=Yi.prototype.push=fs,Yi.prototype.has=ps;function Cr(m){var P=this.__data__=new mr(m);this.size=P.size}function ea(){this.__data__=new mr,this.size=0}function ta(m){var P=this.__data__,M=P.delete(m);return this.size=P.size,M}function ra(m){return this.__data__.get(m)}function ia(m){return this.__data__.has(m)}function ds(m,P){var M=this.__data__;if(M instanceof mr){var V=M.__data__;if(!Qe||V.length<r-1)return V.push([m,P]),this.size=++M.size,this;M=this.__data__=new Wr(V)}return M.set(m,P),this.size=M.size,this}Cr.prototype.clear=ea,Cr.prototype.delete=ta,Cr.prototype.get=ra,Cr.prototype.has=ia,Cr.prototype.set=ds;function gs(m,P){var M=en(m),V=!M&&Os(m),ze=!M&&!V&&On(m),de=!M&&!V&&!ze&&Cs(m),We=M||V||ze||de,Rt=We?bt(m.length,String):[],Pe=Rt.length;for(var Ue in m)(P||Ne.call(m,Ue))&&!(We&&(Ue=="length"||ze&&(Ue=="offset"||Ue=="parent")||de&&(Ue=="buffer"||Ue=="byteLength"||Ue=="byteOffset")||Es(Ue,Pe)))&&Rt.push(Ue);return Rt}function Ci(m,P){for(var M=m.length;M--;)if(Ss(m[M][0],P))return M;return-1}function Pn(m,P,M){var V=P(m);return en(m)?V:Ae(V,M(m))}function Ti(m){return m==null?m===void 0?_t:oe:Jt&&Jt in Object(m)?_s(m):oa(m)}function Sn(m){return Ni(m)&&Ti(m)==g}function $i(m,P,M,V,ze){return m===P?!0:m==null||P==null||!Ni(m)&&!Ni(P)?m!==m&&P!==P:ys(m,P,M,V,$i,ze)}function ys(m,P,M,V,ze,de){var We=en(m),Rt=en(P),Pe=We?v:zr(m),Ue=Rt?v:zr(P);Pe=Pe==g?ce:Pe,Ue=Ue==g?ce:Ue;var vt=Pe==ce,tr=Ue==ce,At=Pe==Ue;if(At&&On(m)){if(!On(P))return!1;We=!0,vt=!1}if(At&&!vt)return de||(de=new Cr),We||Cs(m)?Zi(m,P,M,V,ze,de):sa(m,P,Pe,M,V,ze,de);if(!(M&o)){var Je=vt&&Ne.call(m,"__wrapped__"),Qt=tr&&Ne.call(P,"__wrapped__");if(Je||Qt){var Tr=Je?m.value():m,wr=Qt?P.value():P;return de||(de=new Cr),ze(Tr,wr,M,V,de)}}return At?(de||(de=new Cr),ws(m,P,M,V,ze,de)):!1}function na(m){if(!As(m)||xs(m))return!1;var P=tn(m)?zt:ot;return P.test(Jr(m))}function vs(m){return Ni(m)&&Rs(m.length)&&!!Ee[Ti(m)]}function ms(m){if(!Ps(m))return Ai(m);var P=[];for(var M in Object(m))Ne.call(m,M)&&M!="constructor"&&P.push(M);return P}function Zi(m,P,M,V,ze,de){var We=M&o,Rt=m.length,Pe=P.length;if(Rt!=Pe&&!(We&&Pe>Rt))return!1;var Ue=de.get(m);if(Ue&&de.get(P))return Ue==P;var vt=-1,tr=!0,At=M&c?new Yi:void 0;for(de.set(m,P),de.set(P,m);++vt<Rt;){var Je=m[vt],Qt=P[vt];if(V)var Tr=We?V(Qt,Je,vt,P,m,de):V(Je,Qt,vt,m,P,de);if(Tr!==void 0){if(Tr)continue;tr=!1;break}if(At){if(!Ie(P,function(wr,Ur){if(!tt(At,Ur)&&(Je===wr||ze(Je,wr,M,V,de)))return At.push(Ur)})){tr=!1;break}}else if(!(Je===Qt||ze(Je,Qt,M,V,de))){tr=!1;break}}return de.delete(m),de.delete(P),tr}function sa(m,P,M,V,ze,de,We){switch(M){case qt:if(m.byteLength!=P.byteLength||m.byteOffset!=P.byteOffset)return!1;m=m.buffer,P=P.buffer;case ke:return!(m.byteLength!=P.byteLength||!de(new Wt(m),new Wt(P)));case _:case x:case re:return Ss(+m,+P);case A:return m.name==P.name&&m.message==P.message;case he:case Y:return m==P+"";case J:var Rt=Ke;case pe:var Pe=V&o;if(Rt||(Rt=rt),m.size!=P.size&&!Pe)return!1;var Ue=We.get(m);if(Ue)return Ue==P;V|=c,We.set(m,P);var vt=Zi(Rt(m),Rt(P),V,ze,de,We);return We.delete(m),vt;case ve:if(pt)return pt.call(m)==pt.call(P)}return!1}function ws(m,P,M,V,ze,de){var We=M&o,Rt=Xi(m),Pe=Rt.length,Ue=Xi(P),vt=Ue.length;if(Pe!=vt&&!We)return!1;for(var tr=Pe;tr--;){var At=Rt[tr];if(!(We?At in P:Ne.call(P,At)))return!1}var Je=de.get(m);if(Je&&de.get(P))return Je==P;var Qt=!0;de.set(m,P),de.set(P,m);for(var Tr=We;++tr<Pe;){At=Rt[tr];var wr=m[At],Ur=P[At];if(V)var Rn=We?V(Ur,wr,At,P,m,de):V(wr,Ur,At,m,P,de);if(!(Rn===void 0?wr===Ur||ze(wr,Ur,M,V,de):Rn)){Qt=!1;break}Tr||(Tr=At=="constructor")}if(Qt&&!Tr){var Di=m.constructor,Ft=P.constructor;Di!=Ft&&"constructor"in m&&"constructor"in P&&!(typeof Di=="function"&&Di instanceof Di&&typeof Ft=="function"&&Ft instanceof Ft)&&(Qt=!1)}return de.delete(m),de.delete(P),Qt}function Xi(m){return Pn(m,ua,bs)}function fi(m,P){var M=m.__data__;return Is(P)?M[typeof P=="string"?"string":"hash"]:M.map}function fr(m,P){var M=Te(m,P);return na(M)?M:void 0}function _s(m){var P=Ne.call(m,Jt),M=m[Jt];try{m[Jt]=void 0;var V=!0}catch{}var ze=Tt.call(m);return V&&(P?m[Jt]=M:delete m[Jt]),ze}var bs=Gr?function(m){return m==null?[]:(m=Object(m),Oe(Gr(m),function(P){return er.call(m,P)}))}:Me,zr=Ti;(ct&&zr(new ct(new ArrayBuffer(1)))!=qt||Qe&&zr(new Qe)!=J||ut&&zr(ut.resolve())!=ae||ht&&zr(new ht)!=pe||it&&zr(new it)!=st)&&(zr=function(m){var P=Ti(m),M=P==ce?m.constructor:void 0,V=M?Jr(M):"";if(V)switch(V){case It:return qt;case xt:return J;case lt:return ae;case Pt:return pe;case ft:return st}return P});function Es(m,P){return P=P??l,!!P&&(typeof m=="number"||Ri.test(m))&&m>-1&&m%1==0&&m<P}function Is(m){var P=typeof m;return P=="string"||P=="number"||P=="symbol"||P=="boolean"?m!=="__proto__":m===null}function xs(m){return!!Et&&Et in m}function Ps(m){var P=m&&m.constructor,M=typeof P=="function"&&P.prototype||Re;return m===M}function oa(m){return Tt.call(m)}function Jr(m){if(m!=null){try{return at.call(m)}catch{}try{return m+""}catch{}}return""}function Ss(m,P){return m===P||m!==m&&P!==P}var Os=Sn(function(){return arguments}())?Sn:function(m){return Ni(m)&&Ne.call(m,"callee")&&!er.call(m,"callee")},en=Array.isArray;function aa(m){return m!=null&&Rs(m.length)&&!tn(m)}var On=li||Le;function ca(m,P){return $i(m,P)}function tn(m){if(!As(m))return!1;var P=Ti(m);return P==D||P==C||P==p||P==ee}function Rs(m){return typeof m=="number"&&m>-1&&m%1==0&&m<=l}function As(m){var P=typeof m;return m!=null&&(P=="object"||P=="function")}function Ni(m){return m!=null&&typeof m=="object"}var Cs=me?gt(me):vs;function ua(m){return aa(m)?gs(m):ms(m)}function Me(){return[]}function Le(){return!1}s.exports=ca})(Co,Co.exports);var Db=Co.exports;const Fb=os(Db);function Lb(s,t){return t=t||{},new Promise(function(r,n){var o=new XMLHttpRequest,c=[],l=[],g={},v=function(){return{ok:(o.status/100|0)==2,statusText:o.statusText,status:o.status,url:o.responseURL,text:function(){return Promise.resolve(o.responseText)},json:function(){return Promise.resolve(o.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([o.response]))},clone:v,headers:{keys:function(){return c},entries:function(){return l},get:function(_){return g[_.toLowerCase()]},has:function(_){return _.toLowerCase()in g}}}};for(var p in o.open(t.method||"get",s,!0),o.onload=function(){o.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(_,x,A){c.push(x=x.toLowerCase()),l.push([x,A]),g[x]=g[x]?g[x]+","+A:A}),r(v())},o.onerror=n,o.withCredentials=t.credentials=="include",t.headers)o.setRequestHeader(p,t.headers[p]);o.send(t.body||null)})}const jb=Object.freeze(Object.defineProperty({__proto__:null,default:Lb},Symbol.toStringTag,{value:"Module"})),Nl=$o(jb);var qb=self.fetch||(self.fetch=Nl.default||Nl);const Mb=os(qb);function zb(s,t){if(s.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var o=0;o<s.length;o++){var c=s.charAt(o),l=c.charCodeAt(0);if(r[l]!==255)throw new TypeError(c+" is ambiguous");r[l]=o}var g=s.length,v=s.charAt(0),p=Math.log(g)/Math.log(256),_=Math.log(256)/Math.log(g);function x(C){if(C instanceof Uint8Array||(ArrayBuffer.isView(C)?C=new Uint8Array(C.buffer,C.byteOffset,C.byteLength):Array.isArray(C)&&(C=Uint8Array.from(C))),!(C instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(C.length===0)return"";for(var J=0,re=0,oe=0,ce=C.length;oe!==ce&&C[oe]===0;)oe++,J++;for(var ae=(ce-oe)*_+1>>>0,ee=new Uint8Array(ae);oe!==ce;){for(var he=C[oe],pe=0,Y=ae-1;(he!==0||pe<re)&&Y!==-1;Y--,pe++)he+=256*ee[Y]>>>0,ee[Y]=he%g>>>0,he=he/g>>>0;if(he!==0)throw new Error("Non-zero carry");re=pe,oe++}for(var ve=ae-re;ve!==ae&&ee[ve]===0;)ve++;for(var _t=v.repeat(J);ve<ae;++ve)_t+=s.charAt(ee[ve]);return _t}function A(C){if(typeof C!="string")throw new TypeError("Expected String");if(C.length===0)return new Uint8Array;var J=0;if(C[J]!==" "){for(var re=0,oe=0;C[J]===v;)re++,J++;for(var ce=(C.length-J)*p+1>>>0,ae=new Uint8Array(ce);C[J];){var ee=r[C.charCodeAt(J)];if(ee===255)return;for(var he=0,pe=ce-1;(ee!==0||he<oe)&&pe!==-1;pe--,he++)ee+=g*ae[pe]>>>0,ae[pe]=ee%256>>>0,ee=ee/256>>>0;if(ee!==0)throw new Error("Non-zero carry");oe=he,J++}if(C[J]!==" "){for(var Y=ce-oe;Y!==ce&&ae[Y]===0;)Y++;for(var ve=new Uint8Array(re+(ce-Y)),_t=re;Y!==ce;)ve[_t++]=ae[Y++];return ve}}}function D(C){var J=A(C);if(J)return J;throw new Error(`Non-${t} character`)}return{encode:x,decodeUnsafe:A,decode:D}}var Ub=zb,Hb=Ub;const ep=s=>{if(s instanceof Uint8Array&&s.constructor.name==="Uint8Array")return s;if(s instanceof ArrayBuffer)return new Uint8Array(s);if(ArrayBuffer.isView(s))return new Uint8Array(s.buffer,s.byteOffset,s.byteLength);throw new Error("Unknown type, must be binary type")},Bb=s=>new TextEncoder().encode(s),kb=s=>new TextDecoder().decode(s);class Kb{constructor(t,r,n){this.name=t,this.prefix=r,this.baseEncode=n}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}}class Vb{constructor(t,r,n){if(this.name=t,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=n}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return tp(this,t)}}class Gb{constructor(t){this.decoders=t}or(t){return tp(this,t)}decode(t){const r=t[0],n=this.decoders[r];if(n)return n.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const tp=(s,t)=>new Gb({...s.decoders||{[s.prefix]:s},...t.decoders||{[t.prefix]:t}});class Wb{constructor(t,r,n,o){this.name=t,this.prefix=r,this.baseEncode=n,this.baseDecode=o,this.encoder=new Kb(t,r,n),this.decoder=new Vb(t,r,o)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}}const Uo=({name:s,prefix:t,encode:r,decode:n})=>new Wb(s,t,r,n),ls=({prefix:s,name:t,alphabet:r})=>{const{encode:n,decode:o}=Hb(r,t);return Uo({prefix:s,name:t,encode:n,decode:c=>ep(o(c))})},Jb=(s,t,r,n)=>{const o={};for(let _=0;_<t.length;++_)o[t[_]]=_;let c=s.length;for(;s[c-1]==="=";)--c;const l=new Uint8Array(c*r/8|0);let g=0,v=0,p=0;for(let _=0;_<c;++_){const x=o[s[_]];if(x===void 0)throw new SyntaxError(`Non-${n} character`);v=v<<r|x,g+=r,g>=8&&(g-=8,l[p++]=255&v>>g)}if(g>=r||255&v<<8-g)throw new SyntaxError("Unexpected end of data");return l},Qb=(s,t,r)=>{const n=t[t.length-1]==="=",o=(1<<r)-1;let c="",l=0,g=0;for(let v=0;v<s.length;++v)for(g=g<<8|s[v],l+=8;l>r;)l-=r,c+=t[o&g>>l];if(l&&(c+=t[o&g<<r-l]),n)for(;c.length*r&7;)c+="=";return c},Bt=({name:s,prefix:t,bitsPerChar:r,alphabet:n})=>Uo({prefix:t,name:s,encode(o){return Qb(o,n,r)},decode(o){return Jb(o,n,r,s)}}),Yb=Uo({prefix:"\0",name:"identity",encode:s=>kb(s),decode:s=>Bb(s)});var Zb=Object.freeze({__proto__:null,identity:Yb});const Xb=Bt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var eE=Object.freeze({__proto__:null,base2:Xb});const tE=Bt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var rE=Object.freeze({__proto__:null,base8:tE});const iE=ls({prefix:"9",name:"base10",alphabet:"0123456789"});var nE=Object.freeze({__proto__:null,base10:iE});const sE=Bt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),oE=Bt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var aE=Object.freeze({__proto__:null,base16:sE,base16upper:oE});const cE=Bt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),uE=Bt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),hE=Bt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),lE=Bt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),fE=Bt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),pE=Bt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),dE=Bt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),gE=Bt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),yE=Bt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var vE=Object.freeze({__proto__:null,base32:cE,base32upper:uE,base32pad:hE,base32padupper:lE,base32hex:fE,base32hexupper:pE,base32hexpad:dE,base32hexpadupper:gE,base32z:yE});const mE=ls({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),wE=ls({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var _E=Object.freeze({__proto__:null,base36:mE,base36upper:wE});const bE=ls({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),EE=ls({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var IE=Object.freeze({__proto__:null,base58btc:bE,base58flickr:EE});const xE=Bt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),PE=Bt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),SE=Bt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),OE=Bt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var RE=Object.freeze({__proto__:null,base64:xE,base64pad:PE,base64url:SE,base64urlpad:OE});const rp=Array.from(""),AE=rp.reduce((s,t,r)=>(s[r]=t,s),[]),CE=rp.reduce((s,t,r)=>(s[t.codePointAt(0)]=r,s),[]);function TE(s){return s.reduce((t,r)=>(t+=AE[r],t),"")}function $E(s){const t=[];for(const r of s){const n=CE[r.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${r}`);t.push(n)}return new Uint8Array(t)}const NE=Uo({prefix:"",name:"base256emoji",encode:TE,decode:$E});var DE=Object.freeze({__proto__:null,base256emoji:NE}),FE=ip,Dl=128,LE=127,jE=~LE,qE=Math.pow(2,31);function ip(s,t,r){t=t||[],r=r||0;for(var n=r;s>=qE;)t[r++]=s&255|Dl,s/=128;for(;s&jE;)t[r++]=s&255|Dl,s>>>=7;return t[r]=s|0,ip.bytes=r-n+1,t}var ME=Mc,zE=128,Fl=127;function Mc(s,n){var r=0,n=n||0,o=0,c=n,l,g=s.length;do{if(c>=g)throw Mc.bytes=0,new RangeError("Could not decode varint");l=s[c++],r+=o<28?(l&Fl)<<o:(l&Fl)*Math.pow(2,o),o+=7}while(l>=zE);return Mc.bytes=c-n,r}var UE=Math.pow(2,7),HE=Math.pow(2,14),BE=Math.pow(2,21),kE=Math.pow(2,28),KE=Math.pow(2,35),VE=Math.pow(2,42),GE=Math.pow(2,49),WE=Math.pow(2,56),JE=Math.pow(2,63),QE=function(s){return s<UE?1:s<HE?2:s<BE?3:s<kE?4:s<KE?5:s<VE?6:s<GE?7:s<WE?8:s<JE?9:10},YE={encode:FE,decode:ME,encodingLength:QE},np=YE;const Ll=(s,t,r=0)=>(np.encode(s,t,r),t),jl=s=>np.encodingLength(s),zc=(s,t)=>{const r=t.byteLength,n=jl(s),o=n+jl(r),c=new Uint8Array(o+r);return Ll(s,c,0),Ll(r,c,n),c.set(t,o),new ZE(s,r,t,c)};class ZE{constructor(t,r,n,o){this.code=t,this.size=r,this.digest=n,this.bytes=o}}const sp=({name:s,code:t,encode:r})=>new XE(s,t,r);class XE{constructor(t,r,n){this.name=t,this.code=r,this.encode=n}digest(t){if(t instanceof Uint8Array){const r=this.encode(t);return r instanceof Uint8Array?zc(this.code,r):r.then(n=>zc(this.code,n))}else throw Error("Unknown type, must be binary type")}}const op=s=>async t=>new Uint8Array(await crypto.subtle.digest(s,t)),eI=sp({name:"sha2-256",code:18,encode:op("SHA-256")}),tI=sp({name:"sha2-512",code:19,encode:op("SHA-512")});var rI=Object.freeze({__proto__:null,sha256:eI,sha512:tI});const ap=0,iI="identity",cp=ep,nI=s=>zc(ap,cp(s)),sI={code:ap,name:iI,encode:cp,digest:nI};var oI=Object.freeze({__proto__:null,identity:sI});new TextEncoder,new TextDecoder;const ql={...Zb,...eE,...rE,...nE,...aE,...vE,..._E,...IE,...RE,...DE};({...rI,...oI});function up(s){return globalThis.Buffer!=null?new Uint8Array(s.buffer,s.byteOffset,s.byteLength):s}function aI(s=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?up(globalThis.Buffer.allocUnsafe(s)):new Uint8Array(s)}function hp(s,t,r,n){return{name:s,prefix:t,encoder:{name:s,prefix:t,encode:r},decoder:{decode:n}}}const Ml=hp("utf8","u",s=>"u"+new TextDecoder("utf8").decode(s),s=>new TextEncoder().encode(s.substring(1))),_c=hp("ascii","a",s=>{let t="a";for(let r=0;r<s.length;r++)t+=String.fromCharCode(s[r]);return t},s=>{s=s.substring(1);const t=aI(s.length);for(let r=0;r<s.length;r++)t[r]=s.charCodeAt(r);return t}),cI={utf8:Ml,"utf-8":Ml,hex:ql.base16,latin1:_c,ascii:_c,binary:_c,...ql};function uI(s,t="utf8"){const r=cI[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?up(globalThis.Buffer.from(s,"utf-8")):r.decoder.decode(`${r.prefix}${s}`)}const lp="wc",hI=2,eu="core",xi=`${lp}@2:${eu}:`,lI={name:eu,logger:"error"},fI={database:":memory:"},pI="crypto",zl="client_ed25519_seed",dI=te.ONE_DAY,gI="keychain",yI="0.3",vI="messages",mI="0.3",wI=te.SIX_HOURS,_I="publisher",fp="irn",bI="error",pp="wss://relay.walletconnect.com",Ul="wss://relay.walletconnect.org",EI="relayer",Gt={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},II="_subscription",ai={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},xI=te.ONE_SECOND,PI="2.11.0",SI=1e4,OI="0.3",RI="WALLETCONNECT_CLIENT_ID",Lr={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},AI="subscription",CI="0.3",TI=te.FIVE_SECONDS*1e3,$I="pairing",NI="0.3",Vn={wc_pairingDelete:{req:{ttl:te.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:te.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:te.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:te.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:te.ONE_DAY,prompt:!1,tag:0},res:{ttl:te.ONE_DAY,prompt:!1,tag:0}}},Zn={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},Kr={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},DI="history",FI="0.3",LI="expirer",Or={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},jI="0.3",bc="verify-api",_n="https://verify.walletconnect.com",Uc="https://verify.walletconnect.org",qI=[_n,Uc],MI="echo",zI="https://echo.walletconnect.com";class UI{constructor(t,r){this.core=t,this.logger=r,this.keychain=new Map,this.name=gI,this.version=yI,this.initialized=!1,this.storagePrefix=xi,this.init=async()=>{if(!this.initialized){const n=await this.getKeyChain();typeof n<"u"&&(this.keychain=n),this.initialized=!0}},this.has=n=>(this.isInitialized(),this.keychain.has(n)),this.set=async(n,o)=>{this.isInitialized(),this.keychain.set(n,o),await this.persist()},this.get=n=>{this.isInitialized();const o=this.keychain.get(n);if(typeof o>"u"){const{message:c}=G("NO_MATCHING_KEY",`${this.name}: ${n}`);throw new Error(c)}return o},this.del=async n=>{this.isInitialized(),this.keychain.delete(n),await this.persist()},this.core=t,this.logger=lr(r,this.name)}get context(){return hr(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(t){await this.core.storage.setItem(this.storageKey,xf(t))}async getKeyChain(){const t=await this.core.storage.getItem(this.storageKey);return typeof t<"u"?Pf(t):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:t}=G("NOT_INITIALIZED",this.name);throw new Error(t)}}}class HI{constructor(t,r,n){this.core=t,this.logger=r,this.name=pI,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=o=>(this.isInitialized(),this.keychain.has(o)),this.getClientId=async()=>{this.isInitialized();const o=await this.getClientSeed(),c=Pl(o);return Kf(c.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const o=r1();return this.setPrivateKey(o.publicKey,o.privateKey)},this.signJWT=async o=>{this.isInitialized();const c=await this.getClientSeed(),l=Pl(c),g=Ac();return await K_(g,o,dI,l)},this.generateSharedKey=(o,c,l)=>{this.isInitialized();const g=this.getPrivateKey(o),v=i1(g,c);return this.setSymKey(v,l)},this.setSymKey=async(o,c)=>{this.isInitialized();const l=c||n1(o);return await this.keychain.set(l,o),l},this.deleteKeyPair=async o=>{this.isInitialized(),await this.keychain.del(o)},this.deleteSymKey=async o=>{this.isInitialized(),await this.keychain.del(o)},this.encode=async(o,c,l)=>{this.isInitialized();const g=s1(l),v=Ki(c);if(nl(g)){const A=g.senderPublicKey,D=g.receiverPublicKey;o=await this.generateSharedKey(A,D)}const p=this.getSymKey(o),{type:_,senderPublicKey:x}=g;return o1({type:_,symKey:p,message:v,senderPublicKey:x})},this.decode=async(o,c,l)=>{this.isInitialized();const g=a1(c,l);if(nl(g)){const v=g.receiverPublicKey,p=g.senderPublicKey;o=await this.generateSharedKey(v,p)}try{const v=this.getSymKey(o),p=c1({symKey:v,encoded:c});return cs(p)}catch(v){this.logger.error(`Failed to decode message from topic: '${o}', clientId: '${await this.getClientId()}'`),this.logger.error(v)}},this.getPayloadType=o=>{const c=sl(o);return u1(c.type)},this.getPayloadSenderPublicKey=o=>{const c=sl(o);return c.senderPublicKey?No(c.senderPublicKey,h1):void 0},this.core=t,this.logger=lr(r,this.name),this.keychain=n||new UI(this.core,this.logger)}get context(){return hr(this.logger)}async setPrivateKey(t,r){return await this.keychain.set(t,r),t}getPrivateKey(t){return this.keychain.get(t)}async getClientSeed(){let t="";try{t=this.keychain.get(zl)}catch{t=Ac(),await this.keychain.set(zl,t)}return uI(t,"base16")}getSymKey(t){return this.keychain.get(t)}isInitialized(){if(!this.initialized){const{message:t}=G("NOT_INITIALIZED",this.name);throw new Error(t)}}}class BI extends E_{constructor(t,r){super(t,r),this.logger=t,this.core=r,this.messages=new Map,this.name=vI,this.version=mI,this.initialized=!1,this.storagePrefix=xi,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const n=await this.getRelayerMessages();typeof n<"u"&&(this.messages=n),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(n){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(n)}finally{this.initialized=!0}}},this.set=async(n,o)=>{this.isInitialized();const c=bn(o);let l=this.messages.get(n);return typeof l>"u"&&(l={}),typeof l[c]<"u"||(l[c]=o,this.messages.set(n,l),await this.persist()),c},this.get=n=>{this.isInitialized();let o=this.messages.get(n);return typeof o>"u"&&(o={}),o},this.has=(n,o)=>{this.isInitialized();const c=this.get(n),l=bn(o);return typeof c[l]<"u"},this.del=async n=>{this.isInitialized(),this.messages.delete(n),await this.persist()},this.logger=lr(t,this.name),this.core=r}get context(){return hr(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setRelayerMessages(t){await this.core.storage.setItem(this.storageKey,xf(t))}async getRelayerMessages(){const t=await this.core.storage.getItem(this.storageKey);return typeof t<"u"?Pf(t):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:t}=G("NOT_INITIALIZED",this.name);throw new Error(t)}}}class kI extends I_{constructor(t,r){super(t,r),this.relayer=t,this.logger=r,this.events=new ur.EventEmitter,this.name=_I,this.queue=new Map,this.publishTimeout=te.toMiliseconds(te.TEN_SECONDS),this.needsTransportRestart=!1,this.publish=async(n,o,c)=>{var l;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:o,opts:c}});try{const g=(c==null?void 0:c.ttl)||wI,v=Cc(c),p=(c==null?void 0:c.prompt)||!1,_=(c==null?void 0:c.tag)||0,x=(c==null?void 0:c.id)||Zc().toString(),A={topic:n,message:o,opts:{ttl:g,relay:v,prompt:p,tag:_,id:x}},D=setTimeout(()=>this.queue.set(x,A),this.publishTimeout);try{await await ts(this.rpcPublish(n,o,g,v,p,_,x),this.publishTimeout,"Failed to publish payload, please try again."),this.removeRequestFromQueue(x),this.relayer.events.emit(Gt.publish,A)}catch(C){if(this.logger.debug("Publishing Payload stalled"),this.needsTransportRestart=!0,(l=c==null?void 0:c.internal)!=null&&l.throwOnFailedPublish)throw this.removeRequestFromQueue(x),C;return}finally{clearTimeout(D)}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:o,opts:c}})}catch(g){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(g),g}},this.on=(n,o)=>{this.events.on(n,o)},this.once=(n,o)=>{this.events.once(n,o)},this.off=(n,o)=>{this.events.off(n,o)},this.removeListener=(n,o)=>{this.events.removeListener(n,o)},this.relayer=t,this.logger=lr(r,this.name),this.registerEventListeners()}get context(){return hr(this.logger)}rpcPublish(t,r,n,o,c,l,g){var v,p,_,x;const A={method:xo(o.protocol).publish,params:{topic:t,message:r,ttl:n,prompt:c,tag:l},id:g};return Ii((v=A.params)==null?void 0:v.prompt)&&((p=A.params)==null||delete p.prompt),Ii((_=A.params)==null?void 0:_.tag)&&((x=A.params)==null||delete x.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:A}),this.relayer.request(A)}removeRequestFromQueue(t){this.queue.delete(t)}checkQueue(){this.queue.forEach(async t=>{const{topic:r,message:n,opts:o}=t;await this.publish(r,n,o)})}registerEventListeners(){this.relayer.core.heartbeat.on(xn.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(Gt.connection_stalled);return}this.checkQueue()}),this.relayer.on(Gt.message_ack,t=>{this.removeRequestFromQueue(t.id.toString())})}}class KI{constructor(){this.map=new Map,this.set=(t,r)=>{const n=this.get(t);this.exists(t,r)||this.map.set(t,[...n,r])},this.get=t=>this.map.get(t)||[],this.exists=(t,r)=>this.get(t).includes(r),this.delete=(t,r)=>{if(typeof r>"u"){this.map.delete(t);return}if(!this.map.has(t))return;const n=this.get(t);if(!this.exists(t,r))return;const o=n.filter(c=>c!==r);if(!o.length){this.map.delete(t);return}this.map.set(t,o)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var VI=Object.defineProperty,GI=Object.defineProperties,WI=Object.getOwnPropertyDescriptors,Hl=Object.getOwnPropertySymbols,JI=Object.prototype.hasOwnProperty,QI=Object.prototype.propertyIsEnumerable,Bl=(s,t,r)=>t in s?VI(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,Gn=(s,t)=>{for(var r in t||(t={}))JI.call(t,r)&&Bl(s,r,t[r]);if(Hl)for(var r of Hl(t))QI.call(t,r)&&Bl(s,r,t[r]);return s},Ec=(s,t)=>GI(s,WI(t));class YI extends S_{constructor(t,r){super(t,r),this.relayer=t,this.logger=r,this.subscriptions=new Map,this.topicMap=new KI,this.events=new ur.EventEmitter,this.name=AI,this.version=CI,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=xi,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(n,o)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:o}});try{const c=Cc(o),l={topic:n,relay:c};this.pending.set(n,l);const g=await this.rpcSubscribe(n,c);return this.onSubscribe(g,l),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:o}}),g}catch(c){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(c),c}},this.unsubscribe=async(n,o)=>{await this.restartToComplete(),this.isInitialized(),typeof(o==null?void 0:o.id)<"u"?await this.unsubscribeById(n,o.id,o):await this.unsubscribeByTopic(n,o)},this.isSubscribed=async n=>this.topics.includes(n)?!0:await new Promise((o,c)=>{const l=new te.Watch;l.start(this.pendingSubscriptionWatchLabel);const g=setInterval(()=>{!this.pending.has(n)&&this.topics.includes(n)&&(clearInterval(g),l.stop(this.pendingSubscriptionWatchLabel),o(!0)),l.elapsed(this.pendingSubscriptionWatchLabel)>=TI&&(clearInterval(g),l.stop(this.pendingSubscriptionWatchLabel),c(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1),this.on=(n,o)=>{this.events.on(n,o)},this.once=(n,o)=>{this.events.once(n,o)},this.off=(n,o)=>{this.events.off(n,o)},this.removeListener=(n,o)=>{this.events.removeListener(n,o)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=t,this.logger=lr(r,this.name),this.clientId=""}get context(){return hr(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(t,r){let n=!1;try{n=this.getSubscription(t).topic===r}catch{}return n}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(t,r){const n=this.topicMap.get(t);await Promise.all(n.map(async o=>await this.unsubscribeById(t,o,r)))}async unsubscribeById(t,r,n){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:r,opts:n}});try{const o=Cc(n);await this.rpcUnsubscribe(t,r,o);const c=Vt("USER_DISCONNECTED",`${this.name}, ${t}`);await this.onUnsubscribe(t,r,c),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:r,opts:n}})}catch(o){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(o),o}}async rpcSubscribe(t,r){const n={method:xo(r.protocol).subscribe,params:{topic:t}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{await await ts(this.relayer.request(n),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(Gt.connection_stalled)}return bn(t+this.clientId)}async rpcBatchSubscribe(t){if(!t.length)return;const r=t[0].relay,n={method:xo(r.protocol).batchSubscribe,params:{topics:t.map(o=>o.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{return await await ts(this.relayer.request(n),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(Gt.connection_stalled)}}rpcUnsubscribe(t,r,n){const o={method:xo(n.protocol).unsubscribe,params:{topic:t,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:o}),this.relayer.request(o)}onSubscribe(t,r){this.setSubscription(t,Ec(Gn({},r),{id:t})),this.pending.delete(r.topic)}onBatchSubscribe(t){t.length&&t.forEach(r=>{this.setSubscription(r.id,Gn({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(t,r,n){this.events.removeAllListeners(r),this.hasSubscription(r,t)&&this.deleteSubscription(r,n),await this.relayer.messages.del(t)}async setRelayerSubscriptions(t){await this.relayer.core.storage.setItem(this.storageKey,t)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(t,r){this.subscriptions.has(t)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:t,subscription:r}),this.addSubscription(t,r))}addSubscription(t,r){this.subscriptions.set(t,Gn({},r)),this.topicMap.set(r.topic,t),this.events.emit(Lr.created,r)}getSubscription(t){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:t});const r=this.subscriptions.get(t);if(!r){const{message:n}=G("NO_MATCHING_KEY",`${this.name}: ${t}`);throw new Error(n)}return r}deleteSubscription(t,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:t,reason:r});const n=this.getSubscription(t);this.subscriptions.delete(t),this.topicMap.delete(n.topic,t),this.events.emit(Lr.deleted,Ec(Gn({},n),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Lr.sync)}async reset(){if(this.cached.length){const t=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<t;r++){const n=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(n)}}this.events.emit(Lr.resubscribed)}async restore(){try{const t=await this.getRelayerSubscriptions();if(typeof t>"u"||!t.length)return;if(this.subscriptions.size){const{message:r}=G("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(t){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(t)}}async batchSubscribe(t){if(!t.length)return;const r=await this.rpcBatchSubscribe(t);In(r)&&this.onBatchSubscribe(r.map((n,o)=>Ec(Gn({},t[o]),{id:n})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(!this.initialized||this.relayer.transportExplicitlyClosed)return;const t=[];this.pending.forEach(r=>{t.push(r)}),await this.batchSubscribe(t)}registerEventListeners(){this.relayer.core.heartbeat.on(xn.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(Gt.connect,async()=>{await this.onConnect()}),this.relayer.on(Gt.disconnect,()=>{this.onDisconnect()}),this.events.on(Lr.created,async t=>{const r=Lr.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),await this.persist()}),this.events.on(Lr.deleted,async t=>{const r=Lr.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:t}=G("NOT_INITIALIZED",this.name);throw new Error(t)}}async restartToComplete(){this.restartInProgress&&await new Promise(t=>{const r=setInterval(()=>{this.restartInProgress||(clearInterval(r),t())},this.pollingInterval)})}}var ZI=Object.defineProperty,kl=Object.getOwnPropertySymbols,XI=Object.prototype.hasOwnProperty,ex=Object.prototype.propertyIsEnumerable,Kl=(s,t,r)=>t in s?ZI(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,tx=(s,t)=>{for(var r in t||(t={}))XI.call(t,r)&&Kl(s,r,t[r]);if(kl)for(var r of kl(t))ex.call(t,r)&&Kl(s,r,t[r]);return s};class rx extends x_{constructor(t){super(t),this.protocol="wc",this.version=2,this.events=new ur.EventEmitter,this.name=EI,this.transportExplicitlyClosed=!1,this.initialized=!1,this.connectionAttemptInProgress=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.hasExperiencedNetworkDisruption=!1,this.request=async r=>{this.logger.debug("Publishing Request Payload");try{return await this.toEstablishConnection(),await this.provider.request(r)}catch(n){throw this.logger.debug("Failed to Publish Request"),this.logger.error(n),n}},this.onPayloadHandler=r=>{this.onProviderPayload(r)},this.onConnectHandler=()=>{this.events.emit(Gt.connect)},this.onDisconnectHandler=()=>{this.onProviderDisconnect()},this.onProviderErrorHandler=r=>{this.logger.error(r),this.events.emit(Gt.error,r),this.logger.info("Fatal socket error received, closing transport"),this.transportClose()},this.registerProviderListeners=()=>{this.provider.on(ai.payload,this.onPayloadHandler),this.provider.on(ai.connect,this.onConnectHandler),this.provider.on(ai.disconnect,this.onDisconnectHandler),this.provider.on(ai.error,this.onProviderErrorHandler)},this.core=t.core,this.logger=typeof t.logger<"u"&&typeof t.logger!="string"?lr(t.logger,this.name):jo(qo({level:t.logger||bI})),this.messages=new BI(this.logger,t.core),this.subscriber=new YI(this,this.logger),this.publisher=new kI(this,this.logger),this.relayUrl=(t==null?void 0:t.relayUrl)||pp,this.projectId=t.projectId,this.bundleId=l1(),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${Ul}...`),await this.restartTransport(Ul)}this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},SI)}get context(){return hr(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(t,r,n){this.isInitialized(),await this.publisher.publish(t,r,n),await this.recordMessageEvent({topic:t,message:r,publishedAt:Date.now()})}async subscribe(t,r){var n;this.isInitialized();let o=((n=this.subscriber.topicMap.get(t))==null?void 0:n[0])||"";if(o)return o;let c;const l=g=>{g.topic===t&&(this.subscriber.off(Lr.created,l),c())};return await Promise.all([new Promise(g=>{c=g,this.subscriber.on(Lr.created,l)}),new Promise(async g=>{o=await this.subscriber.subscribe(t,r),g()})]),o}async unsubscribe(t,r){this.isInitialized(),await this.subscriber.unsubscribe(t,r)}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async transportClose(){this.transportExplicitlyClosed=!0,this.hasExperiencedNetworkDisruption&&this.connected?await ts(this.provider.disconnect(),1e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.connected&&await this.provider.disconnect()}async transportOpen(t){if(this.transportExplicitlyClosed=!1,await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress){t&&t!==this.relayUrl&&(this.relayUrl=t,await this.transportClose(),await this.createProvider()),this.connectionAttemptInProgress=!0;try{await Promise.all([new Promise(r=>{if(!this.initialized)return r();this.subscriber.once(Lr.resubscribed,()=>{r()})}),new Promise(async(r,n)=>{try{await ts(this.provider.connect(),1e4,`Socket stalled when trying to connect to ${this.relayUrl}`)}catch(o){n(o);return}r()})])}catch(r){this.logger.error(r);const n=r;if(!this.isConnectionStalled(n.message))throw r;this.provider.events.emit(ai.disconnect)}finally{this.connectionAttemptInProgress=!1,this.hasExperiencedNetworkDisruption=!1}}}async restartTransport(t){await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress&&(this.relayUrl=t||this.relayUrl,await this.transportClose(),await this.createProvider(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await ol())throw new Error("No internet connection detected. Please restart your network and try again.")}isConnectionStalled(t){return this.staleConnectionErrors.some(r=>t.includes(r))}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const t=await this.core.crypto.signJWT(this.relayUrl);this.provider=new Ab(new Nb(f1({sdkVersion:PI,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:t,useOnCloseEvent:!0,bundleId:this.bundleId}))),this.registerProviderListeners()}async recordMessageEvent(t){const{topic:r,message:n}=t;await this.messages.set(r,n)}async shouldIgnoreMessageEvent(t){const{topic:r,message:n}=t;if(!n||n.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${n}`),!0;if(!await this.subscriber.isSubscribed(r))return this.logger.debug(`Ignoring message for non-subscribed topic ${r}`),!0;const o=this.messages.has(r,n);return o&&this.logger.debug(`Ignoring duplicate message: ${n}`),o}async onProviderPayload(t){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:t}),Xc(t)){if(!t.method.endsWith(II))return;const r=t.params,{topic:n,message:o,publishedAt:c}=r.data,l={topic:n,message:o,publishedAt:c};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(tx({type:"event",event:r.id},l)),this.events.emit(r.id,l),await this.acknowledgePayload(t),await this.onMessageEvent(l)}else hs(t)&&this.events.emit(Gt.message_ack,t)}async onMessageEvent(t){await this.shouldIgnoreMessageEvent(t)||(this.events.emit(Gt.message,t),await this.recordMessageEvent(t))}async acknowledgePayload(t){const r=Mo(t.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off(ai.payload,this.onPayloadHandler),this.provider.off(ai.connect,this.onConnectHandler),this.provider.off(ai.disconnect,this.onDisconnectHandler),this.provider.off(ai.error,this.onProviderErrorHandler)}async registerEventListeners(){this.events.on(Gt.connection_stalled,()=>{this.restartTransport().catch(r=>this.logger.error(r))});let t=await ol();p1(async r=>{this.initialized&&t!==r&&(t=r,r?await this.restartTransport().catch(n=>this.logger.error(n)):(this.hasExperiencedNetworkDisruption=!0,await this.transportClose().catch(n=>this.logger.error(n))))})}onProviderDisconnect(){this.events.emit(Gt.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||(this.logger.info("attemptToReconnect called. Connecting..."),setTimeout(async()=>{await this.restartTransport().catch(t=>this.logger.error(t))},te.toMiliseconds(xI)))}isInitialized(){if(!this.initialized){const{message:t}=G("NOT_INITIALIZED",this.name);throw new Error(t)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectionAttemptInProgress)return await new Promise(t=>{const r=setInterval(()=>{this.connected&&(clearInterval(r),t())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var ix=Object.defineProperty,Vl=Object.getOwnPropertySymbols,nx=Object.prototype.hasOwnProperty,sx=Object.prototype.propertyIsEnumerable,Gl=(s,t,r)=>t in s?ix(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,Wl=(s,t)=>{for(var r in t||(t={}))nx.call(t,r)&&Gl(s,r,t[r]);if(Vl)for(var r of Vl(t))sx.call(t,r)&&Gl(s,r,t[r]);return s};class Ho extends P_{constructor(t,r,n,o=xi,c=void 0){super(t,r,n,o),this.core=t,this.logger=r,this.name=n,this.map=new Map,this.version=OI,this.cached=[],this.initialized=!1,this.storagePrefix=xi,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(l=>{this.getKey&&l!==null&&!Ii(l)?this.map.set(this.getKey(l),l):e1(l)?this.map.set(l.id,l):t1(l)&&this.map.set(l.topic,l)}),this.cached=[],this.initialized=!0)},this.set=async(l,g)=>{this.isInitialized(),this.map.has(l)?await this.update(l,g):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:l,value:g}),this.map.set(l,g),await this.persist())},this.get=l=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:l}),this.getData(l)),this.getAll=l=>(this.isInitialized(),l?this.values.filter(g=>Object.keys(l).every(v=>Fb(g[v],l[v]))):this.values),this.update=async(l,g)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:l,update:g});const v=Wl(Wl({},this.getData(l)),g);this.map.set(l,v),await this.persist()},this.delete=async(l,g)=>{this.isInitialized(),this.map.has(l)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:l,reason:g}),this.map.delete(l),await this.persist())},this.logger=lr(r,this.name),this.storagePrefix=o,this.getKey=c}get context(){return hr(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(t){await this.core.storage.setItem(this.storageKey,t)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(t){const r=this.map.get(t);if(!r){const{message:n}=G("NO_MATCHING_KEY",`${this.name}: ${t}`);throw this.logger.error(n),new Error(n)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const t=await this.getDataStore();if(typeof t>"u"||!t.length)return;if(this.map.size){const{message:r}=G("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(t){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(t)}}isInitialized(){if(!this.initialized){const{message:t}=G("NOT_INITIALIZED",this.name);throw new Error(t)}}}class ox{constructor(t,r){this.core=t,this.logger=r,this.name=$I,this.version=NI,this.events=new Wc,this.initialized=!1,this.storagePrefix=xi,this.ignoredPayloadTypes=[bf],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:n})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...n])]},this.create=async()=>{this.isInitialized();const n=Ac(),o=await this.core.crypto.setSymKey(n),c=jr(te.FIVE_MINUTES),l={protocol:fp},g={topic:o,expiry:c,relay:l,active:!1},v=d1({protocol:this.core.protocol,version:this.core.version,topic:o,symKey:n,relay:l});return await this.pairings.set(o,g),await this.core.relayer.subscribe(o),this.core.expirer.set(o,c),{topic:o,uri:v}},this.pair=async n=>{this.isInitialized(),this.isValidPair(n);const{topic:o,symKey:c,relay:l}=al(n.uri);let g;if(this.pairings.keys.includes(o)&&(g=this.pairings.get(o),g.active))throw new Error(`Pairing already exists: ${o}. Please try again with a new connection URI.`);const v=jr(te.FIVE_MINUTES),p={topic:o,relay:l,expiry:v,active:!1};return await this.pairings.set(o,p),this.core.expirer.set(o,v),n.activatePairing&&await this.activate({topic:o}),this.events.emit(Zn.create,p),this.core.crypto.keychain.has(o)||(await this.core.crypto.setSymKey(c,o),await this.core.relayer.subscribe(o,{relay:l})),p},this.activate=async({topic:n})=>{this.isInitialized();const o=jr(te.THIRTY_DAYS);await this.pairings.update(n,{active:!0,expiry:o}),this.core.expirer.set(n,o)},this.ping=async n=>{this.isInitialized(),await this.isValidPing(n);const{topic:o}=n;if(this.pairings.keys.includes(o)){const c=await this.sendRequest(o,"wc_pairingPing",{}),{done:l,resolve:g,reject:v}=mn();this.events.once(Ct("pairing_ping",c),({error:p})=>{p?v(p):g()}),await l()}},this.updateExpiry=async({topic:n,expiry:o})=>{this.isInitialized(),await this.pairings.update(n,{expiry:o})},this.updateMetadata=async({topic:n,metadata:o})=>{this.isInitialized(),await this.pairings.update(n,{peerMetadata:o})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async n=>{this.isInitialized(),await this.isValidDisconnect(n);const{topic:o}=n;this.pairings.keys.includes(o)&&(await this.sendRequest(o,"wc_pairingDelete",Vt("USER_DISCONNECTED")),await this.deletePairing(o))},this.sendRequest=async(n,o,c)=>{const l=ki(o,c),g=await this.core.crypto.encode(n,l),v=Vn[o].req;return this.core.history.set(n,l),this.core.relayer.publish(n,g,v),l.id},this.sendResult=async(n,o,c)=>{const l=Mo(n,c),g=await this.core.crypto.encode(o,l),v=await this.core.history.get(o,n),p=Vn[v.request.method].res;await this.core.relayer.publish(o,g,p),await this.core.history.resolve(l)},this.sendError=async(n,o,c)=>{const l=zo(n,c),g=await this.core.crypto.encode(o,l),v=await this.core.history.get(o,n),p=Vn[v.request.method]?Vn[v.request.method].res:Vn.unregistered_method.res;await this.core.relayer.publish(o,g,p),await this.core.history.resolve(l)},this.deletePairing=async(n,o)=>{await this.core.relayer.unsubscribe(n),await Promise.all([this.pairings.delete(n,Vt("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(n),o?Promise.resolve():this.core.expirer.del(n)])},this.cleanup=async()=>{const n=this.pairings.getAll().filter(o=>Ei(o.expiry));await Promise.all(n.map(o=>this.deletePairing(o.topic)))},this.onRelayEventRequest=n=>{const{topic:o,payload:c}=n;switch(c.method){case"wc_pairingPing":return this.onPairingPingRequest(o,c);case"wc_pairingDelete":return this.onPairingDeleteRequest(o,c);default:return this.onUnknownRpcMethodRequest(o,c)}},this.onRelayEventResponse=async n=>{const{topic:o,payload:c}=n,l=(await this.core.history.get(o,c.id)).request.method;switch(l){case"wc_pairingPing":return this.onPairingPingResponse(o,c);default:return this.onUnknownRpcMethodResponse(l)}},this.onPairingPingRequest=async(n,o)=>{const{id:c}=o;try{this.isValidPing({topic:n}),await this.sendResult(c,n,!0),this.events.emit(Zn.ping,{id:c,topic:n})}catch(l){await this.sendError(c,n,l),this.logger.error(l)}},this.onPairingPingResponse=(n,o)=>{const{id:c}=o;setTimeout(()=>{ui(o)?this.events.emit(Ct("pairing_ping",c),{}):Rr(o)&&this.events.emit(Ct("pairing_ping",c),{error:o.error})},500)},this.onPairingDeleteRequest=async(n,o)=>{const{id:c}=o;try{this.isValidDisconnect({topic:n}),await this.deletePairing(n),this.events.emit(Zn.delete,{id:c,topic:n})}catch(l){await this.sendError(c,n,l),this.logger.error(l)}},this.onUnknownRpcMethodRequest=async(n,o)=>{const{id:c,method:l}=o;try{if(this.registeredMethods.includes(l))return;const g=Vt("WC_METHOD_UNSUPPORTED",l);await this.sendError(c,n,g),this.logger.error(g)}catch(g){await this.sendError(c,n,g),this.logger.error(g)}},this.onUnknownRpcMethodResponse=n=>{this.registeredMethods.includes(n)||this.logger.error(Vt("WC_METHOD_UNSUPPORTED",n))},this.isValidPair=n=>{var o;if(!cr(n)){const{message:l}=G("MISSING_OR_INVALID",`pair() params: ${n}`);throw new Error(l)}if(!g1(n.uri)){const{message:l}=G("MISSING_OR_INVALID",`pair() uri: ${n.uri}`);throw new Error(l)}const c=al(n.uri);if(!((o=c==null?void 0:c.relay)!=null&&o.protocol)){const{message:l}=G("MISSING_OR_INVALID","pair() uri#relay-protocol");throw new Error(l)}if(!(c!=null&&c.symKey)){const{message:l}=G("MISSING_OR_INVALID","pair() uri#symKey");throw new Error(l)}},this.isValidPing=async n=>{if(!cr(n)){const{message:c}=G("MISSING_OR_INVALID",`ping() params: ${n}`);throw new Error(c)}const{topic:o}=n;await this.isValidPairingTopic(o)},this.isValidDisconnect=async n=>{if(!cr(n)){const{message:c}=G("MISSING_OR_INVALID",`disconnect() params: ${n}`);throw new Error(c)}const{topic:o}=n;await this.isValidPairingTopic(o)},this.isValidPairingTopic=async n=>{if(!wn(n,!1)){const{message:o}=G("MISSING_OR_INVALID",`pairing topic should be a string: ${n}`);throw new Error(o)}if(!this.pairings.keys.includes(n)){const{message:o}=G("NO_MATCHING_KEY",`pairing topic doesn't exist: ${n}`);throw new Error(o)}if(Ei(this.pairings.get(n).expiry)){await this.deletePairing(n);const{message:o}=G("EXPIRED",`pairing topic: ${n}`);throw new Error(o)}},this.core=t,this.logger=lr(r,this.name),this.pairings=new Ho(this.core,this.logger,this.name,this.storagePrefix)}get context(){return hr(this.logger)}isInitialized(){if(!this.initialized){const{message:t}=G("NOT_INITIALIZED",this.name);throw new Error(t)}}registerRelayerEvents(){this.core.relayer.on(Gt.message,async t=>{const{topic:r,message:n}=t;if(!this.pairings.keys.includes(r)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(n)))return;const o=await this.core.crypto.decode(r,n);try{Xc(o)?(this.core.history.set(r,o),this.onRelayEventRequest({topic:r,payload:o})):hs(o)&&(await this.core.history.resolve(o),await this.onRelayEventResponse({topic:r,payload:o}),this.core.history.delete(r,o.id))}catch(c){this.logger.error(c)}})}registerExpirerEvents(){this.core.expirer.on(Or.expired,async t=>{const{topic:r}=Ef(t.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit(Zn.expire,{topic:r}))})}}class ax extends b_{constructor(t,r){super(t,r),this.core=t,this.logger=r,this.records=new Map,this.events=new ur.EventEmitter,this.name=DI,this.version=FI,this.cached=[],this.initialized=!1,this.storagePrefix=xi,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.records.set(n.id,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(n,o,c)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:n,request:o,chainId:c}),this.records.has(o.id))return;const l={id:o.id,topic:n,request:{method:o.method,params:o.params||null},chainId:c,expiry:jr(te.THIRTY_DAYS)};this.records.set(l.id,l),this.events.emit(Kr.created,l)},this.resolve=async n=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:n}),!this.records.has(n.id))return;const o=await this.getRecord(n.id);typeof o.response>"u"&&(o.response=Rr(n)?{error:n.error}:{result:n.result},this.records.set(o.id,o),this.events.emit(Kr.updated,o))},this.get=async(n,o)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:n,id:o}),await this.getRecord(o)),this.delete=(n,o)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:o}),this.values.forEach(c=>{if(c.topic===n){if(typeof o<"u"&&c.id!==o)return;this.records.delete(c.id),this.events.emit(Kr.deleted,c)}})},this.exists=async(n,o)=>(this.isInitialized(),this.records.has(o)?(await this.getRecord(o)).topic===n:!1),this.on=(n,o)=>{this.events.on(n,o)},this.once=(n,o)=>{this.events.once(n,o)},this.off=(n,o)=>{this.events.off(n,o)},this.removeListener=(n,o)=>{this.events.removeListener(n,o)},this.logger=lr(r,this.name)}get context(){return hr(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const t=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const n={topic:r.topic,request:ki(r.request.method,r.request.params,r.id),chainId:r.chainId};return t.push(n)}),t}async setJsonRpcRecords(t){await this.core.storage.setItem(this.storageKey,t)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(t){this.isInitialized();const r=this.records.get(t);if(!r){const{message:n}=G("NO_MATCHING_KEY",`${this.name}: ${t}`);throw new Error(n)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Kr.sync)}async restore(){try{const t=await this.getJsonRpcRecords();if(typeof t>"u"||!t.length)return;if(this.records.size){const{message:r}=G("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(t){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(t)}}registerEventListeners(){this.events.on(Kr.created,t=>{const r=Kr.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.events.on(Kr.updated,t=>{const r=Kr.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.events.on(Kr.deleted,t=>{const r=Kr.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.core.heartbeat.on(xn.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(t=>{te.toMiliseconds(t.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${t.id}`),this.delete(t.topic,t.id))})}catch(t){this.logger.warn(t)}}isInitialized(){if(!this.initialized){const{message:t}=G("NOT_INITIALIZED",this.name);throw new Error(t)}}}class cx extends O_{constructor(t,r){super(t,r),this.core=t,this.logger=r,this.expirations=new Map,this.events=new ur.EventEmitter,this.name=LI,this.version=jI,this.cached=[],this.initialized=!1,this.storagePrefix=xi,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.expirations.set(n.target,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=n=>{try{const o=this.formatTarget(n);return typeof this.getExpiration(o)<"u"}catch{return!1}},this.set=(n,o)=>{this.isInitialized();const c=this.formatTarget(n),l={target:c,expiry:o};this.expirations.set(c,l),this.checkExpiry(c,l),this.events.emit(Or.created,{target:c,expiration:l})},this.get=n=>{this.isInitialized();const o=this.formatTarget(n);return this.getExpiration(o)},this.del=n=>{if(this.isInitialized(),this.has(n)){const o=this.formatTarget(n),c=this.getExpiration(o);this.expirations.delete(o),this.events.emit(Or.deleted,{target:o,expiration:c})}},this.on=(n,o)=>{this.events.on(n,o)},this.once=(n,o)=>{this.events.once(n,o)},this.off=(n,o)=>{this.events.off(n,o)},this.removeListener=(n,o)=>{this.events.removeListener(n,o)},this.logger=lr(r,this.name)}get context(){return hr(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(t){if(typeof t=="string")return y1(t);if(typeof t=="number")return v1(t);const{message:r}=G("UNKNOWN_TYPE",`Target type: ${typeof t}`);throw new Error(r)}async setExpirations(t){await this.core.storage.setItem(this.storageKey,t)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Or.sync)}async restore(){try{const t=await this.getExpirations();if(typeof t>"u"||!t.length)return;if(this.expirations.size){const{message:r}=G("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(t){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(t)}}getExpiration(t){const r=this.expirations.get(t);if(!r){const{message:n}=G("NO_MATCHING_KEY",`${this.name}: ${t}`);throw this.logger.error(n),new Error(n)}return r}checkExpiry(t,r){const{expiry:n}=r;te.toMiliseconds(n)-Date.now()<=0&&this.expire(t,r)}expire(t,r){this.expirations.delete(t),this.events.emit(Or.expired,{target:t,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((t,r)=>this.checkExpiry(r,t))}registerEventListeners(){this.core.heartbeat.on(xn.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(Or.created,t=>{const r=Or.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()}),this.events.on(Or.expired,t=>{const r=Or.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()}),this.events.on(Or.deleted,t=>{const r=Or.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()})}isInitialized(){if(!this.initialized){const{message:t}=G("NOT_INITIALIZED",this.name);throw new Error(t)}}}class ux extends R_{constructor(t,r){super(t,r),this.projectId=t,this.logger=r,this.name=bc,this.initialized=!1,this.queue=[],this.verifyDisabled=!1,this.init=async n=>{if(this.verifyDisabled||m1()||!If())return;const o=this.getVerifyUrl(n==null?void 0:n.verifyUrl);this.verifyUrl!==o&&this.removeIframe(),this.verifyUrl=o;try{await this.createIframe()}catch(c){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(c)}if(!this.initialized){this.removeIframe(),this.verifyUrl=Uc;try{await this.createIframe()}catch(c){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(c),this.verifyDisabled=!0}}},this.register=async n=>{this.initialized?this.sendPost(n.attestationId):(this.addToQueue(n.attestationId),await this.init())},this.resolve=async n=>{if(this.isDevEnv)return"";const o=this.getVerifyUrl(n==null?void 0:n.verifyUrl);let c;try{c=await this.fetchAttestation(n.attestationId,o)}catch(l){this.logger.info(`failed to resolve attestation: ${n.attestationId} from url: ${o}`),this.logger.info(l),c=await this.fetchAttestation(n.attestationId,Uc)}return c},this.fetchAttestation=async(n,o)=>{this.logger.info(`resolving attestation: ${n} from url: ${o}`);const c=this.startAbortTimer(te.ONE_SECOND*2),l=await fetch(`${o}/attestation/${n}`,{signal:this.abortController.signal});return clearTimeout(c),l.status===200?await l.json():void 0},this.addToQueue=n=>{this.queue.push(n)},this.processQueue=()=>{this.queue.length!==0&&(this.queue.forEach(n=>this.sendPost(n)),this.queue=[])},this.sendPost=n=>{var o;try{if(!this.iframe)return;(o=this.iframe.contentWindow)==null||o.postMessage(n,"*"),this.logger.info(`postMessage sent: ${n} ${this.verifyUrl}`)}catch{}},this.createIframe=async()=>{let n;const o=c=>{c.data==="verify_ready"&&(this.initialized=!0,this.processQueue(),window.removeEventListener("message",o),n())};await Promise.race([new Promise(c=>{if(document.getElementById(bc))return c();window.addEventListener("message",o);const l=document.createElement("iframe");l.id=bc,l.src=`${this.verifyUrl}/${this.projectId}`,l.style.display="none",document.body.append(l),this.iframe=l,n=c}),new Promise((c,l)=>setTimeout(()=>{window.removeEventListener("message",o),l("verify iframe load timeout")},te.toMiliseconds(te.FIVE_SECONDS)))])},this.removeIframe=()=>{this.iframe&&(this.iframe.remove(),this.iframe=void 0,this.initialized=!1)},this.getVerifyUrl=n=>{let o=n||_n;return qI.includes(o)||(this.logger.info(`verify url: ${o}, not included in trusted list, assigning default: ${_n}`),o=_n),o},this.logger=lr(r,this.name),this.verifyUrl=_n,this.abortController=new AbortController,this.isDevEnv=w1()&&{}.IS_VITEST}get context(){return hr(this.logger)}startAbortTimer(t){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),te.toMiliseconds(t))}}class hx extends A_{constructor(t,r){super(t,r),this.projectId=t,this.logger=r,this.context=MI,this.registerDeviceToken=async n=>{const{clientId:o,token:c,notificationType:l,enableEncrypted:g=!1}=n,v=`${zI}/${this.projectId}/clients`;await Mb(v,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:o,type:l,token:c,always_raw:g})})},this.logger=lr(r,this.context)}}var lx=Object.defineProperty,Jl=Object.getOwnPropertySymbols,fx=Object.prototype.hasOwnProperty,px=Object.prototype.propertyIsEnumerable,Ql=(s,t,r)=>t in s?lx(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,Yl=(s,t)=>{for(var r in t||(t={}))fx.call(t,r)&&Ql(s,r,t[r]);if(Jl)for(var r of Jl(t))px.call(t,r)&&Ql(s,r,t[r]);return s};class tu extends __{constructor(t){super(t),this.protocol=lp,this.version=hI,this.name=eu,this.events=new ur.EventEmitter,this.initialized=!1,this.on=(n,o)=>this.events.on(n,o),this.once=(n,o)=>this.events.once(n,o),this.off=(n,o)=>this.events.off(n,o),this.removeListener=(n,o)=>this.events.removeListener(n,o),this.projectId=t==null?void 0:t.projectId,this.relayUrl=(t==null?void 0:t.relayUrl)||pp,this.customStoragePrefix=t!=null&&t.customStoragePrefix?`:${t.customStoragePrefix}`:"";const r=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:jo(qo({level:(t==null?void 0:t.logger)||lI.logger}));this.logger=lr(r,this.name),this.heartbeat=new xn.HeartBeat,this.crypto=new HI(this,this.logger,t==null?void 0:t.keychain),this.history=new ax(this,this.logger),this.expirer=new cx(this,this.logger),this.storage=t!=null&&t.storage?t.storage:new Iw(Yl(Yl({},fI),t==null?void 0:t.storageOptions)),this.relayer=new rx({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new ox(this,this.logger),this.verify=new ux(this.projectId||"",this.logger),this.echoClient=new hx(this.projectId||"",this.logger)}static async init(t){const r=new tu(t);await r.initialize();const n=await r.crypto.getClientId();return await r.storage.setItem(RI,n),r}get context(){return hr(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(t){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,t),this.logger.error(t.message),t}}}const dx=tu,dp="wc",gp=2,yp="client",ru=`${dp}@${gp}:${yp}:`,Ic={name:yp,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},Zl="WALLETCONNECT_DEEPLINK_CHOICE",gx="proposal",vp="Proposal expired",yx="session",bo=te.SEVEN_DAYS,vx="engine",Wn={wc_sessionPropose:{req:{ttl:te.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:te.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:te.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:te.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:te.ONE_DAY,prompt:!1,tag:1104},res:{ttl:te.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:te.ONE_DAY,prompt:!1,tag:1106},res:{ttl:te.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:te.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:te.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:te.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:te.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:te.ONE_DAY,prompt:!1,tag:1112},res:{ttl:te.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:te.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:te.THIRTY_SECONDS,prompt:!1,tag:1115}}},xc={min:te.FIVE_MINUTES,max:te.SEVEN_DAYS},ci={idle:"IDLE",active:"ACTIVE"},mx="request",wx=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var _x=Object.defineProperty,bx=Object.defineProperties,Ex=Object.getOwnPropertyDescriptors,Xl=Object.getOwnPropertySymbols,Ix=Object.prototype.hasOwnProperty,xx=Object.prototype.propertyIsEnumerable,ef=(s,t,r)=>t in s?_x(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,or=(s,t)=>{for(var r in t||(t={}))Ix.call(t,r)&&ef(s,r,t[r]);if(Xl)for(var r of Xl(t))xx.call(t,r)&&ef(s,r,t[r]);return s},Jn=(s,t)=>bx(s,Ex(t));class Px extends T_{constructor(t){super(t),this.name=vx,this.events=new Wc,this.initialized=!1,this.ignoredPayloadTypes=[bf],this.requestQueue={state:ci.idle,queue:[]},this.sessionRequestQueue={state:ci.idle,queue:[]},this.requestQueueDelay=te.ONE_SECOND,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),this.client.core.pairing.register({methods:Object.keys(Wn)}),this.initialized=!0,setTimeout(()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},te.toMiliseconds(this.requestQueueDelay)))},this.connect=async r=>{await this.isInitialized();const n=Jn(or({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(n);const{pairingTopic:o,requiredNamespaces:c,optionalNamespaces:l,sessionProperties:g,relays:v}=n;let p=o,_,x=!1;if(p&&(x=this.client.core.pairing.pairings.get(p).active),!p||!x){const{topic:ae,uri:ee}=await this.client.core.pairing.create();p=ae,_=ee}const A=await this.client.core.crypto.generateKeyPair(),D=or({requiredNamespaces:c,optionalNamespaces:l,relays:v??[{protocol:fp}],proposer:{publicKey:A,metadata:this.client.metadata}},g&&{sessionProperties:g}),{reject:C,resolve:J,done:re}=mn(te.FIVE_MINUTES,vp);if(this.events.once(Ct("session_connect"),async({error:ae,session:ee})=>{if(ae)C(ae);else if(ee){ee.self.publicKey=A;const he=Jn(or({},ee),{requiredNamespaces:ee.requiredNamespaces,optionalNamespaces:ee.optionalNamespaces});await this.client.session.set(ee.topic,he),await this.setExpiry(ee.topic,ee.expiry),p&&await this.client.core.pairing.updateMetadata({topic:p,metadata:ee.peer.metadata}),J(he)}}),!p){const{message:ae}=G("NO_MATCHING_KEY",`connect() pairing topic: ${p}`);throw new Error(ae)}const oe=await this.sendRequest({topic:p,method:"wc_sessionPropose",params:D}),ce=jr(te.FIVE_MINUTES);return await this.setProposal(oe,or({id:oe,expiry:ce},D)),{uri:_,approval:re}},this.pair=async r=>(await this.isInitialized(),await this.client.core.pairing.pair(r)),this.approve=async r=>{await this.isInitialized(),await this.isValidApprove(r);const{id:n,relayProtocol:o,namespaces:c,sessionProperties:l}=r,g=this.client.proposal.get(n);let{pairingTopic:v,proposer:p,requiredNamespaces:_,optionalNamespaces:x}=g;v=v||"",Po(_)||(_=b1(c,"approve()"));const A=await this.client.core.crypto.generateKeyPair(),D=p.publicKey,C=await this.client.core.crypto.generateSharedKey(A,D);v&&n&&(await this.client.core.pairing.updateMetadata({topic:v,metadata:p.metadata}),await this.sendResult({id:n,topic:v,result:{relay:{protocol:o??"irn"},responderPublicKey:A}}),await this.client.proposal.delete(n,Vt("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:v}));const J=or({relay:{protocol:o??"irn"},namespaces:c,requiredNamespaces:_,optionalNamespaces:x,pairingTopic:v,controller:{publicKey:A,metadata:this.client.metadata},expiry:jr(bo)},l&&{sessionProperties:l});await this.client.core.relayer.subscribe(C),await this.sendRequest({topic:C,method:"wc_sessionSettle",params:J,throwOnFailedPublish:!0});const re=Jn(or({},J),{topic:C,pairingTopic:v,acknowledged:!1,self:J.controller,peer:{publicKey:p.publicKey,metadata:p.metadata},controller:A});return await this.client.session.set(C,re),await this.setExpiry(C,jr(bo)),{topic:C,acknowledged:()=>new Promise(oe=>setTimeout(()=>oe(this.client.session.get(C)),500))}},this.reject=async r=>{await this.isInitialized(),await this.isValidReject(r);const{id:n,reason:o}=r,{pairingTopic:c}=this.client.proposal.get(n);c&&(await this.sendError(n,c,o),await this.client.proposal.delete(n,Vt("USER_DISCONNECTED")))},this.update=async r=>{await this.isInitialized(),await this.isValidUpdate(r);const{topic:n,namespaces:o}=r,c=await this.sendRequest({topic:n,method:"wc_sessionUpdate",params:{namespaces:o}}),{done:l,resolve:g,reject:v}=mn();return this.events.once(Ct("session_update",c),({error:p})=>{p?v(p):g()}),await this.client.session.update(n,{namespaces:o}),{acknowledged:l}},this.extend=async r=>{await this.isInitialized(),await this.isValidExtend(r);const{topic:n}=r,o=await this.sendRequest({topic:n,method:"wc_sessionExtend",params:{}}),{done:c,resolve:l,reject:g}=mn();return this.events.once(Ct("session_extend",o),({error:v})=>{v?g(v):l()}),await this.setExpiry(n,jr(bo)),{acknowledged:c}},this.request=async r=>{await this.isInitialized(),await this.isValidRequest(r);const{chainId:n,request:o,topic:c,expiry:l}=r,g=Yc(),{done:v,resolve:p,reject:_}=mn(l,"Request expired. Please try again.");return this.events.once(Ct("session_request",g),({error:x,result:A})=>{x?_(x):p(A)}),await Promise.all([new Promise(async x=>{await this.sendRequest({clientRpcId:g,topic:c,method:"wc_sessionRequest",params:{request:o,chainId:n},expiry:l,throwOnFailedPublish:!0}).catch(A=>_(A)),this.client.events.emit("session_request_sent",{topic:c,request:o,chainId:n,id:g}),x()}),new Promise(async x=>{const A=await E1(this.client.core.storage,Zl);I1({id:g,topic:c,wcDeepLink:A}),x()}),v()]).then(x=>x[2])},this.respond=async r=>{await this.isInitialized(),await this.isValidRespond(r);const{topic:n,response:o}=r,{id:c}=o;ui(o)?await this.sendResult({id:c,topic:n,result:o.result,throwOnFailedPublish:!0}):Rr(o)&&await this.sendError(c,n,o.error),this.cleanupAfterResponse(r)},this.ping=async r=>{await this.isInitialized(),await this.isValidPing(r);const{topic:n}=r;if(this.client.session.keys.includes(n)){const o=await this.sendRequest({topic:n,method:"wc_sessionPing",params:{}}),{done:c,resolve:l,reject:g}=mn();this.events.once(Ct("session_ping",o),({error:v})=>{v?g(v):l()}),await c()}else this.client.core.pairing.pairings.keys.includes(n)&&await this.client.core.pairing.ping({topic:n})},this.emit=async r=>{await this.isInitialized(),await this.isValidEmit(r);const{topic:n,event:o,chainId:c}=r;await this.sendRequest({topic:n,method:"wc_sessionEvent",params:{event:o,chainId:c}})},this.disconnect=async r=>{await this.isInitialized(),await this.isValidDisconnect(r);const{topic:n}=r;this.client.session.keys.includes(n)?(await this.sendRequest({topic:n,method:"wc_sessionDelete",params:Vt("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession(n)):await this.client.core.pairing.disconnect({topic:n})},this.find=r=>(this.isInitialized(),this.client.session.getAll().filter(n=>x1(n,r))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.cleanupDuplicatePairings=async r=>{if(r.pairingTopic)try{const n=this.client.core.pairing.pairings.get(r.pairingTopic),o=this.client.core.pairing.pairings.getAll().filter(c=>{var l,g;return((l=c.peerMetadata)==null?void 0:l.url)&&((g=c.peerMetadata)==null?void 0:g.url)===r.peer.metadata.url&&c.topic&&c.topic!==n.topic});if(o.length===0)return;this.client.logger.info(`Cleaning up ${o.length} duplicate pairing(s)`),await Promise.all(o.map(c=>this.client.core.pairing.disconnect({topic:c.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(n){this.client.logger.error(n)}},this.deleteSession=async(r,n)=>{const{self:o}=this.client.session.get(r);await this.client.core.relayer.unsubscribe(r),this.client.session.delete(r,Vt("USER_DISCONNECTED")),this.client.core.crypto.keychain.has(o.publicKey)&&await this.client.core.crypto.deleteKeyPair(o.publicKey),this.client.core.crypto.keychain.has(r)&&await this.client.core.crypto.deleteSymKey(r),n||this.client.core.expirer.del(r),this.client.core.storage.removeItem(Zl).catch(c=>this.client.logger.warn(c)),this.getPendingSessionRequests().forEach(c=>{c.topic===r&&this.deletePendingSessionRequest(c.id,Vt("USER_DISCONNECTED"))})},this.deleteProposal=async(r,n)=>{await Promise.all([this.client.proposal.delete(r,Vt("USER_DISCONNECTED")),n?Promise.resolve():this.client.core.expirer.del(r)])},this.deletePendingSessionRequest=async(r,n,o=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,n),o?Promise.resolve():this.client.core.expirer.del(r)]),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(c=>c.id!==r),o&&(this.sessionRequestQueue.state=ci.idle)},this.setExpiry=async(r,n)=>{this.client.session.keys.includes(r)&&await this.client.session.update(r,{expiry:n}),this.client.core.expirer.set(r,n)},this.setProposal=async(r,n)=>{await this.client.proposal.set(r,n),this.client.core.expirer.set(r,n.expiry)},this.setPendingSessionRequest=async r=>{const n=Wn.wc_sessionRequest.req.ttl,{id:o,topic:c,params:l,verifyContext:g}=r;await this.client.pendingRequest.set(o,{id:o,topic:c,params:l,verifyContext:g}),n&&this.client.core.expirer.set(o,jr(n))},this.sendRequest=async r=>{const{topic:n,method:o,params:c,expiry:l,relayRpcId:g,clientRpcId:v,throwOnFailedPublish:p}=r,_=ki(o,c,v);if(If()&&wx.includes(o)){const D=bn(JSON.stringify(_));this.client.core.verify.register({attestationId:D})}const x=await this.client.core.crypto.encode(n,_),A=Wn[o].req;return l&&(A.ttl=l),g&&(A.id=g),this.client.core.history.set(n,_),p?(A.internal=Jn(or({},A.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(n,x,A)):this.client.core.relayer.publish(n,x,A).catch(D=>this.client.logger.error(D)),_.id},this.sendResult=async r=>{const{id:n,topic:o,result:c,throwOnFailedPublish:l}=r,g=Mo(n,c),v=await this.client.core.crypto.encode(o,g),p=await this.client.core.history.get(o,n),_=Wn[p.request.method].res;l?(_.internal=Jn(or({},_.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(o,v,_)):this.client.core.relayer.publish(o,v,_).catch(x=>this.client.logger.error(x)),await this.client.core.history.resolve(g)},this.sendError=async(r,n,o)=>{const c=zo(r,o),l=await this.client.core.crypto.encode(n,c),g=await this.client.core.history.get(n,r),v=Wn[g.request.method].res;this.client.core.relayer.publish(n,l,v),await this.client.core.history.resolve(c)},this.cleanup=async()=>{const r=[],n=[];this.client.session.getAll().forEach(o=>{Ei(o.expiry)&&r.push(o.topic)}),this.client.proposal.getAll().forEach(o=>{Ei(o.expiry)&&n.push(o.id)}),await Promise.all([...r.map(o=>this.deleteSession(o)),...n.map(o=>this.deleteProposal(o))])},this.onRelayEventRequest=async r=>{this.requestQueue.queue.push(r),await this.processRequestsQueue()},this.processRequestsQueue=async()=>{if(this.requestQueue.state===ci.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=ci.active;const r=this.requestQueue.queue.shift();if(r)try{this.processRequest(r),await new Promise(n=>setTimeout(n,300))}catch(n){this.client.logger.warn(n)}}this.requestQueue.state=ci.idle},this.processRequest=r=>{const{topic:n,payload:o}=r,c=o.method;switch(c){case"wc_sessionPropose":return this.onSessionProposeRequest(n,o);case"wc_sessionSettle":return this.onSessionSettleRequest(n,o);case"wc_sessionUpdate":return this.onSessionUpdateRequest(n,o);case"wc_sessionExtend":return this.onSessionExtendRequest(n,o);case"wc_sessionPing":return this.onSessionPingRequest(n,o);case"wc_sessionDelete":return this.onSessionDeleteRequest(n,o);case"wc_sessionRequest":return this.onSessionRequest(n,o);case"wc_sessionEvent":return this.onSessionEventRequest(n,o);default:return this.client.logger.info(`Unsupported request method ${c}`)}},this.onRelayEventResponse=async r=>{const{topic:n,payload:o}=r,c=(await this.client.core.history.get(n,o.id)).request.method;switch(c){case"wc_sessionPropose":return this.onSessionProposeResponse(n,o);case"wc_sessionSettle":return this.onSessionSettleResponse(n,o);case"wc_sessionUpdate":return this.onSessionUpdateResponse(n,o);case"wc_sessionExtend":return this.onSessionExtendResponse(n,o);case"wc_sessionPing":return this.onSessionPingResponse(n,o);case"wc_sessionRequest":return this.onSessionRequestResponse(n,o);default:return this.client.logger.info(`Unsupported response method ${c}`)}},this.onRelayEventUnknownPayload=r=>{const{topic:n}=r,{message:o}=G("MISSING_OR_INVALID",`Decoded payload on topic ${n} is not identifiable as a JSON-RPC request or a response.`);throw new Error(o)},this.onSessionProposeRequest=async(r,n)=>{const{params:o,id:c}=n;try{this.isValidConnect(or({},n.params));const l=jr(te.FIVE_MINUTES),g=or({id:c,pairingTopic:r,expiry:l},o);await this.setProposal(c,g);const v=bn(JSON.stringify(n)),p=await this.getVerifyContext(v,g.proposer.metadata);this.client.events.emit("session_proposal",{id:c,params:g,verifyContext:p})}catch(l){await this.sendError(c,r,l),this.client.logger.error(l)}},this.onSessionProposeResponse=async(r,n)=>{const{id:o}=n;if(ui(n)){const{result:c}=n;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:c});const l=this.client.proposal.get(o);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:l});const g=l.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:g});const v=c.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:v});const p=await this.client.core.crypto.generateSharedKey(g,v);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:p});const _=await this.client.core.relayer.subscribe(p);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:_}),await this.client.core.pairing.activate({topic:r})}else Rr(n)&&(await this.client.proposal.delete(o,Vt("USER_DISCONNECTED")),this.events.emit(Ct("session_connect"),{error:n.error}))},this.onSessionSettleRequest=async(r,n)=>{const{id:o,params:c}=n;try{this.isValidSessionSettleRequest(c);const{relay:l,controller:g,expiry:v,namespaces:p,requiredNamespaces:_,optionalNamespaces:x,sessionProperties:A,pairingTopic:D}=n.params,C=or({topic:r,relay:l,expiry:v,namespaces:p,acknowledged:!0,pairingTopic:D,requiredNamespaces:_,optionalNamespaces:x,controller:g.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:g.publicKey,metadata:g.metadata}},A&&{sessionProperties:A});await this.sendResult({id:n.id,topic:r,result:!0}),this.events.emit(Ct("session_connect"),{session:C}),this.cleanupDuplicatePairings(C)}catch(l){await this.sendError(o,r,l),this.client.logger.error(l)}},this.onSessionSettleResponse=async(r,n)=>{const{id:o}=n;ui(n)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(Ct("session_approve",o),{})):Rr(n)&&(await this.client.session.delete(r,Vt("USER_DISCONNECTED")),this.events.emit(Ct("session_approve",o),{error:n.error}))},this.onSessionUpdateRequest=async(r,n)=>{const{params:o,id:c}=n;try{const l=`${r}_session_update`,g=vo.get(l);if(g&&this.isRequestOutOfSync(g,c)){this.client.logger.info(`Discarding out of sync request - ${c}`);return}this.isValidUpdate(or({topic:r},o)),await this.client.session.update(r,{namespaces:o.namespaces}),await this.sendResult({id:c,topic:r,result:!0}),this.client.events.emit("session_update",{id:c,topic:r,params:o}),vo.set(l,c)}catch(l){await this.sendError(c,r,l),this.client.logger.error(l)}},this.isRequestOutOfSync=(r,n)=>parseInt(n.toString().slice(0,-3))<=parseInt(r.toString().slice(0,-3)),this.onSessionUpdateResponse=(r,n)=>{const{id:o}=n;ui(n)?this.events.emit(Ct("session_update",o),{}):Rr(n)&&this.events.emit(Ct("session_update",o),{error:n.error})},this.onSessionExtendRequest=async(r,n)=>{const{id:o}=n;try{this.isValidExtend({topic:r}),await this.setExpiry(r,jr(bo)),await this.sendResult({id:o,topic:r,result:!0}),this.client.events.emit("session_extend",{id:o,topic:r})}catch(c){await this.sendError(o,r,c),this.client.logger.error(c)}},this.onSessionExtendResponse=(r,n)=>{const{id:o}=n;ui(n)?this.events.emit(Ct("session_extend",o),{}):Rr(n)&&this.events.emit(Ct("session_extend",o),{error:n.error})},this.onSessionPingRequest=async(r,n)=>{const{id:o}=n;try{this.isValidPing({topic:r}),await this.sendResult({id:o,topic:r,result:!0}),this.client.events.emit("session_ping",{id:o,topic:r})}catch(c){await this.sendError(o,r,c),this.client.logger.error(c)}},this.onSessionPingResponse=(r,n)=>{const{id:o}=n;setTimeout(()=>{ui(n)?this.events.emit(Ct("session_ping",o),{}):Rr(n)&&this.events.emit(Ct("session_ping",o),{error:n.error})},500)},this.onSessionDeleteRequest=async(r,n)=>{const{id:o}=n;try{this.isValidDisconnect({topic:r,reason:n.params}),await Promise.all([new Promise(c=>{this.client.core.relayer.once(Gt.publish,async()=>{c(await this.deleteSession(r))})}),this.sendResult({id:o,topic:r,result:!0})]),this.client.events.emit("session_delete",{id:o,topic:r})}catch(c){this.client.logger.error(c)}},this.onSessionRequest=async(r,n)=>{const{id:o,params:c}=n;try{this.isValidRequest(or({topic:r},c));const l=bn(JSON.stringify(ki("wc_sessionRequest",c,o))),g=this.client.session.get(r),v=await this.getVerifyContext(l,g.peer.metadata),p={id:o,topic:r,params:c,verifyContext:v};await this.setPendingSessionRequest(p),this.addSessionRequestToSessionRequestQueue(p),this.processSessionRequestQueue()}catch(l){await this.sendError(o,r,l),this.client.logger.error(l)}},this.onSessionRequestResponse=(r,n)=>{const{id:o}=n;ui(n)?this.events.emit(Ct("session_request",o),{result:n.result}):Rr(n)&&this.events.emit(Ct("session_request",o),{error:n.error})},this.onSessionEventRequest=async(r,n)=>{const{id:o,params:c}=n;try{const l=`${r}_session_event_${c.event.name}`,g=vo.get(l);if(g&&this.isRequestOutOfSync(g,o)){this.client.logger.info(`Discarding out of sync request - ${o}`);return}this.isValidEmit(or({topic:r},c)),this.client.events.emit("session_event",{id:o,topic:r,params:c}),vo.set(l,o)}catch(l){await this.sendError(o,r,l),this.client.logger.error(l)}},this.addSessionRequestToSessionRequestQueue=r=>{this.sessionRequestQueue.queue.push(r)},this.cleanupAfterResponse=r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=ci.idle,this.processSessionRequestQueue()},te.toMiliseconds(this.requestQueueDelay))},this.processSessionRequestQueue=()=>{if(this.sessionRequestQueue.state===ci.active){this.client.logger.info("session request queue is already active.");return}const r=this.sessionRequestQueue.queue[0];if(!r){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=ci.active,this.client.events.emit("session_request",r)}catch(n){this.client.logger.error(n)}},this.onPairingCreated=r=>{if(r.active)return;const n=this.client.proposal.getAll().find(o=>o.pairingTopic===r.topic);n&&this.onSessionProposeRequest(r.topic,ki("wc_sessionPropose",{requiredNamespaces:n.requiredNamespaces,optionalNamespaces:n.optionalNamespaces,relays:n.relays,proposer:n.proposer,sessionProperties:n.sessionProperties},n.id))},this.isValidConnect=async r=>{if(!cr(r)){const{message:v}=G("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(v)}const{pairingTopic:n,requiredNamespaces:o,optionalNamespaces:c,sessionProperties:l,relays:g}=r;if(Ii(n)||await this.isValidPairingTopic(n),!P1(g,!0)){const{message:v}=G("MISSING_OR_INVALID",`connect() relays: ${g}`);throw new Error(v)}!Ii(o)&&Po(o)!==0&&this.validateNamespaces(o,"requiredNamespaces"),!Ii(c)&&Po(c)!==0&&this.validateNamespaces(c,"optionalNamespaces"),Ii(l)||this.validateSessionProps(l,"sessionProperties")},this.validateNamespaces=(r,n)=>{const o=S1(r,"connect()",n);if(o)throw new Error(o.message)},this.isValidApprove=async r=>{if(!cr(r))throw new Error(G("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:n,namespaces:o,relayProtocol:c,sessionProperties:l}=r;await this.isValidProposalId(n);const g=this.client.proposal.get(n),v=pc(o,"approve()");if(v)throw new Error(v.message);const p=cl(g.requiredNamespaces,o,"approve()");if(p)throw new Error(p.message);if(!wn(c,!0)){const{message:_}=G("MISSING_OR_INVALID",`approve() relayProtocol: ${c}`);throw new Error(_)}Ii(l)||this.validateSessionProps(l,"sessionProperties")},this.isValidReject=async r=>{if(!cr(r)){const{message:c}=G("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(c)}const{id:n,reason:o}=r;if(await this.isValidProposalId(n),!O1(o)){const{message:c}=G("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(o)}`);throw new Error(c)}},this.isValidSessionSettleRequest=r=>{if(!cr(r)){const{message:p}=G("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(p)}const{relay:n,controller:o,namespaces:c,expiry:l}=r;if(!R1(n)){const{message:p}=G("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(p)}const g=A1(o,"onSessionSettleRequest()");if(g)throw new Error(g.message);const v=pc(c,"onSessionSettleRequest()");if(v)throw new Error(v.message);if(Ei(l)){const{message:p}=G("EXPIRED","onSessionSettleRequest()");throw new Error(p)}},this.isValidUpdate=async r=>{if(!cr(r)){const{message:v}=G("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(v)}const{topic:n,namespaces:o}=r;await this.isValidSessionTopic(n);const c=this.client.session.get(n),l=pc(o,"update()");if(l)throw new Error(l.message);const g=cl(c.requiredNamespaces,o,"update()");if(g)throw new Error(g.message)},this.isValidExtend=async r=>{if(!cr(r)){const{message:o}=G("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(o)}const{topic:n}=r;await this.isValidSessionTopic(n)},this.isValidRequest=async r=>{if(!cr(r)){const{message:v}=G("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(v)}const{topic:n,request:o,chainId:c,expiry:l}=r;await this.isValidSessionTopic(n);const{namespaces:g}=this.client.session.get(n);if(!ul(g,c)){const{message:v}=G("MISSING_OR_INVALID",`request() chainId: ${c}`);throw new Error(v)}if(!C1(o)){const{message:v}=G("MISSING_OR_INVALID",`request() ${JSON.stringify(o)}`);throw new Error(v)}if(!T1(g,c,o.method)){const{message:v}=G("MISSING_OR_INVALID",`request() method: ${o.method}`);throw new Error(v)}if(l&&!$1(l,xc)){const{message:v}=G("MISSING_OR_INVALID",`request() expiry: ${l}. Expiry must be a number (in seconds) between ${xc.min} and ${xc.max}`);throw new Error(v)}},this.isValidRespond=async r=>{var n;if(!cr(r)){const{message:l}=G("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(l)}const{topic:o,response:c}=r;try{await this.isValidSessionTopic(o)}catch(l){throw(n=r==null?void 0:r.response)!=null&&n.id&&this.cleanupAfterResponse(r),l}if(!N1(c)){const{message:l}=G("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(c)}`);throw new Error(l)}},this.isValidPing=async r=>{if(!cr(r)){const{message:o}=G("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(o)}const{topic:n}=r;await this.isValidSessionOrPairingTopic(n)},this.isValidEmit=async r=>{if(!cr(r)){const{message:g}=G("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(g)}const{topic:n,event:o,chainId:c}=r;await this.isValidSessionTopic(n);const{namespaces:l}=this.client.session.get(n);if(!ul(l,c)){const{message:g}=G("MISSING_OR_INVALID",`emit() chainId: ${c}`);throw new Error(g)}if(!D1(o)){const{message:g}=G("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(o)}`);throw new Error(g)}if(!F1(l,c,o.name)){const{message:g}=G("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(o)}`);throw new Error(g)}},this.isValidDisconnect=async r=>{if(!cr(r)){const{message:o}=G("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(o)}const{topic:n}=r;await this.isValidSessionOrPairingTopic(n)},this.getVerifyContext=async(r,n)=>{const o={verified:{verifyUrl:n.verifyUrl||_n,validation:"UNKNOWN",origin:n.url||""}};try{const c=await this.client.core.verify.resolve({attestationId:r,verifyUrl:n.verifyUrl});c&&(o.verified.origin=c.origin,o.verified.isScam=c.isScam,o.verified.validation=c.origin===new URL(n.url).origin?"VALID":"INVALID")}catch(c){this.client.logger.info(c)}return this.client.logger.info(`Verify context: ${JSON.stringify(o)}`),o},this.validateSessionProps=(r,n)=>{Object.values(r).forEach(o=>{if(!wn(o,!1)){const{message:c}=G("MISSING_OR_INVALID",`${n} must be in Record<string, string> format. Received: ${JSON.stringify(o)}`);throw new Error(c)}})}}async isInitialized(){if(!this.initialized){const{message:t}=G("NOT_INITIALIZED",this.name);throw new Error(t)}await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(Gt.message,async t=>{const{topic:r,message:n}=t;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(n)))return;const o=await this.client.core.crypto.decode(r,n);try{Xc(o)?(this.client.core.history.set(r,o),this.onRelayEventRequest({topic:r,payload:o})):hs(o)?(await this.client.core.history.resolve(o),await this.onRelayEventResponse({topic:r,payload:o}),this.client.core.history.delete(r,o.id)):this.onRelayEventUnknownPayload({topic:r,payload:o})}catch(c){this.client.logger.error(c)}})}registerExpirerEvents(){this.client.core.expirer.on(Or.expired,async t=>{const{topic:r,id:n}=Ef(t.target);if(n&&this.client.pendingRequest.keys.includes(n))return await this.deletePendingSessionRequest(n,G("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession(r,!0),this.client.events.emit("session_expire",{topic:r})):n&&(await this.deleteProposal(n,!0),this.client.events.emit("proposal_expire",{id:n}))})}registerPairingEvents(){this.client.core.pairing.events.on(Zn.create,t=>this.onPairingCreated(t))}isValidPairingTopic(t){if(!wn(t,!1)){const{message:r}=G("MISSING_OR_INVALID",`pairing topic should be a string: ${t}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(t)){const{message:r}=G("NO_MATCHING_KEY",`pairing topic doesn't exist: ${t}`);throw new Error(r)}if(Ei(this.client.core.pairing.pairings.get(t).expiry)){const{message:r}=G("EXPIRED",`pairing topic: ${t}`);throw new Error(r)}}async isValidSessionTopic(t){if(!wn(t,!1)){const{message:r}=G("MISSING_OR_INVALID",`session topic should be a string: ${t}`);throw new Error(r)}if(!this.client.session.keys.includes(t)){const{message:r}=G("NO_MATCHING_KEY",`session topic doesn't exist: ${t}`);throw new Error(r)}if(Ei(this.client.session.get(t).expiry)){await this.deleteSession(t);const{message:r}=G("EXPIRED",`session topic: ${t}`);throw new Error(r)}}async isValidSessionOrPairingTopic(t){if(this.client.session.keys.includes(t))await this.isValidSessionTopic(t);else if(this.client.core.pairing.pairings.keys.includes(t))this.isValidPairingTopic(t);else if(wn(t,!1)){const{message:r}=G("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${t}`);throw new Error(r)}else{const{message:r}=G("MISSING_OR_INVALID",`session or pairing topic should be a string: ${t}`);throw new Error(r)}}async isValidProposalId(t){if(!L1(t)){const{message:r}=G("MISSING_OR_INVALID",`proposal id should be a number: ${t}`);throw new Error(r)}if(!this.client.proposal.keys.includes(t)){const{message:r}=G("NO_MATCHING_KEY",`proposal id doesn't exist: ${t}`);throw new Error(r)}if(Ei(this.client.proposal.get(t).expiry)){await this.deleteProposal(t);const{message:r}=G("EXPIRED",`proposal id: ${t}`);throw new Error(r)}}}class Sx extends Ho{constructor(t,r){super(t,r,gx,ru),this.core=t,this.logger=r}}class Ox extends Ho{constructor(t,r){super(t,r,yx,ru),this.core=t,this.logger=r}}class Rx extends Ho{constructor(t,r){super(t,r,mx,ru,n=>n.id),this.core=t,this.logger=r}}let Ax=class mp extends C_{constructor(t){super(t),this.protocol=dp,this.version=gp,this.name=Ic.name,this.events=new ur.EventEmitter,this.on=(n,o)=>this.events.on(n,o),this.once=(n,o)=>this.events.once(n,o),this.off=(n,o)=>this.events.off(n,o),this.removeListener=(n,o)=>this.events.removeListener(n,o),this.removeAllListeners=n=>this.events.removeAllListeners(n),this.connect=async n=>{try{return await this.engine.connect(n)}catch(o){throw this.logger.error(o.message),o}},this.pair=async n=>{try{return await this.engine.pair(n)}catch(o){throw this.logger.error(o.message),o}},this.approve=async n=>{try{return await this.engine.approve(n)}catch(o){throw this.logger.error(o.message),o}},this.reject=async n=>{try{return await this.engine.reject(n)}catch(o){throw this.logger.error(o.message),o}},this.update=async n=>{try{return await this.engine.update(n)}catch(o){throw this.logger.error(o.message),o}},this.extend=async n=>{try{return await this.engine.extend(n)}catch(o){throw this.logger.error(o.message),o}},this.request=async n=>{try{return await this.engine.request(n)}catch(o){throw this.logger.error(o.message),o}},this.respond=async n=>{try{return await this.engine.respond(n)}catch(o){throw this.logger.error(o.message),o}},this.ping=async n=>{try{return await this.engine.ping(n)}catch(o){throw this.logger.error(o.message),o}},this.emit=async n=>{try{return await this.engine.emit(n)}catch(o){throw this.logger.error(o.message),o}},this.disconnect=async n=>{try{return await this.engine.disconnect(n)}catch(o){throw this.logger.error(o.message),o}},this.find=n=>{try{return this.engine.find(n)}catch(o){throw this.logger.error(o.message),o}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(n){throw this.logger.error(n.message),n}},this.name=(t==null?void 0:t.name)||Ic.name,this.metadata=(t==null?void 0:t.metadata)||_1();const r=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:jo(qo({level:(t==null?void 0:t.logger)||Ic.logger}));this.core=(t==null?void 0:t.core)||new dx(t),this.logger=lr(r,this.name),this.session=new Ox(this.core,this.logger),this.proposal=new Sx(this.core,this.logger),this.pendingRequest=new Rx(this.core,this.logger),this.engine=new Px(this)}static async init(t){const r=new mp(t);return await r.initialize(),r}get context(){return hr(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(t){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(t.message),t}}};var Hc={exports:{}};(function(s,t){var r=typeof self<"u"?self:qr,n=function(){function c(){this.fetch=!1,this.DOMException=r.DOMException}return c.prototype=r,new c}();(function(c){(function(l){var g={searchParams:"URLSearchParams"in c,iterable:"Symbol"in c&&"iterator"in Symbol,blob:"FileReader"in c&&"Blob"in c&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in c,arrayBuffer:"ArrayBuffer"in c};function v(b){return b&&DataView.prototype.isPrototypeOf(b)}if(g.arrayBuffer)var p=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],_=ArrayBuffer.isView||function(b){return b&&p.indexOf(Object.prototype.toString.call(b))>-1};function x(b){if(typeof b!="string"&&(b=String(b)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(b))throw new TypeError("Invalid character in header field name");return b.toLowerCase()}function A(b){return typeof b!="string"&&(b=String(b)),b}function D(b){var O={next:function(){var Q=b.shift();return{done:Q===void 0,value:Q}}};return g.iterable&&(O[Symbol.iterator]=function(){return O}),O}function C(b){this.map={},b instanceof C?b.forEach(function(O,Q){this.append(Q,O)},this):Array.isArray(b)?b.forEach(function(O){this.append(O[0],O[1])},this):b&&Object.getOwnPropertyNames(b).forEach(function(O){this.append(O,b[O])},this)}C.prototype.append=function(b,O){b=x(b),O=A(O);var Q=this.map[b];this.map[b]=Q?Q+", "+O:O},C.prototype.delete=function(b){delete this.map[x(b)]},C.prototype.get=function(b){return b=x(b),this.has(b)?this.map[b]:null},C.prototype.has=function(b){return this.map.hasOwnProperty(x(b))},C.prototype.set=function(b,O){this.map[x(b)]=A(O)},C.prototype.forEach=function(b,O){for(var Q in this.map)this.map.hasOwnProperty(Q)&&b.call(O,this.map[Q],Q,this)},C.prototype.keys=function(){var b=[];return this.forEach(function(O,Q){b.push(Q)}),D(b)},C.prototype.values=function(){var b=[];return this.forEach(function(O){b.push(O)}),D(b)},C.prototype.entries=function(){var b=[];return this.forEach(function(O,Q){b.push([Q,O])}),D(b)},g.iterable&&(C.prototype[Symbol.iterator]=C.prototype.entries);function J(b){if(b.bodyUsed)return Promise.reject(new TypeError("Already read"));b.bodyUsed=!0}function re(b){return new Promise(function(O,Q){b.onload=function(){O(b.result)},b.onerror=function(){Q(b.error)}})}function oe(b){var O=new FileReader,Q=re(O);return O.readAsArrayBuffer(b),Q}function ce(b){var O=new FileReader,Q=re(O);return O.readAsText(b),Q}function ae(b){for(var O=new Uint8Array(b),Q=new Array(O.length),le=0;le<O.length;le++)Q[le]=String.fromCharCode(O[le]);return Q.join("")}function ee(b){if(b.slice)return b.slice(0);var O=new Uint8Array(b.byteLength);return O.set(new Uint8Array(b)),O.buffer}function he(){return this.bodyUsed=!1,this._initBody=function(b){this._bodyInit=b,b?typeof b=="string"?this._bodyText=b:g.blob&&Blob.prototype.isPrototypeOf(b)?this._bodyBlob=b:g.formData&&FormData.prototype.isPrototypeOf(b)?this._bodyFormData=b:g.searchParams&&URLSearchParams.prototype.isPrototypeOf(b)?this._bodyText=b.toString():g.arrayBuffer&&g.blob&&v(b)?(this._bodyArrayBuffer=ee(b.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):g.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(b)||_(b))?this._bodyArrayBuffer=ee(b):this._bodyText=b=Object.prototype.toString.call(b):this._bodyText="",this.headers.get("content-type")||(typeof b=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):g.searchParams&&URLSearchParams.prototype.isPrototypeOf(b)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},g.blob&&(this.blob=function(){var b=J(this);if(b)return b;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?J(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(oe)}),this.text=function(){var b=J(this);if(b)return b;if(this._bodyBlob)return ce(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(ae(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},g.formData&&(this.formData=function(){return this.text().then(_t)}),this.json=function(){return this.text().then(JSON.parse)},this}var pe=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function Y(b){var O=b.toUpperCase();return pe.indexOf(O)>-1?O:b}function ve(b,O){O=O||{};var Q=O.body;if(b instanceof ve){if(b.bodyUsed)throw new TypeError("Already read");this.url=b.url,this.credentials=b.credentials,O.headers||(this.headers=new C(b.headers)),this.method=b.method,this.mode=b.mode,this.signal=b.signal,!Q&&b._bodyInit!=null&&(Q=b._bodyInit,b.bodyUsed=!0)}else this.url=String(b);if(this.credentials=O.credentials||this.credentials||"same-origin",(O.headers||!this.headers)&&(this.headers=new C(O.headers)),this.method=Y(O.method||this.method||"GET"),this.mode=O.mode||this.mode||null,this.signal=O.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&Q)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(Q)}ve.prototype.clone=function(){return new ve(this,{body:this._bodyInit})};function _t(b){var O=new FormData;return b.trim().split("&").forEach(function(Q){if(Q){var le=Q.split("="),H=le.shift().replace(/\+/g," "),U=le.join("=").replace(/\+/g," ");O.append(decodeURIComponent(H),decodeURIComponent(U))}}),O}function st(b){var O=new C,Q=b.replace(/\r?\n[\t ]+/g," ");return Q.split(/\r?\n/).forEach(function(le){var H=le.split(":"),U=H.shift().trim();if(U){var B=H.join(":").trim();O.append(U,B)}}),O}he.call(ve.prototype);function ke(b,O){O||(O={}),this.type="default",this.status=O.status===void 0?200:O.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in O?O.statusText:"OK",this.headers=new C(O.headers),this.url=O.url||"",this._initBody(b)}he.call(ke.prototype),ke.prototype.clone=function(){return new ke(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new C(this.headers),url:this.url})},ke.error=function(){var b=new ke(null,{status:0,statusText:""});return b.type="error",b};var qt=[301,302,303,307,308];ke.redirect=function(b,O){if(qt.indexOf(O)===-1)throw new RangeError("Invalid status code");return new ke(null,{status:O,headers:{location:b}})},l.DOMException=c.DOMException;try{new l.DOMException}catch{l.DOMException=function(O,Q){this.message=O,this.name=Q;var le=Error(O);this.stack=le.stack},l.DOMException.prototype=Object.create(Error.prototype),l.DOMException.prototype.constructor=l.DOMException}function Mt(b,O){return new Promise(function(Q,le){var H=new ve(b,O);if(H.signal&&H.signal.aborted)return le(new l.DOMException("Aborted","AbortError"));var U=new XMLHttpRequest;function B(){U.abort()}U.onload=function(){var k={status:U.status,statusText:U.statusText,headers:st(U.getAllResponseHeaders()||"")};k.url="responseURL"in U?U.responseURL:k.headers.get("X-Request-URL");var et="response"in U?U.response:U.responseText;Q(new ke(et,k))},U.onerror=function(){le(new TypeError("Network request failed"))},U.ontimeout=function(){le(new TypeError("Network request failed"))},U.onabort=function(){le(new l.DOMException("Aborted","AbortError"))},U.open(H.method,H.url,!0),H.credentials==="include"?U.withCredentials=!0:H.credentials==="omit"&&(U.withCredentials=!1),"responseType"in U&&g.blob&&(U.responseType="blob"),H.headers.forEach(function(k,et){U.setRequestHeader(et,k)}),H.signal&&(H.signal.addEventListener("abort",B),U.onreadystatechange=function(){U.readyState===4&&H.signal.removeEventListener("abort",B)}),U.send(typeof H._bodyInit>"u"?null:H._bodyInit)})}return Mt.polyfill=!0,c.fetch||(c.fetch=Mt,c.Headers=C,c.Request=ve,c.Response=ke),l.Headers=C,l.Request=ve,l.Response=ke,l.fetch=Mt,Object.defineProperty(l,"__esModule",{value:!0}),l})({})})(n),n.fetch.ponyfill=!0,delete n.fetch.polyfill;var o=n;t=o.fetch,t.default=o.fetch,t.fetch=o.fetch,t.Headers=o.Headers,t.Request=o.Request,t.Response=o.Response,s.exports=t})(Hc,Hc.exports);var Cx=Hc.exports;const tf=os(Cx);var Tx=Object.defineProperty,$x=Object.defineProperties,Nx=Object.getOwnPropertyDescriptors,rf=Object.getOwnPropertySymbols,Dx=Object.prototype.hasOwnProperty,Fx=Object.prototype.propertyIsEnumerable,nf=(s,t,r)=>t in s?Tx(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,sf=(s,t)=>{for(var r in t||(t={}))Dx.call(t,r)&&nf(s,r,t[r]);if(rf)for(var r of rf(t))Fx.call(t,r)&&nf(s,r,t[r]);return s},of=(s,t)=>$x(s,Nx(t));const Lx={Accept:"application/json","Content-Type":"application/json"},jx="POST",af={headers:Lx,method:jx},cf=10;let Si=class{constructor(t,r=!1){if(this.url=t,this.disableProviderPing=r,this.events=new ur.EventEmitter,this.isAvailable=!1,this.registering=!1,!Al(t))throw new Error(`Provided URL is not compatible with HTTP connection: ${t}`);this.url=t,this.disableProviderPing=r}get connected(){return this.isAvailable}get connecting(){return this.registering}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async open(t=this.url){await this.register(t)}async close(){if(!this.isAvailable)throw new Error("Connection already closed");this.onClose()}async send(t){this.isAvailable||await this.register();try{const r=Ki(t),n=await(await tf(this.url,of(sf({},af),{body:r}))).json();this.onPayload({data:n})}catch(r){this.onError(t.id,r)}}async register(t=this.url){if(!Al(t))throw new Error(`Provided URL is not compatible with HTTP connection: ${t}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((n,o)=>{this.events.once("register_error",c=>{this.resetMaxListeners(),o(c)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return o(new Error("HTTP connection is missing or invalid"));n()})})}this.url=t,this.registering=!0;try{if(!this.disableProviderPing){const r=Ki({id:1,jsonrpc:"2.0",method:"test",params:[]});await tf(t,of(sf({},af),{body:r}))}this.onOpen()}catch(r){const n=this.parseError(r);throw this.events.emit("register_error",n),this.onClose(),n}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(t){if(typeof t.data>"u")return;const r=typeof t.data=="string"?cs(t.data):t.data;this.events.emit("payload",r)}onError(t,r){const n=this.parseError(r),o=n.message||n.toString(),c=zo(t,o);this.events.emit("payload",c)}parseError(t,r=this.url){return Wf(t,r,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>cf&&this.events.setMaxListeners(cf)}};class Oi extends Yf{constructor(t){super(t),this.events=new ur.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(t),this.connection.connected&&this.registerEventListeners()}async connect(t=this.connection){await this.open(t)}async disconnect(){await this.close()}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async request(t,r){return this.requestStrict(ki(t.method,t.params||[],t.id||Zc().toString()),r)}async requestStrict(t,r){return new Promise(async(n,o)=>{if(!this.connection.connected)try{await this.open()}catch(c){o(c)}this.events.on(`${t.id}`,c=>{Rr(c)?o(c.error):n(c.result)});try{await this.connection.send(t,r)}catch(c){o(c)}})}setConnection(t=this.connection){return t}onPayload(t){this.events.emit("payload",t),hs(t)?this.events.emit(`${t.id}`,t):this.events.emit("message",{type:t.method,data:t.params})}onClose(t){t&&t.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${t.code} ${t.reason?`(${t.reason})`:""}`)),this.events.emit("disconnect")}async open(t=this.connection){this.connection===t&&this.connection.connected||(this.connection.connected&&this.close(),typeof t=="string"&&(await this.connection.open(t),t=this.connection),this.connection=this.setConnection(t),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",t=>this.onPayload(t)),this.connection.on("close",t=>this.onClose(t)),this.connection.on("error",t=>this.events.emit("error",t)),this.connection.on("register_error",t=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const uf="error",qx="wss://relay.walletconnect.com",Mx="wc",zx="universal_provider",hf=`${Mx}@2:${zx}:`,Ux="https://rpc.walletconnect.com/v1/",hi={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var Qn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Bc={exports:{}};/**
* @license
* Lodash <https://lodash.com/>
* Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
* Released under MIT license <https://lodash.com/license>
* Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
* Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
*/(function(s,t){(function(){var r,n="4.17.21",o=200,c="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",l="Expected a function",g="Invalid `variable` option passed into `_.template`",v="__lodash_hash_undefined__",p=500,_="__lodash_placeholder__",x=1,A=2,D=4,C=1,J=2,re=1,oe=2,ce=4,ae=8,ee=16,he=32,pe=64,Y=128,ve=256,_t=512,st=30,ke="...",qt=800,Mt=16,b=1,O=2,Q=3,le=1/0,H=9007199254740991,U=17976931348623157e292,B=0/0,k=4294967295,et=k-1,ot=k>>>1,Ri=[["ary",Y],["bind",re],["bindKey",oe],["curry",ae],["curryRight",ee],["flip",_t],["partial",he],["partialRight",pe],["rearg",ve]],Ee="[object Arguments]",Ar="[object Array]",F="[object AsyncFunction]",N="[object Boolean]",T="[object Date]",h="[object DOMException]",I="[object Error]",Z="[object Function]",ue="[object GeneratorFunction]",me="[object Map]",Oe="[object Number]",Ae="[object Null]",Ie="[object Object]",bt="[object Promise]",gt="[object Proxy]",tt="[object RegExp]",Te="[object Set]",Ke="[object String]",Ve="[object Symbol]",rt="[object Undefined]",Fe="[object WeakMap]",Ge="[object WeakSet]",Re="[object ArrayBuffer]",qe="[object DataView]",at="[object Float32Array]",Ne="[object Float64Array]",Et="[object Int8Array]",Tt="[object Int16Array]",zt="[object Int32Array]",Ut="[object Uint8Array]",Dt="[object Uint8ClampedArray]",Wt="[object Uint16Array]",er="[object Uint32Array]",Mr=/\b__p \+= '';/g,Jt=/\b(__p \+=) '' \+/g,Gr=/(__e\(.*?\)|\b__t\)) \+\n'';/g,li=/&(?:amp|lt|gt|quot|#39);/g,Ai=/[&<>"']/g,ct=RegExp(li.source),Qe=RegExp(Ai.source),ut=/<%-([\s\S]+?)%>/g,ht=/<%([\s\S]+?)%>/g,it=/<%=([\s\S]+?)%>/g,Ye=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,It=/^\w*$/,xt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,lt=/[\\^$.*+?()[\]{}|]/g,Pt=RegExp(lt.source),ft=/^\s+/,yt=/\s/,pt=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Be=/\{\n\/\* \[wrapped with (.+)\] \*/,St=/,? & /,Ot=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Bo=/[()=,{}\[\]\/\s]/,ko=/\\(\\)?/g,Ko=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,mr=/\w*$/,Vo=/^[-+]0x[0-9a-f]+$/i,Go=/^0b[01]+$/i,Wo=/^\[object .+?Constructor\]$/,Jo=/^0o[0-7]+$/i,Qo=/^(?:0|[1-9]\d*)$/,Wr=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Ji=/($^)/,Yo=/['\n\r\u2028\u2029\\]/g,Qi="\\ud800-\\udfff",Zo="\\u0300-\\u036f",Xo="\\ufe20-\\ufe2f",Yi="\\u20d0-\\u20ff",fs=Zo+Xo+Yi,ps="\\u2700-\\u27bf",Cr="a-z\\xdf-\\xf6\\xf8-\\xff",ea="\\xac\\xb1\\xd7\\xf7",ta="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",ra="\\u2000-\\u206f",ia=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",ds="A-Z\\xc0-\\xd6\\xd8-\\xde",gs="\\ufe0e\\ufe0f",Ci=ea+ta+ra+ia,Pn="[']",Ti="["+Qi+"]",Sn="["+Ci+"]",$i="["+fs+"]",ys="\\d+",na="["+ps+"]",vs="["+Cr+"]",ms="[^"+Qi+Ci+ys+ps+Cr+ds+"]",Zi="\\ud83c[\\udffb-\\udfff]",sa="(?:"+$i+"|"+Zi+")",ws="[^"+Qi+"]",Xi="(?:\\ud83c[\\udde6-\\uddff]){2}",fi="[\\ud800-\\udbff][\\udc00-\\udfff]",fr="["+ds+"]",_s="\\u200d",bs="(?:"+vs+"|"+ms+")",zr="(?:"+fr+"|"+ms+")",Es="(?:"+Pn+"(?:d|ll|m|re|s|t|ve))?",Is="(?:"+Pn+"(?:D|LL|M|RE|S|T|VE))?",xs=sa+"?",Ps="["+gs+"]?",oa="(?:"+_s+"(?:"+[ws,Xi,fi].join("|")+")"+Ps+xs+")*",Jr="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Ss="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Os=Ps+xs+oa,en="(?:"+[na,Xi,fi].join("|")+")"+Os,aa="(?:"+[ws+$i+"?",$i,Xi,fi,Ti].join("|")+")",On=RegExp(Pn,"g"),ca=RegExp($i,"g"),tn=RegExp(Zi+"(?="+Zi+")|"+aa+Os,"g"),Rs=RegExp([fr+"?"+vs+"+"+Es+"(?="+[Sn,fr,"$"].join("|")+")",zr+"+"+Is+"(?="+[Sn,fr+bs,"$"].join("|")+")",fr+"?"+bs+"+"+Es,fr+"+"+Is,Ss,Jr,ys,en].join("|"),"g"),As=RegExp("["+_s+Qi+fs+gs+"]"),Ni=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Cs=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],ua=-1,Me={};Me[at]=Me[Ne]=Me[Et]=Me[Tt]=Me[zt]=Me[Ut]=Me[Dt]=Me[Wt]=Me[er]=!0,Me[Ee]=Me[Ar]=Me[Re]=Me[N]=Me[qe]=Me[T]=Me[I]=Me[Z]=Me[me]=Me[Oe]=Me[Ie]=Me[tt]=Me[Te]=Me[Ke]=Me[Fe]=!1;var Le={};Le[Ee]=Le[Ar]=Le[Re]=Le[qe]=Le[N]=Le[T]=Le[at]=Le[Ne]=Le[Et]=Le[Tt]=Le[zt]=Le[me]=Le[Oe]=Le[Ie]=Le[tt]=Le[Te]=Le[Ke]=Le[Ve]=Le[Ut]=Le[Dt]=Le[Wt]=Le[er]=!0,Le[I]=Le[Z]=Le[Fe]=!1;var m={:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"s"},P={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},M={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},V={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},ze=parseFloat,de=parseInt,We=typeof Qn=="object"&&Qn&&Qn.Object===Object&&Qn,Rt=typeof self=="object"&&self&&self.Object===Object&&self,Pe=We||Rt||Function("return this")(),Ue=t&&!t.nodeType&&t,vt=Ue&&!0&&s&&!s.nodeType&&s,tr=vt&&vt.exports===Ue,At=tr&&We.process,Je=function(){try{var S=vt&&vt.require&&vt.require("util").types;return S||At&&At.binding&&At.binding("util")}catch{}}(),Qt=Je&&Je.isArrayBuffer,Tr=Je&&Je.isDate,wr=Je&&Je.isMap,Ur=Je&&Je.isRegExp,Rn=Je&&Je.isSet,Di=Je&&Je.isTypedArray;function Ft(S,L,$){switch($.length){case 0:return S.call(L);case 1:return S.call(L,$[0]);case 2:return S.call(L,$[0],$[1]);case 3:return S.call(L,$[0],$[1],$[2])}return S.apply(L,$)}function bp(S,L,$,W){for(var fe=-1,Ce=S==null?0:S.length;++fe<Ce;){var $t=S[fe];L(W,$t,$($t),S)}return W}function _r(S,L){for(var $=-1,W=S==null?0:S.length;++$<W&&L(S[$],$,S)!==!1;);return S}function Ep(S,L){for(var $=S==null?0:S.length;$--&&L(S[$],$,S)!==!1;);return S}function su(S,L){for(var $=-1,W=S==null?0:S.length;++$<W;)if(!L(S[$],$,S))return!1;return!0}function pi(S,L){for(var $=-1,W=S==null?0:S.length,fe=0,Ce=[];++$<W;){var $t=S[$];L($t,$,S)&&(Ce[fe++]=$t)}return Ce}function Ts(S,L){var $=S==null?0:S.length;return!!$&&rn(S,L,0)>-1}function ha(S,L,$){for(var W=-1,fe=S==null?0:S.length;++W<fe;)if($(L,S[W]))return!0;return!1}function Ze(S,L){for(var $=-1,W=S==null?0:S.length,fe=Array(W);++$<W;)fe[$]=L(S[$],$,S);return fe}function di(S,L){for(var $=-1,W=L.length,fe=S.length;++$<W;)S[fe+$]=L[$];return S}function la(S,L,$,W){var fe=-1,Ce=S==null?0:S.length;for(W&&Ce&&($=S[++fe]);++fe<Ce;)$=L($,S[fe],fe,S);return $}function Ip(S,L,$,W){var fe=S==null?0:S.length;for(W&&fe&&($=S[--fe]);fe--;)$=L($,S[fe],fe,S);return $}function fa(S,L){for(var $=-1,W=S==null?0:S.length;++$<W;)if(L(S[$],$,S))return!0;return!1}var xp=pa("length");function Pp(S){return S.split("")}function Sp(S){return S.match(Ot)||[]}function ou(S,L,$){var W;return $(S,function(fe,Ce,$t){if(L(fe,Ce,$t))return W=Ce,!1}),W}function $s(S,L,$,W){for(var fe=S.length,Ce=$+(W?1:-1);W?Ce--:++Ce<fe;)if(L(S[Ce],Ce,S))return Ce;return-1}function rn(S,L,$){return L===L?qp(S,L,$):$s(S,au,$)}function Op(S,L,$,W){for(var fe=$-1,Ce=S.length;++fe<Ce;)if(W(S[fe],L))return fe;return-1}function au(S){return S!==S}function cu(S,L){var $=S==null?0:S.length;return $?ga(S,L)/$:B}function pa(S){return function(L){return L==null?r:L[S]}}function da(S){return function(L){return S==null?r:S[L]}}function uu(S,L,$,W,fe){return fe(S,function(Ce,$t,He){$=W?(W=!1,Ce):L($,Ce,$t,He)}),$}function Rp(S,L){var $=S.length;for(S.sort(L);$--;)S[$]=S[$].value;return S}function ga(S,L){for(var $,W=-1,fe=S.length;++W<fe;){var Ce=L(S[W]);Ce!==r&&($=$===r?Ce:$+Ce)}return $}function ya(S,L){for(var $=-1,W=Array(S);++$<S;)W[$]=L($);return W}function Ap(S,L){return Ze(L,function($){return[$,S[$]]})}function hu(S){return S&&S.slice(0,du(S)+1).replace(ft,"")}function pr(S){return function(L){return S(L)}}function va(S,L){return Ze(L,function($){return S[$]})}function An(S,L){return S.has(L)}function lu(S,L){for(var $=-1,W=S.length;++$<W&&rn(L,S[$],0)>-1;);return $}function fu(S,L){for(var $=S.length;$--&&rn(L,S[$],0)>-1;);return $}function Cp(S,L){for(var $=S.length,W=0;$--;)S[$]===L&&++W;return W}var Tp=da(m),$p=da(P);function Np(S){return"\\"+V[S]}function Dp(S,L){return S==null?r:S[L]}function nn(S){return As.test(S)}function Fp(S){return Ni.test(S)}function Lp(S){for(var L,$=[];!(L=S.next()).done;)$.push(L.value);return $}function ma(S){var L=-1,$=Array(S.size);return S.forEach(function(W,fe){$[++L]=[fe,W]}),$}function pu(S,L){return function($){return S(L($))}}function gi(S,L){for(var $=-1,W=S.length,fe=0,Ce=[];++$<W;){var $t=S[$];($t===L||$t===_)&&(S[$]=_,Ce[fe++]=$)}return Ce}function Ns(S){var L=-1,$=Array(S.size);return S.forEach(function(W){$[++L]=W}),$}function jp(S){var L=-1,$=Array(S.size);return S.forEach(function(W){$[++L]=[W,W]}),$}function qp(S,L,$){for(var W=$-1,fe=S.length;++W<fe;)if(S[W]===L)return W;return-1}function Mp(S,L,$){for(var W=$+1;W--;)if(S[W]===L)return W;return W}function sn(S){return nn(S)?Up(S):xp(S)}function $r(S){return nn(S)?Hp(S):Pp(S)}function du(S){for(var L=S.length;L--&&yt.test(S.charAt(L)););return L}var zp=da(M);function Up(S){for(var L=tn.lastIndex=0;tn.test(S);)++L;return L}function Hp(S){return S.match(tn)||[]}function Bp(S){return S.match(Rs)||[]}var kp=function S(L){L=L==null?Pe:on.defaults(Pe.Object(),L,on.pick(Pe,Cs));var $=L.Array,W=L.Date,fe=L.Error,Ce=L.Function,$t=L.Math,He=L.Object,wa=L.RegExp,Kp=L.String,br=L.TypeError,Ds=$.prototype,Vp=Ce.prototype,an=He.prototype,Fs=L["__core-js_shared__"],Ls=Vp.toString,De=an.hasOwnProperty,Gp=0,gu=function(){var e=/[^.]+$/.exec(Fs&&Fs.keys&&Fs.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),js=an.toString,Wp=Ls.call(He),Jp=Pe._,Qp=wa("^"+Ls.call(De).replace(lt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),qs=tr?L.Buffer:r,yi=L.Symbol,Ms=L.Uint8Array,yu=qs?qs.allocUnsafe:r,zs=pu(He.getPrototypeOf,He),vu=He.create,mu=an.propertyIsEnumerable,Us=Ds.splice,wu=yi?yi.isConcatSpreadable:r,Cn=yi?yi.iterator:r,Fi=yi?yi.toStringTag:r,Hs=function(){try{var e=zi(He,"defineProperty");return e({},"",{}),e}catch{}}(),Yp=L.clearTimeout!==Pe.clearTimeout&&L.clearTimeout,Zp=W&&W.now!==Pe.Date.now&&W.now,Xp=L.setTimeout!==Pe.setTimeout&&L.setTimeout,Bs=$t.ceil,ks=$t.floor,_a=He.getOwnPropertySymbols,ed=qs?qs.isBuffer:r,_u=L.isFinite,td=Ds.join,rd=pu(He.keys,He),Nt=$t.max,kt=$t.min,id=W.now,nd=L.parseInt,bu=$t.random,sd=Ds.reverse,ba=zi(L,"DataView"),Tn=zi(L,"Map"),Ea=zi(L,"Promise"),cn=zi(L,"Set"),$n=zi(L,"WeakMap"),Nn=zi(He,"create"),Ks=$n&&new $n,un={},od=Ui(ba),ad=Ui(Tn),cd=Ui(Ea),ud=Ui(cn),hd=Ui($n),Vs=yi?yi.prototype:r,Dn=Vs?Vs.valueOf:r,Eu=Vs?Vs.toString:r;function d(e){if(dt(e)&&!ge(e)&&!(e instanceof xe)){if(e instanceof Er)return e;if(De.call(e,"__wrapped__"))return Ih(e)}return new Er(e)}var hn=function(){function e(){}return function(i){if(!nt(i))return{};if(vu)return vu(i);e.prototype=i;var a=new e;return e.prototype=r,a}}();function Gs(){}function Er(e,i){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!i,this.__index__=0,this.__values__=r}d.templateSettings={escape:ut,evaluate:ht,interpolate:it,variable:"",imports:{_:d}},d.prototype=Gs.prototype,d.prototype.constructor=d,Er.prototype=hn(Gs.prototype),Er.prototype.constructor=Er;function xe(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=k,this.__views__=[]}function ld(){var e=new xe(this.__wrapped__);return e.__actions__=rr(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=rr(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=rr(this.__views__),e}function fd(){if(this.__filtered__){var e=new xe(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function pd(){var e=this.__wrapped__.value(),i=this.__dir__,a=ge(e),u=i<0,f=a?e.length:0,y=Pg(0,f,this.__views__),w=y.start,E=y.end,R=E-w,j=u?E:w-1,q=this.__iteratees__,z=q.length,K=0,X=kt(R,this.__takeCount__);if(!a||!u&&f==R&&X==R)return Vu(e,this.__actions__);var ne=[];e:for(;R--&&K<X;){j+=i;for(var we=-1,se=e[j];++we<z;){var be=q[we],Se=be.iteratee,yr=be.type,Xt=Se(se);if(yr==O)se=Xt;else if(!Xt){if(yr==b)continue e;break e}}ne[K++]=se}return ne}xe.prototype=hn(Gs.prototype),xe.prototype.constructor=xe;function Li(e){var i=-1,a=e==null?0:e.length;for(this.clear();++i<a;){var u=e[i];this.set(u[0],u[1])}}function dd(){this.__data__=Nn?Nn(null):{},this.size=0}function gd(e){var i=this.has(e)&&delete this.__data__[e];return this.size-=i?1:0,i}function yd(e){var i=this.__data__;if(Nn){var a=i[e];return a===v?r:a}return De.call(i,e)?i[e]:r}function vd(e){var i=this.__data__;return Nn?i[e]!==r:De.call(i,e)}function md(e,i){var a=this.__data__;return this.size+=this.has(e)?0:1,a[e]=Nn&&i===r?v:i,this}Li.prototype.clear=dd,Li.prototype.delete=gd,Li.prototype.get=yd,Li.prototype.has=vd,Li.prototype.set=md;function Qr(e){var i=-1,a=e==null?0:e.length;for(this.clear();++i<a;){var u=e[i];this.set(u[0],u[1])}}function wd(){this.__data__=[],this.size=0}function _d(e){var i=this.__data__,a=Ws(i,e);if(a<0)return!1;var u=i.length-1;return a==u?i.pop():Us.call(i,a,1),--this.size,!0}function bd(e){var i=this.__data__,a=Ws(i,e);return a<0?r:i[a][1]}function Ed(e){return Ws(this.__data__,e)>-1}function Id(e,i){var a=this.__data__,u=Ws(a,e);return u<0?(++this.size,a.push([e,i])):a[u][1]=i,this}Qr.prototype.clear=wd,Qr.prototype.delete=_d,Qr.prototype.get=bd,Qr.prototype.has=Ed,Qr.prototype.set=Id;function Yr(e){var i=-1,a=e==null?0:e.length;for(this.clear();++i<a;){var u=e[i];this.set(u[0],u[1])}}function xd(){this.size=0,this.__data__={hash:new Li,map:new(Tn||Qr),string:new Li}}function Pd(e){var i=oo(this,e).delete(e);return this.size-=i?1:0,i}function Sd(e){return oo(this,e).get(e)}function Od(e){return oo(this,e).has(e)}function Rd(e,i){var a=oo(this,e),u=a.size;return a.set(e,i),this.size+=a.size==u?0:1,this}Yr.prototype.clear=xd,Yr.prototype.delete=Pd,Yr.prototype.get=Sd,Yr.prototype.has=Od,Yr.prototype.set=Rd;function ji(e){var i=-1,a=e==null?0:e.length;for(this.__data__=new Yr;++i<a;)this.add(e[i])}function Ad(e){return this.__data__.set(e,v),this}function Cd(e){return this.__data__.has(e)}ji.prototype.add=ji.prototype.push=Ad,ji.prototype.has=Cd;function Nr(e){var i=this.__data__=new Qr(e);this.size=i.size}function Td(){this.__data__=new Qr,this.size=0}function $d(e){var i=this.__data__,a=i.delete(e);return this.size=i.size,a}function Nd(e){return this.__data__.get(e)}function Dd(e){return this.__data__.has(e)}function Fd(e,i){var a=this.__data__;if(a instanceof Qr){var u=a.__data__;if(!Tn||u.length<o-1)return u.push([e,i]),this.size=++a.size,this;a=this.__data__=new Yr(u)}return a.set(e,i),this.size=a.size,this}Nr.prototype.clear=Td,Nr.prototype.delete=$d,Nr.prototype.get=Nd,Nr.prototype.has=Dd,Nr.prototype.set=Fd;function Iu(e,i){var a=ge(e),u=!a&&Hi(e),f=!a&&!u&&bi(e),y=!a&&!u&&!f&&dn(e),w=a||u||f||y,E=w?ya(e.length,Kp):[],R=E.length;for(var j in e)(i||De.call(e,j))&&!(w&&(j=="length"||f&&(j=="offset"||j=="parent")||y&&(j=="buffer"||j=="byteLength"||j=="byteOffset")||ti(j,R)))&&E.push(j);return E}function xu(e){var i=e.length;return i?e[Na(0,i-1)]:r}function Ld(e,i){return ao(rr(e),qi(i,0,e.length))}function jd(e){return ao(rr(e))}function Ia(e,i,a){(a!==r&&!Dr(e[i],a)||a===r&&!(i in e))&&Zr(e,i,a)}function Fn(e,i,a){var u=e[i];(!(De.call(e,i)&&Dr(u,a))||a===r&&!(i in e))&&Zr(e,i,a)}function Ws(e,i){for(var a=e.length;a--;)if(Dr(e[a][0],i))return a;return-1}function qd(e,i,a,u){return vi(e,function(f,y,w){i(u,f,a(f),w)}),u}function Pu(e,i){return e&&Br(i,Lt(i),e)}function Md(e,i){return e&&Br(i,nr(i),e)}function Zr(e,i,a){i=="__proto__"&&Hs?Hs(e,i,{configurable:!0,enumerable:!0,value:a,writable:!0}):e[i]=a}function xa(e,i){for(var a=-1,u=i.length,f=$(u),y=e==null;++a<u;)f[a]=y?r:nc(e,i[a]);return f}function qi(e,i,a){return e===e&&(a!==r&&(e=e<=a?e:a),i!==r&&(e=e>=i?e:i)),e}function Ir(e,i,a,u,f,y){var w,E=i&x,R=i&A,j=i&D;if(a&&(w=f?a(e,u,f,y):a(e)),w!==r)return w;if(!nt(e))return e;var q=ge(e);if(q){if(w=Og(e),!E)return rr(e,w)}else{var z=Kt(e),K=z==Z||z==ue;if(bi(e))return Ju(e,E);if(z==Ie||z==Ee||K&&!f){if(w=R||K?{}:dh(e),!E)return R?yg(e,Md(w,e)):gg(e,Pu(w,e))}else{if(!Le[z])return f?e:{};w=Rg(e,z,E)}}y||(y=new Nr);var X=y.get(e);if(X)return X;y.set(e,w),Bh(e)?e.forEach(function(se){w.add(Ir(se,i,a,se,e,y))}):Uh(e)&&e.forEach(function(se,be){w.set(be,Ir(se,i,a,be,e,y))});var ne=j?R?ka:Ba:R?nr:Lt,we=q?r:ne(e);return _r(we||e,function(se,be){we&&(be=se,se=e[be]),Fn(w,be,Ir(se,i,a,be,e,y))}),w}function zd(e){var i=Lt(e);return function(a){return Su(a,e,i)}}function Su(e,i,a){var u=a.length;if(e==null)return!u;for(e=He(e);u--;){var f=a[u],y=i[f],w=e[f];if(w===r&&!(f in e)||!y(w))return!1}return!0}function Ou(e,i,a){if(typeof e!="function")throw new br(l);return Hn(function(){e.apply(r,a)},i)}function Ln(e,i,a,u){var f=-1,y=Ts,w=!0,E=e.length,R=[],j=i.length;if(!E)return R;a&&(i=Ze(i,pr(a))),u?(y=ha,w=!1):i.length>=o&&(y=An,w=!1,i=new ji(i));e:for(;++f<E;){var q=e[f],z=a==null?q:a(q);if(q=u||q!==0?q:0,w&&z===z){for(var K=j;K--;)if(i[K]===z)continue e;R.push(q)}else y(i,z,u)||R.push(q)}return R}var vi=eh(Hr),Ru=eh(Sa,!0);function Ud(e,i){var a=!0;return vi(e,function(u,f,y){return a=!!i(u,f,y),a}),a}function Js(e,i,a){for(var u=-1,f=e.length;++u<f;){var y=e[u],w=i(y);if(w!=null&&(E===r?w===w&&!gr(w):a(w,E)))var E=w,R=y}return R}function Hd(e,i,a,u){var f=e.length;for(a=ye(a),a<0&&(a=-a>f?0:f+a),u=u===r||u>f?f:ye(u),u<0&&(u+=f),u=a>u?0:Kh(u);a<u;)e[a++]=i;return e}function Au(e,i){var a=[];return vi(e,function(u,f,y){i(u,f,y)&&a.push(u)}),a}function Ht(e,i,a,u,f){var y=-1,w=e.length;for(a||(a=Cg),f||(f=[]);++y<w;){var E=e[y];i>0&&a(E)?i>1?Ht(E,i-1,a,u,f):di(f,E):u||(f[f.length]=E)}return f}var Pa=th(),Cu=th(!0);function Hr(e,i){return e&&Pa(e,i,Lt)}function Sa(e,i){return e&&Cu(e,i,Lt)}function Qs(e,i){return pi(i,function(a){return ri(e[a])})}function Mi(e,i){i=wi(i,e);for(var a=0,u=i.length;e!=null&&a<u;)e=e[kr(i[a++])];return a&&a==u?e:r}function Tu(e,i,a){var u=i(e);return ge(e)?u:di(u,a(e))}function Yt(e){return e==null?e===r?rt:Ae:Fi&&Fi in He(e)?xg(e):jg(e)}function Oa(e,i){return e>i}function Bd(e,i){return e!=null&&De.call(e,i)}function kd(e,i){return e!=null&&i in He(e)}function Kd(e,i,a){return e>=kt(i,a)&&e<Nt(i,a)}function Ra(e,i,a){for(var u=a?ha:Ts,f=e[0].length,y=e.length,w=y,E=$(y),R=1/0,j=[];w--;){var q=e[w];w&&i&&(q=Ze(q,pr(i))),R=kt(q.length,R),E[w]=!a&&(i||f>=120&&q.length>=120)?new ji(w&&q):r}q=e[0];var z=-1,K=E[0];e:for(;++z<f&&j.length<R;){var X=q[z],ne=i?i(X):X;if(X=a||X!==0?X:0,!(K?An(K,ne):u(j,ne,a))){for(w=y;--w;){var we=E[w];if(!(we?An(we,ne):u(e[w],ne,a)))continue e}K&&K.push(ne),j.push(X)}}return j}function Vd(e,i,a,u){return Hr(e,function(f,y,w){i(u,a(f),y,w)}),u}function jn(e,i,a){i=wi(i,e),e=mh(e,i);var u=e==null?e:e[kr(Pr(i))];return u==null?r:Ft(u,e,a)}function $u(e){return dt(e)&&Yt(e)==Ee}function Gd(e){return dt(e)&&Yt(e)==Re}function Wd(e){return dt(e)&&Yt(e)==T}function qn(e,i,a,u,f){return e===i?!0:e==null||i==null||!dt(e)&&!dt(i)?e!==e&&i!==i:Jd(e,i,a,u,qn,f)}function Jd(e,i,a,u,f,y){var w=ge(e),E=ge(i),R=w?Ar:Kt(e),j=E?Ar:Kt(i);R=R==Ee?Ie:R,j=j==Ee?Ie:j;var q=R==Ie,z=j==Ie,K=R==j;if(K&&bi(e)){if(!bi(i))return!1;w=!0,q=!1}if(K&&!q)return y||(y=new Nr),w||dn(e)?lh(e,i,a,u,f,y):Eg(e,i,R,a,u,f,y);if(!(a&C)){var X=q&&De.call(e,"__wrapped__"),ne=z&&De.call(i,"__wrapped__");if(X||ne){var we=X?e.value():e,se=ne?i.value():i;return y||(y=new Nr),f(we,se,a,u,y)}}return K?(y||(y=new Nr),Ig(e,i,a,u,f,y)):!1}function Qd(e){return dt(e)&&Kt(e)==me}function Aa(e,i,a,u){var f=a.length,y=f,w=!u;if(e==null)return!y;for(e=He(e);f--;){var E=a[f];if(w&&E[2]?E[1]!==e[E[0]]:!(E[0]in e))return!1}for(;++f<y;){E=a[f];var R=E[0],j=e[R],q=E[1];if(w&&E[2]){if(j===r&&!(R in e))return!1}else{var z=new Nr;if(u)var K=u(j,q,R,e,i,z);if(!(K===r?qn(q,j,C|J,u,z):K))return!1}}return!0}function Nu(e){if(!nt(e)||$g(e))return!1;var i=ri(e)?Qp:Wo;return i.test(Ui(e))}function Yd(e){return dt(e)&&Yt(e)==tt}function Zd(e){return dt(e)&&Kt(e)==Te}function Xd(e){return dt(e)&&po(e.length)&&!!Me[Yt(e)]}function Du(e){return typeof e=="function"?e:e==null?sr:typeof e=="object"?ge(e)?ju(e[0],e[1]):Lu(e):rl(e)}function Ca(e){if(!Un(e))return rd(e);var i=[];for(var a in He(e))De.call(e,a)&&a!="constructor"&&i.push(a);return i}function eg(e){if(!nt(e))return Lg(e);var i=Un(e),a=[];for(var u in e)u=="constructor"&&(i||!De.call(e,u))||a.push(u);return a}function Ta(e,i){return e<i}function Fu(e,i){var a=-1,u=ir(e)?$(e.length):[];return vi(e,function(f,y,w){u[++a]=i(f,y,w)}),u}function Lu(e){var i=Va(e);return i.length==1&&i[0][2]?yh(i[0][0],i[0][1]):function(a){return a===e||Aa(a,e,i)}}function ju(e,i){return Wa(e)&&gh(i)?yh(kr(e),i):function(a){var u=nc(a,e);return u===r&&u===i?sc(a,e):qn(i,u,C|J)}}function Ys(e,i,a,u,f){e!==i&&Pa(i,function(y,w){if(f||(f=new Nr),nt(y))tg(e,i,w,a,Ys,u,f);else{var E=u?u(Qa(e,w),y,w+"",e,i,f):r;E===r&&(E=y),Ia(e,w,E)}},nr)}function tg(e,i,a,u,f,y,w){var E=Qa(e,a),R=Qa(i,a),j=w.get(R);if(j){Ia(e,a,j);return}var q=y?y(E,R,a+"",e,i,w):r,z=q===r;if(z){var K=ge(R),X=!K&&bi(R),ne=!K&&!X&&dn(R);q=R,K||X||ne?ge(E)?q=E:mt(E)?q=rr(E):X?(z=!1,q=Ju(R,!0)):ne?(z=!1,q=Qu(R,!0)):q=[]:Bn(R)||Hi(R)?(q=E,Hi(E)?q=Vh(E):(!nt(E)||ri(E))&&(q=dh(R))):z=!1}z&&(w.set(R,q),f(q,R,u,y,w),w.delete(R)),Ia(e,a,q)}function qu(e,i){var a=e.length;if(a)return i+=i<0?a:0,ti(i,a)?e[i]:r}function Mu(e,i,a){i.length?i=Ze(i,function(y){return ge(y)?function(w){return Mi(w,y.length===1?y[0]:y)}:y}):i=[sr];var u=-1;i=Ze(i,pr(ie()));var f=Fu(e,function(y,w,E){var R=Ze(i,function(j){return j(y)});return{criteria:R,index:++u,value:y}});return Rp(f,function(y,w){return dg(y,w,a)})}function rg(e,i){return zu(e,i,function(a,u){return sc(e,u)})}function zu(e,i,a){for(var u=-1,f=i.length,y={};++u<f;){var w=i[u],E=Mi(e,w);a(E,w)&&Mn(y,wi(w,e),E)}return y}function ig(e){return function(i){return Mi(i,e)}}function $a(e,i,a,u){var f=u?Op:rn,y=-1,w=i.length,E=e;for(e===i&&(i=rr(i)),a&&(E=Ze(e,pr(a)));++y<w;)for(var R=0,j=i[y],q=a?a(j):j;(R=f(E,q,R,u))>-1;)E!==e&&Us.call(E,R,1),Us.call(e,R,1);return e}function Uu(e,i){for(var a=e?i.length:0,u=a-1;a--;){var f=i[a];if(a==u||f!==y){var y=f;ti(f)?Us.call(e,f,1):La(e,f)}}return e}function Na(e,i){return e+ks(bu()*(i-e+1))}function ng(e,i,a,u){for(var f=-1,y=Nt(Bs((i-e)/(a||1)),0),w=$(y);y--;)w[u?y:++f]=e,e+=a;return w}function Da(e,i){var a="";if(!e||i<1||i>H)return a;do i%2&&(a+=e),i=ks(i/2),i&&(e+=e);while(i);return a}function _e(e,i){return Ya(vh(e,i,sr),e+"")}function sg(e){return xu(gn(e))}function og(e,i){var a=gn(e);return ao(a,qi(i,0,a.length))}function Mn(e,i,a,u){if(!nt(e))return e;i=wi(i,e);for(var f=-1,y=i.length,w=y-1,E=e;E!=null&&++f<y;){var R=kr(i[f]),j=a;if(R==="__proto__"||R==="constructor"||R==="prototype")return e;if(f!=w){var q=E[R];j=u?u(q,R,E):r,j===r&&(j=nt(q)?q:ti(i[f+1])?[]:{})}Fn(E,R,j),E=E[R]}return e}var Hu=Ks?function(e,i){return Ks.set(e,i),e}:sr,ag=Hs?function(e,i){return Hs(e,"toString",{configurable:!0,enumerable:!1,value:ac(i),writable:!0})}:sr;function cg(e){return ao(gn(e))}function xr(e,i,a){var u=-1,f=e.length;i<0&&(i=-i>f?0:f+i),a=a>f?f:a,a<0&&(a+=f),f=i>a?0:a-i>>>0,i>>>=0;for(var y=$(f);++u<f;)y[u]=e[u+i];return y}function ug(e,i){var a;return vi(e,function(u,f,y){return a=i(u,f,y),!a}),!!a}function Zs(e,i,a){var u=0,f=e==null?u:e.length;if(typeof i=="number"&&i===i&&f<=ot){for(;u<f;){var y=u+f>>>1,w=e[y];w!==null&&!gr(w)&&(a?w<=i:w<i)?u=y+1:f=y}return f}return Fa(e,i,sr,a)}function Fa(e,i,a,u){var f=0,y=e==null?0:e.length;if(y===0)return 0;i=a(i);for(var w=i!==i,E=i===null,R=gr(i),j=i===r;f<y;){var q=ks((f+y)/2),z=a(e[q]),K=z!==r,X=z===null,ne=z===z,we=gr(z);if(w)var se=u||ne;else j?se=ne&&(u||K):E?se=ne&&K&&(u||!X):R?se=ne&&K&&!X&&(u||!we):X||we?se=!1:se=u?z<=i:z<i;se?f=q+1:y=q}return kt(y,et)}function Bu(e,i){for(var a=-1,u=e.length,f=0,y=[];++a<u;){var w=e[a],E=i?i(w):w;if(!a||!Dr(E,R)){var R=E;y[f++]=w===0?0:w}}return y}function ku(e){return typeof e=="number"?e:gr(e)?B:+e}function dr(e){if(typeof e=="string")return e;if(ge(e))return Ze(e,dr)+"";if(gr(e))return Eu?Eu.call(e):"";var i=e+"";return i=="0"&&1/e==-le?"-0":i}function mi(e,i,a){var u=-1,f=Ts,y=e.length,w=!0,E=[],R=E;if(a)w=!1,f=ha;else if(y>=o){var j=i?null:_g(e);if(j)return Ns(j);w=!1,f=An,R=new ji}else R=i?[]:E;e:for(;++u<y;){var q=e[u],z=i?i(q):q;if(q=a||q!==0?q:0,w&&z===z){for(var K=R.length;K--;)if(R[K]===z)continue e;i&&R.push(z),E.push(q)}else f(R,z,a)||(R!==E&&R.push(z),E.push(q))}return E}function La(e,i){return i=wi(i,e),e=mh(e,i),e==null||delete e[kr(Pr(i))]}function Ku(e,i,a,u){return Mn(e,i,a(Mi(e,i)),u)}function Xs(e,i,a,u){for(var f=e.length,y=u?f:-1;(u?y--:++y<f)&&i(e[y],y,e););return a?xr(e,u?0:y,u?y+1:f):xr(e,u?y+1:0,u?f:y)}function Vu(e,i){var a=e;return a instanceof xe&&(a=a.value()),la(i,function(u,f){return f.func.apply(f.thisArg,di([u],f.args))},a)}function ja(e,i,a){var u=e.length;if(u<2)return u?mi(e[0]):[];for(var f=-1,y=$(u);++f<u;)for(var w=e[f],E=-1;++E<u;)E!=f&&(y[f]=Ln(y[f]||w,e[E],i,a));return mi(Ht(y,1),i,a)}function Gu(e,i,a){for(var u=-1,f=e.length,y=i.length,w={};++u<f;){var E=u<y?i[u]:r;a(w,e[u],E)}return w}function qa(e){return mt(e)?e:[]}function Ma(e){return typeof e=="function"?e:sr}function wi(e,i){return ge(e)?e:Wa(e,i)?[e]:Eh($e(e))}var hg=_e;function _i(e,i,a){var u=e.length;return a=a===r?u:a,!i&&a>=u?e:xr(e,i,a)}var Wu=Yp||function(e){return Pe.clearTimeout(e)};function Ju(e,i){if(i)return e.slice();var a=e.length,u=yu?yu(a):new e.constructor(a);return e.copy(u),u}function za(e){var i=new e.constructor(e.byteLength);return new Ms(i).set(new Ms(e)),i}function lg(e,i){var a=i?za(e.buffer):e.buffer;return new e.constructor(a,e.byteOffset,e.byteLength)}function fg(e){var i=new e.constructor(e.source,mr.exec(e));return i.lastIndex=e.lastIndex,i}function pg(e){return Dn?He(Dn.call(e)):{}}function Qu(e,i){var a=i?za(e.buffer):e.buffer;return new e.constructor(a,e.byteOffset,e.length)}function Yu(e,i){if(e!==i){var a=e!==r,u=e===null,f=e===e,y=gr(e),w=i!==r,E=i===null,R=i===i,j=gr(i);if(!E&&!j&&!y&&e>i||y&&w&&R&&!E&&!j||u&&w&&R||!a&&R||!f)return 1;if(!u&&!y&&!j&&e<i||j&&a&&f&&!u&&!y||E&&a&&f||!w&&f||!R)return-1}return 0}function dg(e,i,a){for(var u=-1,f=e.criteria,y=i.criteria,w=f.length,E=a.length;++u<w;){var R=Yu(f[u],y[u]);if(R){if(u>=E)return R;var j=a[u];return R*(j=="desc"?-1:1)}}return e.index-i.index}function Zu(e,i,a,u){for(var f=-1,y=e.length,w=a.length,E=-1,R=i.length,j=Nt(y-w,0),q=$(R+j),z=!u;++E<R;)q[E]=i[E];for(;++f<w;)(z||f<y)&&(q[a[f]]=e[f]);for(;j--;)q[E++]=e[f++];return q}function Xu(e,i,a,u){for(var f=-1,y=e.length,w=-1,E=a.length,R=-1,j=i.length,q=Nt(y-E,0),z=$(q+j),K=!u;++f<q;)z[f]=e[f];for(var X=f;++R<j;)z[X+R]=i[R];for(;++w<E;)(K||f<y)&&(z[X+a[w]]=e[f++]);return z}function rr(e,i){var a=-1,u=e.length;for(i||(i=$(u));++a<u;)i[a]=e[a];return i}function Br(e,i,a,u){var f=!a;a||(a={});for(var y=-1,w=i.length;++y<w;){var E=i[y],R=u?u(a[E],e[E],E,a,e):r;R===r&&(R=e[E]),f?Zr(a,E,R):Fn(a,E,R)}return a}function gg(e,i){return Br(e,Ga(e),i)}function yg(e,i){return Br(e,fh(e),i)}function eo(e,i){return function(a,u){var f=ge(a)?bp:qd,y=i?i():{};return f(a,e,ie(u,2),y)}}function ln(e){return _e(function(i,a){var u=-1,f=a.length,y=f>1?a[f-1]:r,w=f>2?a[2]:r;for(y=e.length>3&&typeof y=="function"?(f--,y):r,w&&Zt(a[0],a[1],w)&&(y=f<3?r:y,f=1),i=He(i);++u<f;){var E=a[u];E&&e(i,E,u,y)}return i})}function eh(e,i){return function(a,u){if(a==null)return a;if(!ir(a))return e(a,u);for(var f=a.length,y=i?f:-1,w=He(a);(i?y--:++y<f)&&u(w[y],y,w)!==!1;);return a}}function th(e){return function(i,a,u){for(var f=-1,y=He(i),w=u(i),E=w.length;E--;){var R=w[e?E:++f];if(a(y[R],R,y)===!1)break}return i}}function vg(e,i,a){var u=i&re,f=zn(e);function y(){var w=this&&this!==Pe&&this instanceof y?f:e;return w.apply(u?a:this,arguments)}return y}function rh(e){return function(i){i=$e(i);var a=nn(i)?$r(i):r,u=a?a[0]:i.charAt(0),f=a?_i(a,1).join(""):i.slice(1);return u[e]()+f}}function fn(e){return function(i){return la(el(Xh(i).replace(On,"")),e,"")}}function zn(e){return function(){var i=arguments;switch(i.length){case 0:return new e;case 1:return new e(i[0]);case 2:return new e(i[0],i[1]);case 3:return new e(i[0],i[1],i[2]);case 4:return new e(i[0],i[1],i[2],i[3]);case 5:return new e(i[0],i[1],i[2],i[3],i[4]);case 6:return new e(i[0],i[1],i[2],i[3],i[4],i[5]);case 7:return new e(i[0],i[1],i[2],i[3],i[4],i[5],i[6])}var a=hn(e.prototype),u=e.apply(a,i);return nt(u)?u:a}}function mg(e,i,a){var u=zn(e);function f(){for(var y=arguments.length,w=$(y),E=y,R=pn(f);E--;)w[E]=arguments[E];var j=y<3&&w[0]!==R&&w[y-1]!==R?[]:gi(w,R);if(y-=j.length,y<a)return ah(e,i,to,f.placeholder,r,w,j,r,r,a-y);var q=this&&this!==Pe&&this instanceof f?u:e;return Ft(q,this,w)}return f}function ih(e){return function(i,a,u){var f=He(i);if(!ir(i)){var y=ie(a,3);i=Lt(i),a=function(E){return y(f[E],E,f)}}var w=e(i,a,u);return w>-1?f[y?i[w]:w]:r}}function nh(e){return ei(function(i){var a=i.length,u=a,f=Er.prototype.thru;for(e&&i.reverse();u--;){var y=i[u];if(typeof y!="function")throw new br(l);if(f&&!w&&so(y)=="wrapper")var w=new Er([],!0)}for(u=w?u:a;++u<a;){y=i[u];var E=so(y),R=E=="wrapper"?Ka(y):r;R&&Ja(R[0])&&R[1]==(Y|ae|he|ve)&&!R[4].length&&R[9]==1?w=w[so(R[0])].apply(w,R[3]):w=y.length==1&&Ja(y)?w[E]():w.thru(y)}return function(){var j=arguments,q=j[0];if(w&&j.length==1&&ge(q))return w.plant(q).value();for(var z=0,K=a?i[z].apply(this,j):q;++z<a;)K=i[z].call(this,K);return K}})}function to(e,i,a,u,f,y,w,E,R,j){var q=i&Y,z=i&re,K=i&oe,X=i&(ae|ee),ne=i&_t,we=K?r:zn(e);function se(){for(var be=arguments.length,Se=$(be),yr=be;yr--;)Se[yr]=arguments[yr];if(X)var Xt=pn(se),vr=Cp(Se,Xt);if(u&&(Se=Zu(Se,u,f,X)),y&&(Se=Xu(Se,y,w,X)),be-=vr,X&&be<j){var wt=gi(Se,Xt);return ah(e,i,to,se.placeholder,a,Se,wt,E,R,j-be)}var Fr=z?a:this,ni=K?Fr[e]:e;return be=Se.length,E?Se=qg(Se,E):ne&&be>1&&Se.reverse(),q&&R<be&&(Se.length=R),this&&this!==Pe&&this instanceof se&&(ni=we||zn(ni)),ni.apply(Fr,Se)}return se}function sh(e,i){return function(a,u){return Vd(a,e,i(u),{})}}function ro(e,i){return function(a,u){var f;if(a===r&&u===r)return i;if(a!==r&&(f=a),u!==r){if(f===r)return u;typeof a=="string"||typeof u=="string"?(a=dr(a),u=dr(u)):(a=ku(a),u=ku(u)),f=e(a,u)}return f}}function Ua(e){return ei(function(i){return i=Ze(i,pr(ie())),_e(function(a){var u=this;return e(i,function(f){return Ft(f,u,a)})})})}function io(e,i){i=i===r?" ":dr(i);var a=i.length;if(a<2)return a?Da(i,e):i;var u=Da(i,Bs(e/sn(i)));return nn(i)?_i($r(u),0,e).join(""):u.slice(0,e)}function wg(e,i,a,u){var f=i&re,y=zn(e);function w(){for(var E=-1,R=arguments.length,j=-1,q=u.length,z=$(q+R),K=this&&this!==Pe&&this instanceof w?y:e;++j<q;)z[j]=u[j];for(;R--;)z[j++]=arguments[++E];return Ft(K,f?a:this,z)}return w}function oh(e){return function(i,a,u){return u&&typeof u!="number"&&Zt(i,a,u)&&(a=u=r),i=ii(i),a===r?(a=i,i=0):a=ii(a),u=u===r?i<a?1:-1:ii(u),ng(i,a,u,e)}}function no(e){return function(i,a){return typeof i=="string"&&typeof a=="string"||(i=Sr(i),a=Sr(a)),e(i,a)}}function ah(e,i,a,u,f,y,w,E,R,j){var q=i&ae,z=q?w:r,K=q?r:w,X=q?y:r,ne=q?r:y;i|=q?he:pe,i&=~(q?pe:he),i&ce||(i&=~(re|oe));var we=[e,i,f,X,z,ne,K,E,R,j],se=a.apply(r,we);return Ja(e)&&wh(se,we),se.placeholder=u,_h(se,e,i)}function Ha(e){var i=$t[e];return function(a,u){if(a=Sr(a),u=u==null?0:kt(ye(u),292),u&&_u(a)){var f=($e(a)+"e").split("e"),y=i(f[0]+"e"+(+f[1]+u));return f=($e(y)+"e").split("e"),+(f[0]+"e"+(+f[1]-u))}return i(a)}}var _g=cn&&1/Ns(new cn([,-0]))[1]==le?function(e){return new cn(e)}:hc;function ch(e){return function(i){var a=Kt(i);return a==me?ma(i):a==Te?jp(i):Ap(i,e(i))}}function Xr(e,i,a,u,f,y,w,E){var R=i&oe;if(!R&&typeof e!="function")throw new br(l);var j=u?u.length:0;if(j||(i&=~(he|pe),u=f=r),w=w===r?w:Nt(ye(w),0),E=E===r?E:ye(E),j-=f?f.length:0,i&pe){var q=u,z=f;u=f=r}var K=R?r:Ka(e),X=[e,i,a,u,f,q,z,y,w,E];if(K&&Fg(X,K),e=X[0],i=X[1],a=X[2],u=X[3],f=X[4],E=X[9]=X[9]===r?R?0:e.length:Nt(X[9]-j,0),!E&&i&(ae|ee)&&(i&=~(ae|ee)),!i||i==re)var ne=vg(e,i,a);else i==ae||i==ee?ne=mg(e,i,E):(i==he||i==(re|he))&&!f.length?ne=wg(e,i,a,u):ne=to.apply(r,X);var we=K?Hu:wh;return _h(we(ne,X),e,i)}function uh(e,i,a,u){return e===r||Dr(e,an[a])&&!De.call(u,a)?i:e}function hh(e,i,a,u,f,y){return nt(e)&&nt(i)&&(y.set(i,e),Ys(e,i,r,hh,y),y.delete(i)),e}function bg(e){return Bn(e)?r:e}function lh(e,i,a,u,f,y){var w=a&C,E=e.length,R=i.length;if(E!=R&&!(w&&R>E))return!1;var j=y.get(e),q=y.get(i);if(j&&q)return j==i&&q==e;var z=-1,K=!0,X=a&J?new ji:r;for(y.set(e,i),y.set(i,e);++z<E;){var ne=e[z],we=i[z];if(u)var se=w?u(we,ne,z,i,e,y):u(ne,we,z,e,i,y);if(se!==r){if(se)continue;K=!1;break}if(X){if(!fa(i,function(be,Se){if(!An(X,Se)&&(ne===be||f(ne,be,a,u,y)))return X.push(Se)})){K=!1;break}}else if(!(ne===we||f(ne,we,a,u,y))){K=!1;break}}return y.delete(e),y.delete(i),K}function Eg(e,i,a,u,f,y,w){switch(a){case qe:if(e.byteLength!=i.byteLength||e.byteOffset!=i.byteOffset)return!1;e=e.buffer,i=i.buffer;case Re:return!(e.byteLength!=i.byteLength||!y(new Ms(e),new Ms(i)));case N:case T:case Oe:return Dr(+e,+i);case I:return e.name==i.name&&e.message==i.message;case tt:case Ke:return e==i+"";case me:var E=ma;case Te:var R=u&C;if(E||(E=Ns),e.size!=i.size&&!R)return!1;var j=w.get(e);if(j)return j==i;u|=J,w.set(e,i);var q=lh(E(e),E(i),u,f,y,w);return w.delete(e),q;case Ve:if(Dn)return Dn.call(e)==Dn.call(i)}return!1}function Ig(e,i,a,u,f,y){var w=a&C,E=Ba(e),R=E.length,j=Ba(i),q=j.length;if(R!=q&&!w)return!1;for(var z=R;z--;){var K=E[z];if(!(w?K in i:De.call(i,K)))return!1}var X=y.get(e),ne=y.get(i);if(X&&ne)return X==i&&ne==e;var we=!0;y.set(e,i),y.set(i,e);for(var se=w;++z<R;){K=E[z];var be=e[K],Se=i[K];if(u)var yr=w?u(Se,be,K,i,e,y):u(be,Se,K,e,i,y);if(!(yr===r?be===Se||f(be,Se,a,u,y):yr)){we=!1;break}se||(se=K=="constructor")}if(we&&!se){var Xt=e.constructor,vr=i.constructor;Xt!=vr&&"constructor"in e&&"constructor"in i&&!(typeof Xt=="function"&&Xt instanceof Xt&&typeof vr=="function"&&vr instanceof vr)&&(we=!1)}return y.delete(e),y.delete(i),we}function ei(e){return Ya(vh(e,r,Sh),e+"")}function Ba(e){return Tu(e,Lt,Ga)}function ka(e){return Tu(e,nr,fh)}var Ka=Ks?function(e){return Ks.get(e)}:hc;function so(e){for(var i=e.name+"",a=un[i],u=De.call(un,i)?a.length:0;u--;){var f=a[u],y=f.func;if(y==null||y==e)return f.name}return i}function pn(e){var i=De.call(d,"placeholder")?d:e;return i.placeholder}function ie(){var e=d.iteratee||cc;return e=e===cc?Du:e,arguments.length?e(arguments[0],arguments[1]):e}function oo(e,i){var a=e.__data__;return Tg(i)?a[typeof i=="string"?"string":"hash"]:a.map}function Va(e){for(var i=Lt(e),a=i.length;a--;){var u=i[a],f=e[u];i[a]=[u,f,gh(f)]}return i}function zi(e,i){var a=Dp(e,i);return Nu(a)?a:r}function xg(e){var i=De.call(e,Fi),a=e[Fi];try{e[Fi]=r;var u=!0}catch{}var f=js.call(e);return u&&(i?e[Fi]=a:delete e[Fi]),f}var Ga=_a?function(e){return e==null?[]:(e=He(e),pi(_a(e),function(i){return mu.call(e,i)}))}:lc,fh=_a?function(e){for(var i=[];e;)di(i,Ga(e)),e=zs(e);return i}:lc,Kt=Yt;(ba&&Kt(new ba(new ArrayBuffer(1)))!=qe||Tn&&Kt(new Tn)!=me||Ea&&Kt(Ea.resolve())!=bt||cn&&Kt(new cn)!=Te||$n&&Kt(new $n)!=Fe)&&(Kt=function(e){var i=Yt(e),a=i==Ie?e.constructor:r,u=a?Ui(a):"";if(u)switch(u){case od:return qe;case ad:return me;case cd:return bt;case ud:return Te;case hd:return Fe}return i});function Pg(e,i,a){for(var u=-1,f=a.length;++u<f;){var y=a[u],w=y.size;switch(y.type){case"drop":e+=w;break;case"dropRight":i-=w;break;case"take":i=kt(i,e+w);break;case"takeRight":e=Nt(e,i-w);break}}return{start:e,end:i}}function Sg(e){var i=e.match(Be);return i?i[1].split(St):[]}function ph(e,i,a){i=wi(i,e);for(var u=-1,f=i.length,y=!1;++u<f;){var w=kr(i[u]);if(!(y=e!=null&&a(e,w)))break;e=e[w]}return y||++u!=f?y:(f=e==null?0:e.length,!!f&&po(f)&&ti(w,f)&&(ge(e)||Hi(e)))}function Og(e){var i=e.length,a=new e.constructor(i);return i&&typeof e[0]=="string"&&De.call(e,"index")&&(a.index=e.index,a.input=e.input),a}function dh(e){return typeof e.constructor=="function"&&!Un(e)?hn(zs(e)):{}}function Rg(e,i,a){var u=e.constructor;switch(i){case Re:return za(e);case N:case T:return new u(+e);case qe:return lg(e,a);case at:case Ne:case Et:case Tt:case zt:case Ut:case Dt:case Wt:case er:return Qu(e,a);case me:return new u;case Oe:case Ke:return new u(e);case tt:return fg(e);case Te:return new u;case Ve:return pg(e)}}function Ag(e,i){var a=i.length;if(!a)return e;var u=a-1;return i[u]=(a>1?"& ":"")+i[u],i=i.join(a>2?", ":" "),e.replace(pt,`{
/* [wrapped with `+i+`] */
`)}function Cg(e){return ge(e)||Hi(e)||!!(wu&&e&&e[wu])}function ti(e,i){var a=typeof e;return i=i??H,!!i&&(a=="number"||a!="symbol"&&Qo.test(e))&&e>-1&&e%1==0&&e<i}function Zt(e,i,a){if(!nt(a))return!1;var u=typeof i;return(u=="number"?ir(a)&&ti(i,a.length):u=="string"&&i in a)?Dr(a[i],e):!1}function Wa(e,i){if(ge(e))return!1;var a=typeof e;return a=="number"||a=="symbol"||a=="boolean"||e==null||gr(e)?!0:It.test(e)||!Ye.test(e)||i!=null&&e in He(i)}function Tg(e){var i=typeof e;return i=="string"||i=="number"||i=="symbol"||i=="boolean"?e!=="__proto__":e===null}function Ja(e){var i=so(e),a=d[i];if(typeof a!="function"||!(i in xe.prototype))return!1;if(e===a)return!0;var u=Ka(a);return!!u&&e===u[0]}function $g(e){return!!gu&&gu in e}var Ng=Fs?ri:fc;function Un(e){var i=e&&e.constructor,a=typeof i=="function"&&i.prototype||an;return e===a}function gh(e){return e===e&&!nt(e)}function yh(e,i){return function(a){return a==null?!1:a[e]===i&&(i!==r||e in He(a))}}function Dg(e){var i=lo(e,function(u){return a.size===p&&a.clear(),u}),a=i.cache;return i}function Fg(e,i){var a=e[1],u=i[1],f=a|u,y=f<(re|oe|Y),w=u==Y&&a==ae||u==Y&&a==ve&&e[7].length<=i[8]||u==(Y|ve)&&i[7].length<=i[8]&&a==ae;if(!(y||w))return e;u&re&&(e[2]=i[2],f|=a&re?0:ce);var E=i[3];if(E){var R=e[3];e[3]=R?Zu(R,E,i[4]):E,e[4]=R?gi(e[3],_):i[4]}return E=i[5],E&&(R=e[5],e[5]=R?Xu(R,E,i[6]):E,e[6]=R?gi(e[5],_):i[6]),E=i[7],E&&(e[7]=E),u&Y&&(e[8]=e[8]==null?i[8]:kt(e[8],i[8])),e[9]==null&&(e[9]=i[9]),e[0]=i[0],e[1]=f,e}function Lg(e){var i=[];if(e!=null)for(var a in He(e))i.push(a);return i}function jg(e){return js.call(e)}function vh(e,i,a){return i=Nt(i===r?e.length-1:i,0),function(){for(var u=arguments,f=-1,y=Nt(u.length-i,0),w=$(y);++f<y;)w[f]=u[i+f];f=-1;for(var E=$(i+1);++f<i;)E[f]=u[f];return E[i]=a(w),Ft(e,this,E)}}function mh(e,i){return i.length<2?e:Mi(e,xr(i,0,-1))}function qg(e,i){for(var a=e.length,u=kt(i.length,a),f=rr(e);u--;){var y=i[u];e[u]=ti(y,a)?f[y]:r}return e}function Qa(e,i){if(!(i==="constructor"&&typeof e[i]=="function")&&i!="__proto__")return e[i]}var wh=bh(Hu),Hn=Xp||function(e,i){return Pe.setTimeout(e,i)},Ya=bh(ag);function _h(e,i,a){var u=i+"";return Ya(e,Ag(u,Mg(Sg(u),a)))}function bh(e){var i=0,a=0;return function(){var u=id(),f=Mt-(u-a);if(a=u,f>0){if(++i>=qt)return arguments[0]}else i=0;return e.apply(r,arguments)}}function ao(e,i){var a=-1,u=e.length,f=u-1;for(i=i===r?u:i;++a<i;){var y=Na(a,f),w=e[y];e[y]=e[a],e[a]=w}return e.length=i,e}var Eh=Dg(function(e){var i=[];return e.charCodeAt(0)===46&&i.push(""),e.replace(xt,function(a,u,f,y){i.push(f?y.replace(ko,"$1"):u||a)}),i});function kr(e){if(typeof e=="string"||gr(e))return e;var i=e+"";return i=="0"&&1/e==-le?"-0":i}function Ui(e){if(e!=null){try{return Ls.call(e)}catch{}try{return e+""}catch{}}return""}function Mg(e,i){return _r(Ri,function(a){var u="_."+a[0];i&a[1]&&!Ts(e,u)&&e.push(u)}),e.sort()}function Ih(e){if(e instanceof xe)return e.clone();var i=new Er(e.__wrapped__,e.__chain__);return i.__actions__=rr(e.__actions__),i.__index__=e.__index__,i.__values__=e.__values__,i}function zg(e,i,a){(a?Zt(e,i,a):i===r)?i=1:i=Nt(ye(i),0);var u=e==null?0:e.length;if(!u||i<1)return[];for(var f=0,y=0,w=$(Bs(u/i));f<u;)w[y++]=xr(e,f,f+=i);return w}function Ug(e){for(var i=-1,a=e==null?0:e.length,u=0,f=[];++i<a;){var y=e[i];y&&(f[u++]=y)}return f}function Hg(){var e=arguments.length;if(!e)return[];for(var i=$(e-1),a=arguments[0],u=e;u--;)i[u-1]=arguments[u];return di(ge(a)?rr(a):[a],Ht(i,1))}var Bg=_e(function(e,i){return mt(e)?Ln(e,Ht(i,1,mt,!0)):[]}),kg=_e(function(e,i){var a=Pr(i);return mt(a)&&(a=r),mt(e)?Ln(e,Ht(i,1,mt,!0),ie(a,2)):[]}),Kg=_e(function(e,i){var a=Pr(i);return mt(a)&&(a=r),mt(e)?Ln(e,Ht(i,1,mt,!0),r,a):[]});function Vg(e,i,a){var u=e==null?0:e.length;return u?(i=a||i===r?1:ye(i),xr(e,i<0?0:i,u)):[]}function Gg(e,i,a){var u=e==null?0:e.length;return u?(i=a||i===r?1:ye(i),i=u-i,xr(e,0,i<0?0:i)):[]}function Wg(e,i){return e&&e.length?Xs(e,ie(i,3),!0,!0):[]}function Jg(e,i){return e&&e.length?Xs(e,ie(i,3),!0):[]}function Qg(e,i,a,u){var f=e==null?0:e.length;return f?(a&&typeof a!="number"&&Zt(e,i,a)&&(a=0,u=f),Hd(e,i,a,u)):[]}function xh(e,i,a){var u=e==null?0:e.length;if(!u)return-1;var f=a==null?0:ye(a);return f<0&&(f=Nt(u+f,0)),$s(e,ie(i,3),f)}function Ph(e,i,a){var u=e==null?0:e.length;if(!u)return-1;var f=u-1;return a!==r&&(f=ye(a),f=a<0?Nt(u+f,0):kt(f,u-1)),$s(e,ie(i,3),f,!0)}function Sh(e){var i=e==null?0:e.length;return i?Ht(e,1):[]}function Yg(e){var i=e==null?0:e.length;return i?Ht(e,le):[]}function Zg(e,i){var a=e==null?0:e.length;return a?(i=i===r?1:ye(i),Ht(e,i)):[]}function Xg(e){for(var i=-1,a=e==null?0:e.length,u={};++i<a;){var f=e[i];u[f[0]]=f[1]}return u}function Oh(e){return e&&e.length?e[0]:r}function ey(e,i,a){var u=e==null?0:e.length;if(!u)return-1;var f=a==null?0:ye(a);return f<0&&(f=Nt(u+f,0)),rn(e,i,f)}function ty(e){var i=e==null?0:e.length;return i?xr(e,0,-1):[]}var ry=_e(function(e){var i=Ze(e,qa);return i.length&&i[0]===e[0]?Ra(i):[]}),iy=_e(function(e){var i=Pr(e),a=Ze(e,qa);return i===Pr(a)?i=r:a.pop(),a.length&&a[0]===e[0]?Ra(a,ie(i,2)):[]}),ny=_e(function(e){var i=Pr(e),a=Ze(e,qa);return i=typeof i=="function"?i:r,i&&a.pop(),a.length&&a[0]===e[0]?Ra(a,r,i):[]});function sy(e,i){return e==null?"":td.call(e,i)}function Pr(e){var i=e==null?0:e.length;return i?e[i-1]:r}function oy(e,i,a){var u=e==null?0:e.length;if(!u)return-1;var f=u;return a!==r&&(f=ye(a),f=f<0?Nt(u+f,0):kt(f,u-1)),i===i?Mp(e,i,f):$s(e,au,f,!0)}function ay(e,i){return e&&e.length?qu(e,ye(i)):r}var cy=_e(Rh);function Rh(e,i){return e&&e.length&&i&&i.length?$a(e,i):e}function uy(e,i,a){return e&&e.length&&i&&i.length?$a(e,i,ie(a,2)):e}function hy(e,i,a){return e&&e.length&&i&&i.length?$a(e,i,r,a):e}var ly=ei(function(e,i){var a=e==null?0:e.length,u=xa(e,i);return Uu(e,Ze(i,function(f){return ti(f,a)?+f:f}).sort(Yu)),u});function fy(e,i){var a=[];if(!(e&&e.length))return a;var u=-1,f=[],y=e.length;for(i=ie(i,3);++u<y;){var w=e[u];i(w,u,e)&&(a.push(w),f.push(u))}return Uu(e,f),a}function Za(e){return e==null?e:sd.call(e)}function py(e,i,a){var u=e==null?0:e.length;return u?(a&&typeof a!="number"&&Zt(e,i,a)?(i=0,a=u):(i=i==null?0:ye(i),a=a===r?u:ye(a)),xr(e,i,a)):[]}function dy(e,i){return Zs(e,i)}function gy(e,i,a){return Fa(e,i,ie(a,2))}function yy(e,i){var a=e==null?0:e.length;if(a){var u=Zs(e,i);if(u<a&&Dr(e[u],i))return u}return-1}function vy(e,i){return Zs(e,i,!0)}function my(e,i,a){return Fa(e,i,ie(a,2),!0)}function wy(e,i){var a=e==null?0:e.length;if(a){var u=Zs(e,i,!0)-1;if(Dr(e[u],i))return u}return-1}function _y(e){return e&&e.length?Bu(e):[]}function by(e,i){return e&&e.length?Bu(e,ie(i,2)):[]}function Ey(e){var i=e==null?0:e.length;return i?xr(e,1,i):[]}function Iy(e,i,a){return e&&e.length?(i=a||i===r?1:ye(i),xr(e,0,i<0?0:i)):[]}function xy(e,i,a){var u=e==null?0:e.length;return u?(i=a||i===r?1:ye(i),i=u-i,xr(e,i<0?0:i,u)):[]}function Py(e,i){return e&&e.length?Xs(e,ie(i,3),!1,!0):[]}function Sy(e,i){return e&&e.length?Xs(e,ie(i,3)):[]}var Oy=_e(function(e){return mi(Ht(e,1,mt,!0))}),Ry=_e(function(e){var i=Pr(e);return mt(i)&&(i=r),mi(Ht(e,1,mt,!0),ie(i,2))}),Ay=_e(function(e){var i=Pr(e);return i=typeof i=="function"?i:r,mi(Ht(e,1,mt,!0),r,i)});function Cy(e){return e&&e.length?mi(e):[]}function Ty(e,i){return e&&e.length?mi(e,ie(i,2)):[]}function $y(e,i){return i=typeof i=="function"?i:r,e&&e.length?mi(e,r,i):[]}function Xa(e){if(!(e&&e.length))return[];var i=0;return e=pi(e,function(a){if(mt(a))return i=Nt(a.length,i),!0}),ya(i,function(a){return Ze(e,pa(a))})}function Ah(e,i){if(!(e&&e.length))return[];var a=Xa(e);return i==null?a:Ze(a,function(u){return Ft(i,r,u)})}var Ny=_e(function(e,i){return mt(e)?Ln(e,i):[]}),Dy=_e(function(e){return ja(pi(e,mt))}),Fy=_e(function(e){var i=Pr(e);return mt(i)&&(i=r),ja(pi(e,mt),ie(i,2))}),Ly=_e(function(e){var i=Pr(e);return i=typeof i=="function"?i:r,ja(pi(e,mt),r,i)}),jy=_e(Xa);function qy(e,i){return Gu(e||[],i||[],Fn)}function My(e,i){return Gu(e||[],i||[],Mn)}var zy=_e(function(e){var i=e.length,a=i>1?e[i-1]:r;return a=typeof a=="function"?(e.pop(),a):r,Ah(e,a)});function Ch(e){var i=d(e);return i.__chain__=!0,i}function Uy(e,i){return i(e),e}function co(e,i){return i(e)}var Hy=ei(function(e){var i=e.length,a=i?e[0]:0,u=this.__wrapped__,f=function(y){return xa(y,e)};return i>1||this.__actions__.length||!(u instanceof xe)||!ti(a)?this.thru(f):(u=u.slice(a,+a+(i?1:0)),u.__actions__.push({func:co,args:[f],thisArg:r}),new Er(u,this.__chain__).thru(function(y){return i&&!y.length&&y.push(r),y}))});function By(){return Ch(this)}function ky(){return new Er(this.value(),this.__chain__)}function Ky(){this.__values__===r&&(this.__values__=kh(this.value()));var e=this.__index__>=this.__values__.length,i=e?r:this.__values__[this.__index__++];return{done:e,value:i}}function Vy(){return this}function Gy(e){for(var i,a=this;a instanceof Gs;){var u=Ih(a);u.__index__=0,u.__values__=r,i?f.__wrapped__=u:i=u;var f=u;a=a.__wrapped__}return f.__wrapped__=e,i}function Wy(){var e=this.__wrapped__;if(e instanceof xe){var i=e;return this.__actions__.length&&(i=new xe(this)),i=i.reverse(),i.__actions__.push({func:co,args:[Za],thisArg:r}),new Er(i,this.__chain__)}return this.thru(Za)}function Jy(){return Vu(this.__wrapped__,this.__actions__)}var Qy=eo(function(e,i,a){De.call(e,a)?++e[a]:Zr(e,a,1)});function Yy(e,i,a){var u=ge(e)?su:Ud;return a&&Zt(e,i,a)&&(i=r),u(e,ie(i,3))}function Zy(e,i){var a=ge(e)?pi:Au;return a(e,ie(i,3))}var Xy=ih(xh),ev=ih(Ph);function tv(e,i){return Ht(uo(e,i),1)}function rv(e,i){return Ht(uo(e,i),le)}function iv(e,i,a){return a=a===r?1:ye(a),Ht(uo(e,i),a)}function Th(e,i){var a=ge(e)?_r:vi;return a(e,ie(i,3))}function $h(e,i){var a=ge(e)?Ep:Ru;return a(e,ie(i,3))}var nv=eo(function(e,i,a){De.call(e,a)?e[a].push(i):Zr(e,a,[i])});function sv(e,i,a,u){e=ir(e)?e:gn(e),a=a&&!u?ye(a):0;var f=e.length;return a<0&&(a=Nt(f+a,0)),go(e)?a<=f&&e.indexOf(i,a)>-1:!!f&&rn(e,i,a)>-1}var ov=_e(function(e,i,a){var u=-1,f=typeof i=="function",y=ir(e)?$(e.length):[];return vi(e,function(w){y[++u]=f?Ft(i,w,a):jn(w,i,a)}),y}),av=eo(function(e,i,a){Zr(e,a,i)});function uo(e,i){var a=ge(e)?Ze:Fu;return a(e,ie(i,3))}function cv(e,i,a,u){return e==null?[]:(ge(i)||(i=i==null?[]:[i]),a=u?r:a,ge(a)||(a=a==null?[]:[a]),Mu(e,i,a))}var uv=eo(function(e,i,a){e[a?0:1].push(i)},function(){return[[],[]]});function hv(e,i,a){var u=ge(e)?la:uu,f=arguments.length<3;return u(e,ie(i,4),a,f,vi)}function lv(e,i,a){var u=ge(e)?Ip:uu,f=arguments.length<3;return u(e,ie(i,4),a,f,Ru)}function fv(e,i){var a=ge(e)?pi:Au;return a(e,fo(ie(i,3)))}function pv(e){var i=ge(e)?xu:sg;return i(e)}function dv(e,i,a){(a?Zt(e,i,a):i===r)?i=1:i=ye(i);var u=ge(e)?Ld:og;return u(e,i)}function gv(e){var i=ge(e)?jd:cg;return i(e)}function yv(e){if(e==null)return 0;if(ir(e))return go(e)?sn(e):e.length;var i=Kt(e);return i==me||i==Te?e.size:Ca(e).length}function vv(e,i,a){var u=ge(e)?fa:ug;return a&&Zt(e,i,a)&&(i=r),u(e,ie(i,3))}var mv=_e(function(e,i){if(e==null)return[];var a=i.length;return a>1&&Zt(e,i[0],i[1])?i=[]:a>2&&Zt(i[0],i[1],i[2])&&(i=[i[0]]),Mu(e,Ht(i,1),[])}),ho=Zp||function(){return Pe.Date.now()};function wv(e,i){if(typeof i!="function")throw new br(l);return e=ye(e),function(){if(--e<1)return i.apply(this,arguments)}}function Nh(e,i,a){return i=a?r:i,i=e&&i==null?e.length:i,Xr(e,Y,r,r,r,r,i)}function Dh(e,i){var a;if(typeof i!="function")throw new br(l);return e=ye(e),function(){return--e>0&&(a=i.apply(this,arguments)),e<=1&&(i=r),a}}var ec=_e(function(e,i,a){var u=re;if(a.length){var f=gi(a,pn(ec));u|=he}return Xr(e,u,i,a,f)}),Fh=_e(function(e,i,a){var u=re|oe;if(a.length){var f=gi(a,pn(Fh));u|=he}return Xr(i,u,e,a,f)});function Lh(e,i,a){i=a?r:i;var u=Xr(e,ae,r,r,r,r,r,i);return u.placeholder=Lh.placeholder,u}function jh(e,i,a){i=a?r:i;var u=Xr(e,ee,r,r,r,r,r,i);return u.placeholder=jh.placeholder,u}function qh(e,i,a){var u,f,y,w,E,R,j=0,q=!1,z=!1,K=!0;if(typeof e!="function")throw new br(l);i=Sr(i)||0,nt(a)&&(q=!!a.leading,z="maxWait"in a,y=z?Nt(Sr(a.maxWait)||0,i):y,K="trailing"in a?!!a.trailing:K);function X(wt){var Fr=u,ni=f;return u=f=r,j=wt,w=e.apply(ni,Fr),w}function ne(wt){return j=wt,E=Hn(be,i),q?X(wt):w}function we(wt){var Fr=wt-R,ni=wt-j,il=i-Fr;return z?kt(il,y-ni):il}function se(wt){var Fr=wt-R,ni=wt-j;return R===r||Fr>=i||Fr<0||z&&ni>=y}function be(){var wt=ho();if(se(wt))return Se(wt);E=Hn(be,we(wt))}function Se(wt){return E=r,K&&u?X(wt):(u=f=r,w)}function yr(){E!==r&&Wu(E),j=0,u=R=f=E=r}function Xt(){return E===r?w:Se(ho())}function vr(){var wt=ho(),Fr=se(wt);if(u=arguments,f=this,R=wt,Fr){if(E===r)return ne(R);if(z)return Wu(E),E=Hn(be,i),X(R)}return E===r&&(E=Hn(be,i)),w}return vr.cancel=yr,vr.flush=Xt,vr}var _v=_e(function(e,i){return Ou(e,1,i)}),bv=_e(function(e,i,a){return Ou(e,Sr(i)||0,a)});function Ev(e){return Xr(e,_t)}function lo(e,i){if(typeof e!="function"||i!=null&&typeof i!="function")throw new br(l);var a=function(){var u=arguments,f=i?i.apply(this,u):u[0],y=a.cache;if(y.has(f))return y.get(f);var w=e.apply(this,u);return a.cache=y.set(f,w)||y,w};return a.cache=new(lo.Cache||Yr),a}lo.Cache=Yr;function fo(e){if(typeof e!="function")throw new br(l);return function(){var i=arguments;switch(i.length){case 0:return!e.call(this);case 1:return!e.call(this,i[0]);case 2:return!e.call(this,i[0],i[1]);case 3:return!e.call(this,i[0],i[1],i[2])}return!e.apply(this,i)}}function Iv(e){return Dh(2,e)}var xv=hg(function(e,i){i=i.length==1&&ge(i[0])?Ze(i[0],pr(ie())):Ze(Ht(i,1),pr(ie()));var a=i.length;return _e(function(u){for(var f=-1,y=kt(u.length,a);++f<y;)u[f]=i[f].call(this,u[f]);return Ft(e,this,u)})}),tc=_e(function(e,i){var a=gi(i,pn(tc));return Xr(e,he,r,i,a)}),Mh=_e(function(e,i){var a=gi(i,pn(Mh));return Xr(e,pe,r,i,a)}),Pv=ei(function(e,i){return Xr(e,ve,r,r,r,i)});function Sv(e,i){if(typeof e!="function")throw new br(l);return i=i===r?i:ye(i),_e(e,i)}function Ov(e,i){if(typeof e!="function")throw new br(l);return i=i==null?0:Nt(ye(i),0),_e(function(a){var u=a[i],f=_i(a,0,i);return u&&di(f,u),Ft(e,this,f)})}function Rv(e,i,a){var u=!0,f=!0;if(typeof e!="function")throw new br(l);return nt(a)&&(u="leading"in a?!!a.leading:u,f="trailing"in a?!!a.trailing:f),qh(e,i,{leading:u,maxWait:i,trailing:f})}function Av(e){return Nh(e,1)}function Cv(e,i){return tc(Ma(i),e)}function Tv(){if(!arguments.length)return[];var e=arguments[0];return ge(e)?e:[e]}function $v(e){return Ir(e,D)}function Nv(e,i){return i=typeof i=="function"?i:r,Ir(e,D,i)}function Dv(e){return Ir(e,x|D)}function Fv(e,i){return i=typeof i=="function"?i:r,Ir(e,x|D,i)}function Lv(e,i){return i==null||Su(e,i,Lt(i))}function Dr(e,i){return e===i||e!==e&&i!==i}var jv=no(Oa),qv=no(function(e,i){return e>=i}),Hi=$u(function(){return arguments}())?$u:function(e){return dt(e)&&De.call(e,"callee")&&!mu.call(e,"callee")},ge=$.isArray,Mv=Qt?pr(Qt):Gd;function ir(e){return e!=null&&po(e.length)&&!ri(e)}function mt(e){return dt(e)&&ir(e)}function zv(e){return e===!0||e===!1||dt(e)&&Yt(e)==N}var bi=ed||fc,Uv=Tr?pr(Tr):Wd;function Hv(e){return dt(e)&&e.nodeType===1&&!Bn(e)}function Bv(e){if(e==null)return!0;if(ir(e)&&(ge(e)||typeof e=="string"||typeof e.splice=="function"||bi(e)||dn(e)||Hi(e)))return!e.length;var i=Kt(e);if(i==me||i==Te)return!e.size;if(Un(e))return!Ca(e).length;for(var a in e)if(De.call(e,a))return!1;return!0}function kv(e,i){return qn(e,i)}function Kv(e,i,a){a=typeof a=="function"?a:r;var u=a?a(e,i):r;return u===r?qn(e,i,r,a):!!u}function rc(e){if(!dt(e))return!1;var i=Yt(e);return i==I||i==h||typeof e.message=="string"&&typeof e.name=="string"&&!Bn(e)}function Vv(e){return typeof e=="number"&&_u(e)}function ri(e){if(!nt(e))return!1;var i=Yt(e);return i==Z||i==ue||i==F||i==gt}function zh(e){return typeof e=="number"&&e==ye(e)}function po(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=H}function nt(e){var i=typeof e;return e!=null&&(i=="object"||i=="function")}function dt(e){return e!=null&&typeof e=="object"}var Uh=wr?pr(wr):Qd;function Gv(e,i){return e===i||Aa(e,i,Va(i))}function Wv(e,i,a){return a=typeof a=="function"?a:r,Aa(e,i,Va(i),a)}function Jv(e){return Hh(e)&&e!=+e}function Qv(e){if(Ng(e))throw new fe(c);return Nu(e)}function Yv(e){return e===null}function Zv(e){return e==null}function Hh(e){return typeof e=="number"||dt(e)&&Yt(e)==Oe}function Bn(e){if(!dt(e)||Yt(e)!=Ie)return!1;var i=zs(e);if(i===null)return!0;var a=De.call(i,"constructor")&&i.constructor;return typeof a=="function"&&a instanceof a&&Ls.call(a)==Wp}var ic=Ur?pr(Ur):Yd;function Xv(e){return zh(e)&&e>=-H&&e<=H}var Bh=Rn?pr(Rn):Zd;function go(e){return typeof e=="string"||!ge(e)&&dt(e)&&Yt(e)==Ke}function gr(e){return typeof e=="symbol"||dt(e)&&Yt(e)==Ve}var dn=Di?pr(Di):Xd;function e0(e){return e===r}function t0(e){return dt(e)&&Kt(e)==Fe}function r0(e){return dt(e)&&Yt(e)==Ge}var i0=no(Ta),n0=no(function(e,i){return e<=i});function kh(e){if(!e)return[];if(ir(e))return go(e)?$r(e):rr(e);if(Cn&&e[Cn])return Lp(e[Cn]());var i=Kt(e),a=i==me?ma:i==Te?Ns:gn;return a(e)}function ii(e){if(!e)return e===0?e:0;if(e=Sr(e),e===le||e===-le){var i=e<0?-1:1;return i*U}return e===e?e:0}function ye(e){var i=ii(e),a=i%1;return i===i?a?i-a:i:0}function Kh(e){return e?qi(ye(e),0,k):0}function Sr(e){if(typeof e=="number")return e;if(gr(e))return B;if(nt(e)){var i=typeof e.valueOf=="function"?e.valueOf():e;e=nt(i)?i+"":i}if(typeof e!="string")return e===0?e:+e;e=hu(e);var a=Go.test(e);return a||Jo.test(e)?de(e.slice(2),a?2:8):Vo.test(e)?B:+e}function Vh(e){return Br(e,nr(e))}function s0(e){return e?qi(ye(e),-H,H):e===0?e:0}function $e(e){return e==null?"":dr(e)}var o0=ln(function(e,i){if(Un(i)||ir(i)){Br(i,Lt(i),e);return}for(var a in i)De.call(i,a)&&Fn(e,a,i[a])}),Gh=ln(function(e,i){Br(i,nr(i),e)}),yo=ln(function(e,i,a,u){Br(i,nr(i),e,u)}),a0=ln(function(e,i,a,u){Br(i,Lt(i),e,u)}),c0=ei(xa);function u0(e,i){var a=hn(e);return i==null?a:Pu(a,i)}var h0=_e(function(e,i){e=He(e);var a=-1,u=i.length,f=u>2?i[2]:r;for(f&&Zt(i[0],i[1],f)&&(u=1);++a<u;)for(var y=i[a],w=nr(y),E=-1,R=w.length;++E<R;){var j=w[E],q=e[j];(q===r||Dr(q,an[j])&&!De.call(e,j))&&(e[j]=y[j])}return e}),l0=_e(function(e){return e.push(r,hh),Ft(Wh,r,e)});function f0(e,i){return ou(e,ie(i,3),Hr)}function p0(e,i){return ou(e,ie(i,3),Sa)}function d0(e,i){return e==null?e:Pa(e,ie(i,3),nr)}function g0(e,i){return e==null?e:Cu(e,ie(i,3),nr)}function y0(e,i){return e&&Hr(e,ie(i,3))}function v0(e,i){return e&&Sa(e,ie(i,3))}function m0(e){return e==null?[]:Qs(e,Lt(e))}function w0(e){return e==null?[]:Qs(e,nr(e))}function nc(e,i,a){var u=e==null?r:Mi(e,i);return u===r?a:u}function _0(e,i){return e!=null&&ph(e,i,Bd)}function sc(e,i){return e!=null&&ph(e,i,kd)}var b0=sh(function(e,i,a){i!=null&&typeof i.toString!="function"&&(i=js.call(i)),e[i]=a},ac(sr)),E0=sh(function(e,i,a){i!=null&&typeof i.toString!="function"&&(i=js.call(i)),De.call(e,i)?e[i].push(a):e[i]=[a]},ie),I0=_e(jn);function Lt(e){return ir(e)?Iu(e):Ca(e)}function nr(e){return ir(e)?Iu(e,!0):eg(e)}function x0(e,i){var a={};return i=ie(i,3),Hr(e,function(u,f,y){Zr(a,i(u,f,y),u)}),a}function P0(e,i){var a={};return i=ie(i,3),Hr(e,function(u,f,y){Zr(a,f,i(u,f,y))}),a}var S0=ln(function(e,i,a){Ys(e,i,a)}),Wh=ln(function(e,i,a,u){Ys(e,i,a,u)}),O0=ei(function(e,i){var a={};if(e==null)return a;var u=!1;i=Ze(i,function(y){return y=wi(y,e),u||(u=y.length>1),y}),Br(e,ka(e),a),u&&(a=Ir(a,x|A|D,bg));for(var f=i.length;f--;)La(a,i[f]);return a});function R0(e,i){return Jh(e,fo(ie(i)))}var A0=ei(function(e,i){return e==null?{}:rg(e,i)});function Jh(e,i){if(e==null)return{};var a=Ze(ka(e),function(u){return[u]});return i=ie(i),zu(e,a,function(u,f){return i(u,f[0])})}function C0(e,i,a){i=wi(i,e);var u=-1,f=i.length;for(f||(f=1,e=r);++u<f;){var y=e==null?r:e[kr(i[u])];y===r&&(u=f,y=a),e=ri(y)?y.call(e):y}return e}function T0(e,i,a){return e==null?e:Mn(e,i,a)}function $0(e,i,a,u){return u=typeof u=="function"?u:r,e==null?e:Mn(e,i,a,u)}var Qh=ch(Lt),Yh=ch(nr);function N0(e,i,a){var u=ge(e),f=u||bi(e)||dn(e);if(i=ie(i,4),a==null){var y=e&&e.constructor;f?a=u?new y:[]:nt(e)?a=ri(y)?hn(zs(e)):{}:a={}}return(f?_r:Hr)(e,function(w,E,R){return i(a,w,E,R)}),a}function D0(e,i){return e==null?!0:La(e,i)}function F0(e,i,a){return e==null?e:Ku(e,i,Ma(a))}function L0(e,i,a,u){return u=typeof u=="function"?u:r,e==null?e:Ku(e,i,Ma(a),u)}function gn(e){return e==null?[]:va(e,Lt(e))}function j0(e){return e==null?[]:va(e,nr(e))}function q0(e,i,a){return a===r&&(a=i,i=r),a!==r&&(a=Sr(a),a=a===a?a:0),i!==r&&(i=Sr(i),i=i===i?i:0),qi(Sr(e),i,a)}function M0(e,i,a){return i=ii(i),a===r?(a=i,i=0):a=ii(a),e=Sr(e),Kd(e,i,a)}function z0(e,i,a){if(a&&typeof a!="boolean"&&Zt(e,i,a)&&(i=a=r),a===r&&(typeof i=="boolean"?(a=i,i=r):typeof e=="boolean"&&(a=e,e=r)),e===r&&i===r?(e=0,i=1):(e=ii(e),i===r?(i=e,e=0):i=ii(i)),e>i){var u=e;e=i,i=u}if(a||e%1||i%1){var f=bu();return kt(e+f*(i-e+ze("1e-"+((f+"").length-1))),i)}return Na(e,i)}var U0=fn(function(e,i,a){return i=i.toLowerCase(),e+(a?Zh(i):i)});function Zh(e){return oc($e(e).toLowerCase())}function Xh(e){return e=$e(e),e&&e.replace(Wr,Tp).replace(ca,"")}function H0(e,i,a){e=$e(e),i=dr(i);var u=e.length;a=a===r?u:qi(ye(a),0,u);var f=a;return a-=i.length,a>=0&&e.slice(a,f)==i}function B0(e){return e=$e(e),e&&Qe.test(e)?e.replace(Ai,$p):e}function k0(e){return e=$e(e),e&&Pt.test(e)?e.replace(lt,"\\$&"):e}var K0=fn(function(e,i,a){return e+(a?"-":"")+i.toLowerCase()}),V0=fn(function(e,i,a){return e+(a?" ":"")+i.toLowerCase()}),G0=rh("toLowerCase");function W0(e,i,a){e=$e(e),i=ye(i);var u=i?sn(e):0;if(!i||u>=i)return e;var f=(i-u)/2;return io(ks(f),a)+e+io(Bs(f),a)}function J0(e,i,a){e=$e(e),i=ye(i);var u=i?sn(e):0;return i&&u<i?e+io(i-u,a):e}function Q0(e,i,a){e=$e(e),i=ye(i);var u=i?sn(e):0;return i&&u<i?io(i-u,a)+e:e}function Y0(e,i,a){return a||i==null?i=0:i&&(i=+i),nd($e(e).replace(ft,""),i||0)}function Z0(e,i,a){return(a?Zt(e,i,a):i===r)?i=1:i=ye(i),Da($e(e),i)}function X0(){var e=arguments,i=$e(e[0]);return e.length<3?i:i.replace(e[1],e[2])}var em=fn(function(e,i,a){return e+(a?"_":"")+i.toLowerCase()});function tm(e,i,a){return a&&typeof a!="number"&&Zt(e,i,a)&&(i=a=r),a=a===r?k:a>>>0,a?(e=$e(e),e&&(typeof i=="string"||i!=null&&!ic(i))&&(i=dr(i),!i&&nn(e))?_i($r(e),0,a):e.split(i,a)):[]}var rm=fn(function(e,i,a){return e+(a?" ":"")+oc(i)});function im(e,i,a){return e=$e(e),a=a==null?0:qi(ye(a),0,e.length),i=dr(i),e.slice(a,a+i.length)==i}function nm(e,i,a){var u=d.templateSettings;a&&Zt(e,i,a)&&(i=r),e=$e(e),i=yo({},i,u,uh);var f=yo({},i.imports,u.imports,uh),y=Lt(f),w=va(f,y),E,R,j=0,q=i.interpolate||Ji,z="__p += '",K=wa((i.escape||Ji).source+"|"+q.source+"|"+(q===it?Ko:Ji).source+"|"+(i.evaluate||Ji).source+"|$","g"),X="//# sourceURL="+(De.call(i,"sourceURL")?(i.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++ua+"]")+`
`;e.replace(K,function(se,be,Se,yr,Xt,vr){return Se||(Se=yr),z+=e.slice(j,vr).replace(Yo,Np),be&&(E=!0,z+=`' +
__e(`+be+`) +
'`),Xt&&(R=!0,z+=`';
`+Xt+`;
__p += '`),Se&&(z+=`' +
((__t = (`+Se+`)) == null ? '' : __t) +
'`),j=vr+se.length,se}),z+=`';
`;var ne=De.call(i,"variable")&&i.variable;if(!ne)z=`with (obj) {
`+z+`
}
`;else if(Bo.test(ne))throw new fe(g);z=(R?z.replace(Mr,""):z).replace(Jt,"$1").replace(Gr,"$1;"),z="function("+(ne||"obj")+`) {
`+(ne?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(E?", __e = _.escape":"")+(R?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+z+`return __p
}`;var we=tl(function(){return Ce(y,X+"return "+z).apply(r,w)});if(we.source=z,rc(we))throw we;return we}function sm(e){return $e(e).toLowerCase()}function om(e){return $e(e).toUpperCase()}function am(e,i,a){if(e=$e(e),e&&(a||i===r))return hu(e);if(!e||!(i=dr(i)))return e;var u=$r(e),f=$r(i),y=lu(u,f),w=fu(u,f)+1;return _i(u,y,w).join("")}function cm(e,i,a){if(e=$e(e),e&&(a||i===r))return e.slice(0,du(e)+1);if(!e||!(i=dr(i)))return e;var u=$r(e),f=fu(u,$r(i))+1;return _i(u,0,f).join("")}function um(e,i,a){if(e=$e(e),e&&(a||i===r))return e.replace(ft,"");if(!e||!(i=dr(i)))return e;var u=$r(e),f=lu(u,$r(i));return _i(u,f).join("")}function hm(e,i){var a=st,u=ke;if(nt(i)){var f="separator"in i?i.separator:f;a="length"in i?ye(i.length):a,u="omission"in i?dr(i.omission):u}e=$e(e);var y=e.length;if(nn(e)){var w=$r(e);y=w.length}if(a>=y)return e;var E=a-sn(u);if(E<1)return u;var R=w?_i(w,0,E).join(""):e.slice(0,E);if(f===r)return R+u;if(w&&(E+=R.length-E),ic(f)){if(e.slice(E).search(f)){var j,q=R;for(f.global||(f=wa(f.source,$e(mr.exec(f))+"g")),f.lastIndex=0;j=f.exec(q);)var z=j.index;R=R.slice(0,z===r?E:z)}}else if(e.indexOf(dr(f),E)!=E){var K=R.lastIndexOf(f);K>-1&&(R=R.slice(0,K))}return R+u}function lm(e){return e=$e(e),e&&ct.test(e)?e.replace(li,zp):e}var fm=fn(function(e,i,a){return e+(a?" ":"")+i.toUpperCase()}),oc=rh("toUpperCase");function el(e,i,a){return e=$e(e),i=a?r:i,i===r?Fp(e)?Bp(e):Sp(e):e.match(i)||[]}var tl=_e(function(e,i){try{return Ft(e,r,i)}catch(a){return rc(a)?a:new fe(a)}}),pm=ei(function(e,i){return _r(i,function(a){a=kr(a),Zr(e,a,ec(e[a],e))}),e});function dm(e){var i=e==null?0:e.length,a=ie();return e=i?Ze(e,function(u){if(typeof u[1]!="function")throw new br(l);return[a(u[0]),u[1]]}):[],_e(function(u){for(var f=-1;++f<i;){var y=e[f];if(Ft(y[0],this,u))return Ft(y[1],this,u)}})}function gm(e){return zd(Ir(e,x))}function ac(e){return function(){return e}}function ym(e,i){return e==null||e!==e?i:e}var vm=nh(),mm=nh(!0);function sr(e){return e}function cc(e){return Du(typeof e=="function"?e:Ir(e,x))}function wm(e){return Lu(Ir(e,x))}function _m(e,i){return ju(e,Ir(i,x))}var bm=_e(function(e,i){return function(a){return jn(a,e,i)}}),Em=_e(function(e,i){return function(a){return jn(e,a,i)}});function uc(e,i,a){var u=Lt(i),f=Qs(i,u);a==null&&!(nt(i)&&(f.length||!u.length))&&(a=i,i=e,e=this,f=Qs(i,Lt(i)));var y=!(nt(a)&&"chain"in a)||!!a.chain,w=ri(e);return _r(f,function(E){var R=i[E];e[E]=R,w&&(e.prototype[E]=function(){var j=this.__chain__;if(y||j){var q=e(this.__wrapped__),z=q.__actions__=rr(this.__actions__);return z.push({func:R,args:arguments,thisArg:e}),q.__chain__=j,q}return R.apply(e,di([this.value()],arguments))})}),e}function Im(){return Pe._===this&&(Pe._=Jp),this}function hc(){}function xm(e){return e=ye(e),_e(function(i){return qu(i,e)})}var Pm=Ua(Ze),Sm=Ua(su),Om=Ua(fa);function rl(e){return Wa(e)?pa(kr(e)):ig(e)}function Rm(e){return function(i){return e==null?r:Mi(e,i)}}var Am=oh(),Cm=oh(!0);function lc(){return[]}function fc(){return!1}function Tm(){return{}}function $m(){return""}function Nm(){return!0}function Dm(e,i){if(e=ye(e),e<1||e>H)return[];var a=k,u=kt(e,k);i=ie(i),e-=k;for(var f=ya(u,i);++a<e;)i(a);return f}function Fm(e){return ge(e)?Ze(e,kr):gr(e)?[e]:rr(Eh($e(e)))}function Lm(e){var i=++Gp;return $e(e)+i}var jm=ro(function(e,i){return e+i},0),qm=Ha("ceil"),Mm=ro(function(e,i){return e/i},1),zm=Ha("floor");function Um(e){return e&&e.length?Js(e,sr,Oa):r}function Hm(e,i){return e&&e.length?Js(e,ie(i,2),Oa):r}function Bm(e){return cu(e,sr)}function km(e,i){return cu(e,ie(i,2))}function Km(e){return e&&e.length?Js(e,sr,Ta):r}function Vm(e,i){return e&&e.length?Js(e,ie(i,2),Ta):r}var Gm=ro(function(e,i){return e*i},1),Wm=Ha("round"),Jm=ro(function(e,i){return e-i},0);function Qm(e){return e&&e.length?ga(e,sr):0}function Ym(e,i){return e&&e.length?ga(e,ie(i,2)):0}return d.after=wv,d.ary=Nh,d.assign=o0,d.assignIn=Gh,d.assignInWith=yo,d.assignWith=a0,d.at=c0,d.before=Dh,d.bind=ec,d.bindAll=pm,d.bindKey=Fh,d.castArray=Tv,d.chain=Ch,d.chunk=zg,d.compact=Ug,d.concat=Hg,d.cond=dm,d.conforms=gm,d.constant=ac,d.countBy=Qy,d.create=u0,d.curry=Lh,d.curryRight=jh,d.debounce=qh,d.defaults=h0,d.defaultsDeep=l0,d.defer=_v,d.delay=bv,d.difference=Bg,d.differenceBy=kg,d.differenceWith=Kg,d.drop=Vg,d.dropRight=Gg,d.dropRightWhile=Wg,d.dropWhile=Jg,d.fill=Qg,d.filter=Zy,d.flatMap=tv,d.flatMapDeep=rv,d.flatMapDepth=iv,d.flatten=Sh,d.flattenDeep=Yg,d.flattenDepth=Zg,d.flip=Ev,d.flow=vm,d.flowRight=mm,d.fromPairs=Xg,d.functions=m0,d.functionsIn=w0,d.groupBy=nv,d.initial=ty,d.intersection=ry,d.intersectionBy=iy,d.intersectionWith=ny,d.invert=b0,d.invertBy=E0,d.invokeMap=ov,d.iteratee=cc,d.keyBy=av,d.keys=Lt,d.keysIn=nr,d.map=uo,d.mapKeys=x0,d.mapValues=P0,d.matches=wm,d.matchesProperty=_m,d.memoize=lo,d.merge=S0,d.mergeWith=Wh,d.method=bm,d.methodOf=Em,d.mixin=uc,d.negate=fo,d.nthArg=xm,d.omit=O0,d.omitBy=R0,d.once=Iv,d.orderBy=cv,d.over=Pm,d.overArgs=xv,d.overEvery=Sm,d.overSome=Om,d.partial=tc,d.partialRight=Mh,d.partition=uv,d.pick=A0,d.pickBy=Jh,d.property=rl,d.propertyOf=Rm,d.pull=cy,d.pullAll=Rh,d.pullAllBy=uy,d.pullAllWith=hy,d.pullAt=ly,d.range=Am,d.rangeRight=Cm,d.rearg=Pv,d.reject=fv,d.remove=fy,d.rest=Sv,d.reverse=Za,d.sampleSize=dv,d.set=T0,d.setWith=$0,d.shuffle=gv,d.slice=py,d.sortBy=mv,d.sortedUniq=_y,d.sortedUniqBy=by,d.split=tm,d.spread=Ov,d.tail=Ey,d.take=Iy,d.takeRight=xy,d.takeRightWhile=Py,d.takeWhile=Sy,d.tap=Uy,d.throttle=Rv,d.thru=co,d.toArray=kh,d.toPairs=Qh,d.toPairsIn=Yh,d.toPath=Fm,d.toPlainObject=Vh,d.transform=N0,d.unary=Av,d.union=Oy,d.unionBy=Ry,d.unionWith=Ay,d.uniq=Cy,d.uniqBy=Ty,d.uniqWith=$y,d.unset=D0,d.unzip=Xa,d.unzipWith=Ah,d.update=F0,d.updateWith=L0,d.values=gn,d.valuesIn=j0,d.without=Ny,d.words=el,d.wrap=Cv,d.xor=Dy,d.xorBy=Fy,d.xorWith=Ly,d.zip=jy,d.zipObject=qy,d.zipObjectDeep=My,d.zipWith=zy,d.entries=Qh,d.entriesIn=Yh,d.extend=Gh,d.extendWith=yo,uc(d,d),d.add=jm,d.attempt=tl,d.camelCase=U0,d.capitalize=Zh,d.ceil=qm,d.clamp=q0,d.clone=$v,d.cloneDeep=Dv,d.cloneDeepWith=Fv,d.cloneWith=Nv,d.conformsTo=Lv,d.deburr=Xh,d.defaultTo=ym,d.divide=Mm,d.endsWith=H0,d.eq=Dr,d.escape=B0,d.escapeRegExp=k0,d.every=Yy,d.find=Xy,d.findIndex=xh,d.findKey=f0,d.findLast=ev,d.findLastIndex=Ph,d.findLastKey=p0,d.floor=zm,d.forEach=Th,d.forEachRight=$h,d.forIn=d0,d.forInRight=g0,d.forOwn=y0,d.forOwnRight=v0,d.get=nc,d.gt=jv,d.gte=qv,d.has=_0,d.hasIn=sc,d.head=Oh,d.identity=sr,d.includes=sv,d.indexOf=ey,d.inRange=M0,d.invoke=I0,d.isArguments=Hi,d.isArray=ge,d.isArrayBuffer=Mv,d.isArrayLike=ir,d.isArrayLikeObject=mt,d.isBoolean=zv,d.isBuffer=bi,d.isDate=Uv,d.isElement=Hv,d.isEmpty=Bv,d.isEqual=kv,d.isEqualWith=Kv,d.isError=rc,d.isFinite=Vv,d.isFunction=ri,d.isInteger=zh,d.isLength=po,d.isMap=Uh,d.isMatch=Gv,d.isMatchWith=Wv,d.isNaN=Jv,d.isNative=Qv,d.isNil=Zv,d.isNull=Yv,d.isNumber=Hh,d.isObject=nt,d.isObjectLike=dt,d.isPlainObject=Bn,d.isRegExp=ic,d.isSafeInteger=Xv,d.isSet=Bh,d.isString=go,d.isSymbol=gr,d.isTypedArray=dn,d.isUndefined=e0,d.isWeakMap=t0,d.isWeakSet=r0,d.join=sy,d.kebabCase=K0,d.last=Pr,d.lastIndexOf=oy,d.lowerCase=V0,d.lowerFirst=G0,d.lt=i0,d.lte=n0,d.max=Um,d.maxBy=Hm,d.mean=Bm,d.meanBy=km,d.min=Km,d.minBy=Vm,d.stubArray=lc,d.stubFalse=fc,d.stubObject=Tm,d.stubString=$m,d.stubTrue=Nm,d.multiply=Gm,d.nth=ay,d.noConflict=Im,d.noop=hc,d.now=ho,d.pad=W0,d.padEnd=J0,d.padStart=Q0,d.parseInt=Y0,d.random=z0,d.reduce=hv,d.reduceRight=lv,d.repeat=Z0,d.replace=X0,d.result=C0,d.round=Wm,d.runInContext=S,d.sample=pv,d.size=yv,d.snakeCase=em,d.some=vv,d.sortedIndex=dy,d.sortedIndexBy=gy,d.sortedIndexOf=yy,d.sortedLastIndex=vy,d.sortedLastIndexBy=my,d.sortedLastIndexOf=wy,d.startCase=rm,d.startsWith=im,d.subtract=Jm,d.sum=Qm,d.sumBy=Ym,d.template=nm,d.times=Dm,d.toFinite=ii,d.toInteger=ye,d.toLength=Kh,d.toLower=sm,d.toNumber=Sr,d.toSafeInteger=s0,d.toString=$e,d.toUpper=om,d.trim=am,d.trimEnd=cm,d.trimStart=um,d.truncate=hm,d.unescape=lm,d.uniqueId=Lm,d.upperCase=fm,d.upperFirst=oc,d.each=Th,d.eachRight=$h,d.first=Oh,uc(d,function(){var e={};return Hr(d,function(i,a){De.call(d.prototype,a)||(e[a]=i)}),e}(),{chain:!1}),d.VERSION=n,_r(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){d[e].placeholder=d}),_r(["drop","take"],function(e,i){xe.prototype[e]=function(a){a=a===r?1:Nt(ye(a),0);var u=this.__filtered__&&!i?new xe(this):this.clone();return u.__filtered__?u.__takeCount__=kt(a,u.__takeCount__):u.__views__.push({size:kt(a,k),type:e+(u.__dir__<0?"Right":"")}),u},xe.prototype[e+"Right"]=function(a){return this.reverse()[e](a).reverse()}}),_r(["filter","map","takeWhile"],function(e,i){var a=i+1,u=a==b||a==Q;xe.prototype[e]=function(f){var y=this.clone();return y.__iteratees__.push({iteratee:ie(f,3),type:a}),y.__filtered__=y.__filtered__||u,y}}),_r(["head","last"],function(e,i){var a="take"+(i?"Right":"");xe.prototype[e]=function(){return this[a](1).value()[0]}}),_r(["initial","tail"],function(e,i){var a="drop"+(i?"":"Right");xe.prototype[e]=function(){return this.__filtered__?new xe(this):this[a](1)}}),xe.prototype.compact=function(){return this.filter(sr)},xe.prototype.find=function(e){return this.filter(e).head()},xe.prototype.findLast=function(e){return this.reverse().find(e)},xe.prototype.invokeMap=_e(function(e,i){return typeof e=="function"?new xe(this):this.map(function(a){return jn(a,e,i)})}),xe.prototype.reject=function(e){return this.filter(fo(ie(e)))},xe.prototype.slice=function(e,i){e=ye(e);var a=this;return a.__filtered__&&(e>0||i<0)?new xe(a):(e<0?a=a.takeRight(-e):e&&(a=a.drop(e)),i!==r&&(i=ye(i),a=i<0?a.dropRight(-i):a.take(i-e)),a)},xe.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},xe.prototype.toArray=function(){return this.take(k)},Hr(xe.prototype,function(e,i){var a=/^(?:filter|find|map|reject)|While$/.test(i),u=/^(?:head|last)$/.test(i),f=d[u?"take"+(i=="last"?"Right":""):i],y=u||/^find/.test(i);f&&(d.prototype[i]=function(){var w=this.__wrapped__,E=u?[1]:arguments,R=w instanceof xe,j=E[0],q=R||ge(w),z=function(be){var Se=f.apply(d,di([be],E));return u&&K?Se[0]:Se};q&&a&&typeof j=="function"&&j.length!=1&&(R=q=!1);var K=this.__chain__,X=!!this.__actions__.length,ne=y&&!K,we=R&&!X;if(!y&&q){w=we?w:new xe(this);var se=e.apply(w,E);return se.__actions__.push({func:co,args:[z],thisArg:r}),new Er(se,K)}return ne&&we?e.apply(this,E):(se=this.thru(z),ne?u?se.value()[0]:se.value():se)})}),_r(["pop","push","shift","sort","splice","unshift"],function(e){var i=Ds[e],a=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",u=/^(?:pop|shift)$/.test(e);d.prototype[e]=function(){var f=arguments;if(u&&!this.__chain__){var y=this.value();return i.apply(ge(y)?y:[],f)}return this[a](function(w){return i.apply(ge(w)?w:[],f)})}}),Hr(xe.prototype,function(e,i){var a=d[i];if(a){var u=a.name+"";De.call(un,u)||(un[u]=[]),un[u].push({name:i,func:a})}}),un[to(r,oe).name]=[{name:"wrapper",func:r}],xe.prototype.clone=ld,xe.prototype.reverse=fd,xe.prototype.value=pd,d.prototype.at=Hy,d.prototype.chain=By,d.prototype.commit=ky,d.prototype.next=Ky,d.prototype.plant=Gy,d.prototype.reverse=Wy,d.prototype.toJSON=d.prototype.valueOf=d.prototype.value=Jy,d.prototype.first=d.prototype.head,Cn&&(d.prototype[Cn]=Vy),d},on=kp();vt?((vt.exports=on)._=on,Ue._=on):Pe._=on}).call(Qn)})(Bc,Bc.exports);var Hx=Object.defineProperty,Bx=Object.defineProperties,kx=Object.getOwnPropertyDescriptors,lf=Object.getOwnPropertySymbols,Kx=Object.prototype.hasOwnProperty,Vx=Object.prototype.propertyIsEnumerable,ff=(s,t,r)=>t in s?Hx(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,Eo=(s,t)=>{for(var r in t||(t={}))Kx.call(t,r)&&ff(s,r,t[r]);if(lf)for(var r of lf(t))Vx.call(t,r)&&ff(s,r,t[r]);return s},Gx=(s,t)=>Bx(s,kx(t));function Pi(s,t,r){var n;const o=j1(s);return((n=t.rpcMap)==null?void 0:n[o.reference])||`${Ux}?chainId=${o.namespace}:${o.reference}&projectId=${r}`}function Wi(s){return s.includes(":")?s.split(":")[1]:s}function wp(s){return s.map(t=>`${t.split(":")[0]}:${t.split(":")[1]}`)}function Wx(s,t){const r=Object.keys(t.namespaces).filter(o=>o.includes(s));if(!r.length)return[];const n=[];return r.forEach(o=>{const c=t.namespaces[o].accounts;n.push(...c)}),n}function Jx(s={},t={}){const r=pf(s),n=pf(t);return Bc.exports.merge(r,n)}function pf(s){var t,r,n,o;const c={};if(!Po(s))return c;for(const[l,g]of Object.entries(s)){const v=Sf(l)?[l]:g.chains,p=g.methods||[],_=g.events||[],x=g.rpcMap||{},A=Yn(l);c[A]=Gx(Eo(Eo({},c[A]),g),{chains:dc(v,(t=c[A])==null?void 0:t.chains),methods:dc(p,(r=c[A])==null?void 0:r.methods),events:dc(_,(n=c[A])==null?void 0:n.events),rpcMap:Eo(Eo({},x),(o=c[A])==null?void 0:o.rpcMap)})}return c}function Qx(s){return s.includes(":")?s.split(":")[2]:s}function Yx(s){const t={};for(const[r,n]of Object.entries(s)){const o=n.methods||[],c=n.events||[],l=n.accounts||[],g=Sf(r)?[r]:n.chains?n.chains:wp(n.accounts);t[r]={chains:g,methods:o,events:c,accounts:l}}return t}function Pc(s){return typeof s=="number"?s:s.includes("0x")?parseInt(s,16):s.includes(":")?Number(s.split(":")[1]):Number(s)}const _p={},Xe=s=>_p[s],Sc=(s,t)=>{_p[s]=t};class Zx{constructor(t){this.name="polkadot",this.namespace=t.namespace,this.events=Xe("events"),this.client=Xe("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(hi.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getAccounts(){const t=this.namespace.accounts;return t?t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var n;const o=Wi(r);t[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProvider(t,r){const n=r||Pi(t,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);return new Oi(new Si(n,Xe("disableProviderPing")))}}class Xx{constructor(t){this.name="eip155",this.namespace=t.namespace,this.events=Xe("events"),this.client=Xe("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(t){switch(t.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(t);case"eth_chainId":return parseInt(this.getDefaultChain())}return this.namespace.methods.includes(t.request.method)?await this.client.request(t):this.getHttpProvider().request(t.request)}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(parseInt(t),r),this.chainId=parseInt(t),this.events.emit(hi.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}createHttpProvider(t,r){const n=r||Pi(`${this.name}:${t}`,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);return new Oi(new Si(n,Xe("disableProviderPing")))}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var n;const o=parseInt(Wi(r));t[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[r])}),t}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}getHttpProvider(){const t=this.chainId,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}async handleSwitchChain(t){var r,n;let o=t.request.params?(r=t.request.params[0])==null?void 0:r.chainId:"0x0";o=o.startsWith("0x")?o:`0x${o}`;const c=parseInt(o,16);if(this.isChainApproved(c))this.setDefaultChain(`${c}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:t.topic,request:{method:t.request.method,params:[{chainId:o}]},chainId:(n=this.namespace.chains)==null?void 0:n[0]}),this.setDefaultChain(`${c}`);else throw new Error(`Failed to switch to chain 'eip155:${c}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(t){return this.namespace.chains.includes(`${this.name}:${t}`)}}class eP{constructor(t){this.name="solana",this.namespace=t.namespace,this.events=Xe("events"),this.client=Xe("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(hi.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var n;const o=Wi(r);t[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProvider(t,r){const n=r||Pi(t,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);return new Oi(new Si(n,Xe("disableProviderPing")))}}class tP{constructor(t){this.name="cosmos",this.namespace=t.namespace,this.events=Xe("events"),this.client=Xe("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(hi.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var n;const o=Wi(r);t[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProvider(t,r){const n=r||Pi(t,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);return new Oi(new Si(n,Xe("disableProviderPing")))}}class rP{constructor(t){this.name="cip34",this.namespace=t.namespace,this.events=Xe("events"),this.client=Xe("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(hi.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{const n=this.getCardanoRPCUrl(r),o=Wi(r);t[o]=this.createHttpProvider(o,n)}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}getCardanoRPCUrl(t){const r=this.namespace.rpcMap;if(r)return r[t]}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProvider(t,r){const n=r||this.getCardanoRPCUrl(t);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);return new Oi(new Si(n,Xe("disableProviderPing")))}}class iP{constructor(t){this.name="elrond",this.namespace=t.namespace,this.events=Xe("events"),this.client=Xe("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(hi.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var n;const o=Wi(r);t[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProvider(t,r){const n=r||Pi(t,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);return new Oi(new Si(n,Xe("disableProviderPing")))}}class nP{constructor(t){this.name="multiversx",this.namespace=t.namespace,this.events=Xe("events"),this.client=Xe("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(hi.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var n;const o=Wi(r);t[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProvider(t,r){const n=r||Pi(t,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);return new Oi(new Si(n,Xe("disableProviderPing")))}}class sP{constructor(t){this.name="near",this.namespace=t.namespace,this.events=Xe("events"),this.client=Xe("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){if(this.chainId=t,!this.httpProviders[t]){const n=r||Pi(`${this.name}:${t}`,this.namespace);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);this.setHttpProvider(t,n)}this.events.emit(hi.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var n;t[r]=this.createHttpProvider(r,(n=this.namespace.rpcMap)==null?void 0:n[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProvider(t,r){const n=r||Pi(t,this.namespace);return typeof n>"u"?void 0:new Oi(new Si(n,Xe("disableProviderPing")))}}var oP=Object.defineProperty,aP=Object.defineProperties,cP=Object.getOwnPropertyDescriptors,df=Object.getOwnPropertySymbols,uP=Object.prototype.hasOwnProperty,hP=Object.prototype.propertyIsEnumerable,gf=(s,t,r)=>t in s?oP(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,Io=(s,t)=>{for(var r in t||(t={}))uP.call(t,r)&&gf(s,r,t[r]);if(df)for(var r of df(t))hP.call(t,r)&&gf(s,r,t[r]);return s},Oc=(s,t)=>aP(s,cP(t));class iu{constructor(t){this.events=new Wc,this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.disableProviderPing=!1,this.providerOpts=t,this.logger=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:jo(qo({level:(t==null?void 0:t.logger)||uf})),this.disableProviderPing=(t==null?void 0:t.disableProviderPing)||!1}static async init(t){const r=new iu(t);return await r.initialize(),r}async request(t,r){const[n,o]=this.validateChain(r);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(n).request({request:Io({},t),chainId:`${n}:${o}`,topic:this.session.topic})}sendAsync(t,r,n){const o=new Date().getTime();this.request(t,n).then(c=>r(null,Mo(o,c))).catch(c=>r(c,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var t;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(t=this.session)==null?void 0:t.topic,reason:Vt("USER_DISCONNECTED")}),await this.cleanup()}async connect(t){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(t),await this.cleanupPendingPairings(),!t.skipPairing)return await this.pair(t.pairingTopic)}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}removeListener(t,r){this.events.removeListener(t,r)}off(t,r){this.events.off(t,r)}get isWalletConnect(){return!0}async pair(t){this.shouldAbortPairingAttempt=!1;let r=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(r>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached");const{uri:n,approval:o}=await this.client.connect({pairingTopic:t,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});n&&(this.uri=n,this.events.emit("display_uri",n)),await o().then(c=>{this.session=c,this.namespaces||(this.namespaces=Yx(c.namespaces),this.persist("namespaces",this.namespaces))}).catch(c=>{if(c.message!==vp)throw c;r++})}while(!this.session);return this.onConnect(),this.session}setDefaultChain(t,r){try{if(!this.session)return;const[n,o]=this.validateChain(t);this.getProvider(n).setDefaultChain(o,r)}catch(n){if(!/Please call connect/.test(n.message))throw n}}async cleanupPendingPairings(t={}){this.logger.info("Cleaning up inactive pairings...");const r=this.client.pairing.getAll();if(In(r)){for(const n of r)t.deletePairings?this.client.core.expirer.set(n.topic,0):await this.client.core.relayer.subscriber.unsubscribe(n.topic);this.logger.info(`Inactive pairings cleared: ${r.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const t=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[t]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await Ax.init({logger:this.providerOpts.logger||uf,relayUrl:this.providerOpts.relayUrl||qx,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const t=[...new Set(Object.keys(this.session.namespaces).map(r=>Yn(r)))];Sc("client",this.client),Sc("events",this.events),Sc("disableProviderPing",this.disableProviderPing),t.forEach(r=>{if(!this.session)return;const n=Wx(r,this.session),o=wp(n),c=Jx(this.namespaces,this.optionalNamespaces),l=Oc(Io({},c[r]),{accounts:n,chains:o});switch(r){case"eip155":this.rpcProviders[r]=new Xx({namespace:l});break;case"solana":this.rpcProviders[r]=new eP({namespace:l});break;case"cosmos":this.rpcProviders[r]=new tP({namespace:l});break;case"polkadot":this.rpcProviders[r]=new Zx({namespace:l});break;case"cip34":this.rpcProviders[r]=new rP({namespace:l});break;case"elrond":this.rpcProviders[r]=new iP({namespace:l});break;case"multiversx":this.rpcProviders[r]=new nP({namespace:l});break;case"near":this.rpcProviders[r]=new sP({namespace:l});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",t=>{this.events.emit("session_ping",t)}),this.client.on("session_event",t=>{const{params:r}=t,{event:n}=r;if(n.name==="accountsChanged"){const o=n.data;o&&In(o)&&this.events.emit("accountsChanged",o.map(Qx))}else if(n.name==="chainChanged"){const o=r.chainId,c=r.event.data,l=Yn(o),g=Pc(o)!==Pc(c)?`${l}:${Pc(c)}`:o;this.onChainChanged(g)}else this.events.emit(n.name,n.data);this.events.emit("session_event",t)}),this.client.on("session_update",({topic:t,params:r})=>{var n;const{namespaces:o}=r,c=(n=this.client)==null?void 0:n.session.get(t);this.session=Oc(Io({},c),{namespaces:o}),this.onSessionUpdate(),this.events.emit("session_update",{topic:t,params:r})}),this.client.on("session_delete",async t=>{await this.cleanup(),this.events.emit("session_delete",t),this.events.emit("disconnect",Oc(Io({},Vt("USER_DISCONNECTED")),{data:t.topic}))}),this.on(hi.DEFAULT_CHAIN_CHANGED,t=>{this.onChainChanged(t,!0)})}getProvider(t){if(!this.rpcProviders[t])throw new Error(`Provider not found: ${t}`);return this.rpcProviders[t]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(t=>{var r;this.getProvider(t).updateNamespace((r=this.session)==null?void 0:r.namespaces[t])})}setNamespaces(t){const{namespaces:r,optionalNamespaces:n,sessionProperties:o}=t;r&&Object.keys(r).length&&(this.namespaces=r),n&&Object.keys(n).length&&(this.optionalNamespaces=n),this.sessionProperties=o,this.persist("namespaces",r),this.persist("optionalNamespaces",n)}validateChain(t){const[r,n]=(t==null?void 0:t.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[r,n];if(r&&!Object.keys(this.namespaces||{}).map(l=>Yn(l)).includes(r))throw new Error(`Namespace '${r}' is not configured. Please call connect() first with namespace config.`);if(r&&n)return[r,n];const o=Yn(Object.keys(this.namespaces)[0]),c=this.rpcProviders[o].getDefaultChain();return[o,c]}async requestAccounts(){const[t]=this.validateChain();return await this.getProvider(t).requestAccounts()}onChainChanged(t,r=!1){var n;if(!this.namespaces)return;const[o,c]=this.validateChain(t);r||this.getProvider(o).setDefaultChain(c),((n=this.namespaces[o])!=null?n:this.namespaces[`${o}:${c}`]).defaultChain=c,this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",c)}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(t,r){this.client.core.storage.setItem(`${hf}/${t}`,r)}async getFromStore(t){return await this.client.core.storage.getItem(`${hf}/${t}`)}}const lP=iu,fP="wc",pP="ethereum_provider",dP=`${fP}@2:${pP}:`,gP="https://rpc.walletconnect.com/v1/",kc=["eth_sendTransaction","personal_sign"],yP=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"],Kc=["chainChanged","accountsChanged"],vP=["chainChanged","accountsChanged","message","disconnect","connect"];var mP=Object.defineProperty,wP=Object.defineProperties,_P=Object.getOwnPropertyDescriptors,yf=Object.getOwnPropertySymbols,bP=Object.prototype.hasOwnProperty,EP=Object.prototype.propertyIsEnumerable,vf=(s,t,r)=>t in s?mP(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,Xn=(s,t)=>{for(var r in t||(t={}))bP.call(t,r)&&vf(s,r,t[r]);if(yf)for(var r of yf(t))EP.call(t,r)&&vf(s,r,t[r]);return s},mf=(s,t)=>wP(s,_P(t));function To(s){return Number(s[0].split(":")[1])}function Rc(s){return`0x${s.toString(16)}`}function IP(s){const{chains:t,optionalChains:r,methods:n,optionalMethods:o,events:c,optionalEvents:l,rpcMap:g}=s;if(!In(t))throw new Error("Invalid chains");const v={chains:t,methods:n||kc,events:c||Kc,rpcMap:Xn({},t.length?{[To(t)]:g[To(t)]}:{})},p=c==null?void 0:c.filter(D=>!Kc.includes(D)),_=n==null?void 0:n.filter(D=>!kc.includes(D));if(!r&&!l&&!o&&!(p!=null&&p.length)&&!(_!=null&&_.length))return{required:t.length?v:void 0};const x=(p==null?void 0:p.length)&&(_==null?void 0:_.length)||!r,A={chains:[...new Set(x?v.chains.concat(r||[]):r)],methods:[...new Set(v.methods.concat(o!=null&&o.length?o:yP))],events:[...new Set(v.events.concat(l!=null&&l.length?l:vP))],rpcMap:g};return{required:t.length?v:void 0,optional:r.length?A:void 0}}class nu{constructor(){this.events=new ur.EventEmitter,this.namespace="eip155",this.accounts=[],this.chainId=1,this.STORAGE_KEY=dP,this.on=(t,r)=>(this.events.on(t,r),this),this.once=(t,r)=>(this.events.once(t,r),this),this.removeListener=(t,r)=>(this.events.removeListener(t,r),this),this.off=(t,r)=>(this.events.off(t,r),this),this.parseAccount=t=>this.isCompatibleChainId(t)?this.parseAccountId(t).address:t,this.signer={},this.rpc={}}static async init(t){const r=new nu;return await r.initialize(t),r}async request(t){return await this.signer.request(t,this.formatChainId(this.chainId))}sendAsync(t,r){this.signer.sendAsync(t,r,this.formatChainId(this.chainId))}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(t){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(t);const{required:r,optional:n}=IP(this.rpc);try{const o=await new Promise(async(l,g)=>{var v;this.rpc.showQrModal&&((v=this.modal)==null||v.subscribeModal(p=>{!p.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),g(new Error("Connection request reset. Please try again.")))})),await this.signer.connect(mf(Xn({namespaces:Xn({},r&&{[this.namespace]:r})},n&&{optionalNamespaces:{[this.namespace]:n}}),{pairingTopic:t==null?void 0:t.pairingTopic})).then(p=>{l(p)}).catch(p=>{g(new Error(p.message))})});if(!o)return;const c=q1(o.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:c),this.setAccounts(c),this.events.emit("connect",{chainId:Rc(this.chainId)})}catch(o){throw this.signer.logger.error(o),o}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",t=>{const{params:r}=t,{event:n}=r;n.name==="accountsChanged"?(this.accounts=this.parseAccounts(n.data),this.events.emit("accountsChanged",this.accounts)):n.name==="chainChanged"?this.setChainId(this.formatChainId(n.data)):this.events.emit(n.name,n.data),this.events.emit("session_event",t)}),this.signer.on("chainChanged",t=>{const r=parseInt(t);this.chainId=r,this.events.emit("chainChanged",Rc(this.chainId)),this.persist()}),this.signer.on("session_update",t=>{this.events.emit("session_update",t)}),this.signer.on("session_delete",t=>{this.reset(),this.events.emit("session_delete",t),this.events.emit("disconnect",mf(Xn({},Vt("USER_DISCONNECTED")),{data:t.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",t=>{var r,n;this.rpc.showQrModal&&((r=this.modal)==null||r.closeModal(),(n=this.modal)==null||n.openModal({uri:t})),this.events.emit("display_uri",t)})}switchEthereumChain(t){this.request({method:"wallet_switchEthereumChain",params:[{chainId:t.toString(16)}]})}isCompatibleChainId(t){return typeof t=="string"?t.startsWith(`${this.namespace}:`):!1}formatChainId(t){return`${this.namespace}:${t}`}parseChainId(t){return Number(t.split(":")[1])}setChainIds(t){const r=t.filter(n=>this.isCompatibleChainId(n)).map(n=>this.parseChainId(n));r.length&&(this.chainId=r[0],this.events.emit("chainChanged",Rc(this.chainId)),this.persist())}setChainId(t){if(this.isCompatibleChainId(t)){const r=this.parseChainId(t);this.chainId=r,this.switchEthereumChain(r)}}parseAccountId(t){const[r,n,o]=t.split(":");return{chainId:`${r}:${n}`,address:o}}setAccounts(t){this.accounts=t.filter(r=>this.parseChainId(this.parseAccountId(r).chainId)===this.chainId).map(r=>this.parseAccountId(r).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(t){var r,n;const o=(r=t==null?void 0:t.chains)!=null?r:[],c=(n=t==null?void 0:t.optionalChains)!=null?n:[],l=o.concat(c);if(!l.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const g=o.length?(t==null?void 0:t.methods)||kc:[],v=o.length?(t==null?void 0:t.events)||Kc:[],p=(t==null?void 0:t.optionalMethods)||[],_=(t==null?void 0:t.optionalEvents)||[],x=(t==null?void 0:t.rpcMap)||this.buildRpcMap(l,t.projectId),A=(t==null?void 0:t.qrModalOptions)||void 0;return{chains:o==null?void 0:o.map(D=>this.formatChainId(D)),optionalChains:c.map(D=>this.formatChainId(D)),methods:g,events:v,optionalMethods:p,optionalEvents:_,rpcMap:x,showQrModal:!!(t!=null&&t.showQrModal),qrModalOptions:A,projectId:t.projectId,metadata:t.metadata}}buildRpcMap(t,r){const n={};return t.forEach(o=>{n[o]=this.getRpcUrl(o,r)}),n}async initialize(t){if(this.rpc=this.getRpcConfig(t),this.chainId=this.rpc.chains.length?To(this.rpc.chains):To(this.rpc.optionalChains),this.signer=await lP.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:t.disableProviderPing,relayUrl:t.relayUrl,storageOptions:t.storageOptions}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let r;try{const{WalletConnectModal:n}=await M1(()=>import("./index-e8be094d.js").then(o=>o.i),["assets/index-e8be094d.js","assets/index-06cb32fd.js"]);r=n}catch{throw new Error("To use QR modal, please install @walletconnect/modal package")}if(r)try{this.modal=new r(Xn({projectId:this.rpc.projectId},this.rpc.qrModalOptions))}catch(n){throw this.signer.logger.error(n),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(t){if(!t)return;const{chains:r,optionalChains:n,rpcMap:o}=t;r&&In(r)&&(this.rpc.chains=r.map(c=>this.formatChainId(c)),r.forEach(c=>{this.rpc.rpcMap[c]=(o==null?void 0:o[c])||this.getRpcUrl(c)})),n&&In(n)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=n==null?void 0:n.map(c=>this.formatChainId(c)),n.forEach(c=>{this.rpc.rpcMap[c]=(o==null?void 0:o[c])||this.getRpcUrl(c)}))}getRpcUrl(t,r){var n;return((n=this.rpc.rpcMap)==null?void 0:n[t])||`${gP}?chainId=eip155:${t}&projectId=${r||this.rpc.projectId}`}async loadPersistedSession(){if(!this.session)return;const t=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),r=this.session.namespaces[`${this.namespace}:${t}`]?this.session.namespaces[`${this.namespace}:${t}`]:this.session.namespaces[this.namespace];this.setChainIds(t?[this.formatChainId(t)]:r==null?void 0:r.accounts),this.setAccounts(r==null?void 0:r.accounts)}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(t){return typeof t=="string"||t instanceof String?[this.parseAccount(t)]:t.map(r=>this.parseAccount(r))}}const HP=nu;export{HP as EthereumProvider,vP as OPTIONAL_EVENTS,yP as OPTIONAL_METHODS,Kc as REQUIRED_EVENTS,kc as REQUIRED_METHODS,nu as default};
